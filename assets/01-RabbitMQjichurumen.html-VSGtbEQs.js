import{_ as t,c as e,d as c,e as s,f as a,b as l,w as o,r as i,o as u}from"./app-DyGs7pMe.js";const r={};function k(d,n){const p=i("RouteLink");return u(),e("div",null,[n[3]||(n[3]=c(`<h1 id="_01-rabbitmqåŸºç¡€å…¥é—¨" tabindex="-1"><a class="header-anchor" href="#_01-rabbitmqåŸºç¡€å…¥é—¨"><span>01 - RabbitMQåŸºç¡€å…¥é—¨</span></a></h1><h2 id="ğŸ¯-å­¦ä¹ ç›®æ ‡" tabindex="-1"><a class="header-anchor" href="#ğŸ¯-å­¦ä¹ ç›®æ ‡"><span>ğŸ¯ å­¦ä¹ ç›®æ ‡</span></a></h2><ul><li>äº†è§£RabbitMQçš„åŸºæœ¬æ¦‚å¿µå’Œç‰¹ç‚¹</li><li>æŒæ¡RabbitMQçš„å®‰è£…å’Œé…ç½®</li><li>ç†è§£AMQPåè®®å’Œæ ¸å¿ƒç»„ä»¶</li><li>æŒæ¡äº”ç§å·¥ä½œæ¨¡å¼</li><li>å­¦ä¼šä½¿ç”¨Javaå®¢æˆ·ç«¯API</li></ul><h2 id="ğŸ“–-rabbitmqç®€ä»‹" tabindex="-1"><a class="header-anchor" href="#ğŸ“–-rabbitmqç®€ä»‹"><span>ğŸ“– RabbitMQç®€ä»‹</span></a></h2><h3 id="ä»€ä¹ˆæ˜¯rabbitmq" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯rabbitmq"><span>ä»€ä¹ˆæ˜¯RabbitMQï¼Ÿ</span></a></h3><p>RabbitMQæ˜¯ä¸€ä¸ªå¼€æºçš„æ¶ˆæ¯ä»£ç†è½¯ä»¶ï¼ˆMessage Brokerï¼‰ï¼Œå®ç°äº†AMQPï¼ˆé«˜çº§æ¶ˆæ¯é˜Ÿåˆ—åè®®ï¼‰ã€‚å®ƒä½¿ç”¨Erlangè¯­è¨€å¼€å‘ï¼Œå…·æœ‰é«˜å¯ç”¨ã€é«˜å¯é ã€å¯æ‰©å±•çš„ç‰¹ç‚¹ã€‚</p><h3 id="æ ¸å¿ƒç‰¹ç‚¹" tabindex="-1"><a class="header-anchor" href="#æ ¸å¿ƒç‰¹ç‚¹"><span>æ ¸å¿ƒç‰¹ç‚¹</span></a></h3><ul><li>âœ… <strong>å¯é æ€§</strong> - æ”¯æŒæ¶ˆæ¯æŒä¹…åŒ–ã€ç¡®è®¤æœºåˆ¶</li><li>âœ… <strong>çµæ´»è·¯ç”±</strong> - å¤šç§äº¤æ¢æœºç±»å‹</li><li>âœ… <strong>é›†ç¾¤æ”¯æŒ</strong> - é«˜å¯ç”¨é›†ç¾¤éƒ¨ç½²</li><li>âœ… <strong>å¤šè¯­è¨€</strong> - æ”¯æŒå¤šç§ç¼–ç¨‹è¯­è¨€</li><li>âœ… <strong>ç®¡ç†ç•Œé¢</strong> - Webç®¡ç†æ§åˆ¶å°</li><li>âœ… <strong>æ’ä»¶ç³»ç»Ÿ</strong> - ä¸°å¯Œçš„æ’ä»¶ç”Ÿæ€</li></ul><h3 id="åº”ç”¨åœºæ™¯" tabindex="-1"><a class="header-anchor" href="#åº”ç”¨åœºæ™¯"><span>åº”ç”¨åœºæ™¯</span></a></h3><ul><li>ğŸ”„ <strong>å¼‚æ­¥å¤„ç†</strong> - æ³¨å†Œå‘é€é‚®ä»¶ã€çŸ­ä¿¡é€šçŸ¥</li><li>ğŸ”Œ <strong>ç³»ç»Ÿè§£è€¦</strong> - è®¢å•ç³»ç»Ÿä¸åº“å­˜ã€ç‰©æµè§£è€¦</li><li>â›°ï¸ <strong>æµé‡å‰Šå³°</strong> - ç§’æ€ã€æŠ¢è´­åœºæ™¯</li><li>ğŸ“Š <strong>æ—¥å¿—æ”¶é›†</strong> - åº”ç”¨æ—¥å¿—ç»Ÿä¸€æ”¶é›†</li><li>ğŸ”” <strong>æ¶ˆæ¯é€šçŸ¥</strong> - ç«™å†…æ¶ˆæ¯ã€æ¨é€é€šçŸ¥</li></ul><h2 id="ğŸ”§-å®‰è£…rabbitmq" tabindex="-1"><a class="header-anchor" href="#ğŸ”§-å®‰è£…rabbitmq"><span>ğŸ”§ å®‰è£…RabbitMQ</span></a></h2><h3 id="dockerå®‰è£…-æ¨è" tabindex="-1"><a class="header-anchor" href="#dockerå®‰è£…-æ¨è"><span>Dockerå®‰è£…ï¼ˆæ¨èï¼‰</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token comment"># æ‹‰å–é•œåƒï¼ˆå¸¦ç®¡ç†ç•Œé¢ï¼‰</span></span>
<span class="line"><span class="token function">docker</span> pull rabbitmq:3.12-management</span>
<span class="line"></span>
<span class="line"><span class="token comment"># è¿è¡Œå®¹å™¨</span></span>
<span class="line"><span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token punctuation">\\</span></span>
<span class="line">  <span class="token parameter variable">--name</span> rabbitmq <span class="token punctuation">\\</span></span>
<span class="line">  <span class="token parameter variable">-p</span> <span class="token number">5672</span>:5672 <span class="token punctuation">\\</span></span>
<span class="line">  <span class="token parameter variable">-p</span> <span class="token number">15672</span>:15672 <span class="token punctuation">\\</span></span>
<span class="line">  <span class="token parameter variable">-e</span> <span class="token assign-left variable">RABBITMQ_DEFAULT_USER</span><span class="token operator">=</span>admin <span class="token punctuation">\\</span></span>
<span class="line">  <span class="token parameter variable">-e</span> <span class="token assign-left variable">RABBITMQ_DEFAULT_PASS</span><span class="token operator">=</span>admin123 <span class="token punctuation">\\</span></span>
<span class="line">  rabbitmq:3.12-management</span>
<span class="line"></span>
<span class="line"><span class="token comment"># è®¿é—®ç®¡ç†ç•Œé¢</span></span>
<span class="line"><span class="token comment"># http://localhost:15672</span></span>
<span class="line"><span class="token comment"># ç”¨æˆ·å: admin</span></span>
<span class="line"><span class="token comment"># å¯†ç : admin123</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="linuxå®‰è£…" tabindex="-1"><a class="header-anchor" href="#linuxå®‰è£…"><span>Linuxå®‰è£…</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token comment"># å®‰è£…Erlang</span></span>
<span class="line"><span class="token function">wget</span> https://packages.erlang-solutions.com/erlang-solutions-2.0-1.noarch.rpm</span>
<span class="line"><span class="token function">rpm</span> <span class="token parameter variable">-Uvh</span> erlang-solutions-2.0-1.noarch.rpm</span>
<span class="line">yum <span class="token function">install</span> <span class="token parameter variable">-y</span> erlang</span>
<span class="line"></span>
<span class="line"><span class="token comment"># å®‰è£…RabbitMQ</span></span>
<span class="line"><span class="token function">wget</span> https://github.com/rabbitmq/rabbitmq-server/releases/download/v3.12.0/rabbitmq-server-3.12.0-1.el7.noarch.rpm</span>
<span class="line"><span class="token function">rpm</span> <span class="token parameter variable">-Uvh</span> rabbitmq-server-3.12.0-1.el7.noarch.rpm</span>
<span class="line"></span>
<span class="line"><span class="token comment"># å¯åŠ¨æœåŠ¡</span></span>
<span class="line">systemctl start rabbitmq-server</span>
<span class="line">systemctl <span class="token builtin class-name">enable</span> rabbitmq-server</span>
<span class="line"></span>
<span class="line"><span class="token comment"># å¯ç”¨ç®¡ç†æ’ä»¶</span></span>
<span class="line">rabbitmq-plugins <span class="token builtin class-name">enable</span> rabbitmq_management</span>
<span class="line"></span>
<span class="line"><span class="token comment"># æ·»åŠ ç”¨æˆ·</span></span>
<span class="line">rabbitmqctl add_user admin admin123</span>
<span class="line">rabbitmqctl set_user_tags admin administrator</span>
<span class="line">rabbitmqctl set_permissions <span class="token parameter variable">-p</span> / admin <span class="token string">&quot;.*&quot;</span> <span class="token string">&quot;.*&quot;</span> <span class="token string">&quot;.*&quot;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="windowså®‰è£…" tabindex="-1"><a class="header-anchor" href="#windowså®‰è£…"><span>Windowså®‰è£…</span></a></h3><ol><li>å®‰è£…Erlang: https://www.erlang.org/downloads</li><li>å®‰è£…RabbitMQ: https://www.rabbitmq.com/download.html</li><li>å¯ç”¨ç®¡ç†æ’ä»¶:</li></ol><div class="language-cmd line-numbers-mode" data-highlighter="prismjs" data-ext="cmd" data-title="cmd"><pre><code><span class="line">rabbitmq-plugins enable rabbitmq_management</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="ğŸ—ï¸-æ ¸å¿ƒæ¦‚å¿µ" tabindex="-1"><a class="header-anchor" href="#ğŸ—ï¸-æ ¸å¿ƒæ¦‚å¿µ"><span>ğŸ—ï¸ æ ¸å¿ƒæ¦‚å¿µ</span></a></h2><h3 id="amqpåè®®" tabindex="-1"><a class="header-anchor" href="#amqpåè®®"><span>AMQPåè®®</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">Producer â†’ Exchange â†’ Queue â†’ Consumer</span>
<span class="line">            â†“</span>
<span class="line">         Binding</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="æ ¸å¿ƒç»„ä»¶" tabindex="-1"><a class="header-anchor" href="#æ ¸å¿ƒç»„ä»¶"><span>æ ¸å¿ƒç»„ä»¶</span></a></h3><h4 id="_1-producer-ç”Ÿäº§è€…" tabindex="-1"><a class="header-anchor" href="#_1-producer-ç”Ÿäº§è€…"><span>1. Producerï¼ˆç”Ÿäº§è€…ï¼‰</span></a></h4><p>å‘é€æ¶ˆæ¯çš„åº”ç”¨ç¨‹åºã€‚</p><h4 id="_2-exchange-äº¤æ¢æœº" tabindex="-1"><a class="header-anchor" href="#_2-exchange-äº¤æ¢æœº"><span>2. Exchangeï¼ˆäº¤æ¢æœºï¼‰</span></a></h4><p>æ¥æ”¶ç”Ÿäº§è€…çš„æ¶ˆæ¯ï¼Œå¹¶æ ¹æ®è·¯ç”±è§„åˆ™è½¬å‘åˆ°é˜Ÿåˆ—ã€‚</p><p><strong>äº¤æ¢æœºç±»å‹ï¼š</strong></p><ul><li><strong>Directï¼ˆç›´è¿ï¼‰</strong> - ç²¾ç¡®åŒ¹é…routing key</li><li><strong>Fanoutï¼ˆå¹¿æ’­ï¼‰</strong> - å‘é€åˆ°æ‰€æœ‰ç»‘å®šçš„é˜Ÿåˆ—</li><li><strong>Topicï¼ˆä¸»é¢˜ï¼‰</strong> - æ¨¡å¼åŒ¹é…routing key</li><li><strong>Headersï¼ˆå¤´éƒ¨ï¼‰</strong> - æ ¹æ®æ¶ˆæ¯å¤´å±æ€§åŒ¹é…</li></ul><h4 id="_3-queue-é˜Ÿåˆ—" tabindex="-1"><a class="header-anchor" href="#_3-queue-é˜Ÿåˆ—"><span>3. Queueï¼ˆé˜Ÿåˆ—ï¼‰</span></a></h4><p>å­˜å‚¨æ¶ˆæ¯çš„å®¹å™¨ï¼Œç­‰å¾…æ¶ˆè´¹è€…æ¶ˆè´¹ã€‚</p><h4 id="_4-binding-ç»‘å®š" tabindex="-1"><a class="header-anchor" href="#_4-binding-ç»‘å®š"><span>4. Bindingï¼ˆç»‘å®šï¼‰</span></a></h4><p>Exchangeå’ŒQueueä¹‹é—´çš„ç»‘å®šå…³ç³»ã€‚</p><h4 id="_5-consumer-æ¶ˆè´¹è€…" tabindex="-1"><a class="header-anchor" href="#_5-consumer-æ¶ˆè´¹è€…"><span>5. Consumerï¼ˆæ¶ˆè´¹è€…ï¼‰</span></a></h4><p>æ¥æ”¶å¹¶å¤„ç†æ¶ˆæ¯çš„åº”ç”¨ç¨‹åºã€‚</p><h4 id="_6-virtual-host-è™šæ‹Ÿä¸»æœº" tabindex="-1"><a class="header-anchor" href="#_6-virtual-host-è™šæ‹Ÿä¸»æœº"><span>6. Virtual Hostï¼ˆè™šæ‹Ÿä¸»æœºï¼‰</span></a></h4><p>ç±»ä¼¼äºæ•°æ®åº“çš„databaseï¼Œç”¨äºéš”ç¦»ä¸åŒåº”ç”¨ã€‚</p><h4 id="_7-connection-è¿æ¥" tabindex="-1"><a class="header-anchor" href="#_7-connection-è¿æ¥"><span>7. Connectionï¼ˆè¿æ¥ï¼‰</span></a></h4><p>TCPè¿æ¥ã€‚</p><h4 id="_8-channel-ä¿¡é“" tabindex="-1"><a class="header-anchor" href="#_8-channel-ä¿¡é“"><span>8. Channelï¼ˆä¿¡é“ï¼‰</span></a></h4><p>åœ¨Connectionå†…éƒ¨å»ºç«‹çš„é€»è¾‘è¿æ¥ï¼Œå‡å°‘TCPè¿æ¥å¼€é”€ã€‚</p><h2 id="ğŸ¨-äº”ç§å·¥ä½œæ¨¡å¼" tabindex="-1"><a class="header-anchor" href="#ğŸ¨-äº”ç§å·¥ä½œæ¨¡å¼"><span>ğŸ¨ äº”ç§å·¥ä½œæ¨¡å¼</span></a></h2><h3 id="_1-simple-ç®€å•æ¨¡å¼" tabindex="-1"><a class="header-anchor" href="#_1-simple-ç®€å•æ¨¡å¼"><span>1. Simpleï¼ˆç®€å•æ¨¡å¼ï¼‰</span></a></h3><p><strong>ç‰¹ç‚¹ï¼š</strong> ä¸€ä¸ªç”Ÿäº§è€…ï¼Œä¸€ä¸ªé˜Ÿåˆ—ï¼Œä¸€ä¸ªæ¶ˆè´¹è€…</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">Producer â†’ Queue â†’ Consumer</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><strong>ä»£ç ç¤ºä¾‹ï¼š</strong></p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token comment">// ç”Ÿäº§è€…</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Producer</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">QUEUE_NAME</span> <span class="token operator">=</span> <span class="token string">&quot;simple_queue&quot;</span><span class="token punctuation">;</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// 1. åˆ›å»ºè¿æ¥å·¥å‚</span></span>
<span class="line">        <span class="token class-name">ConnectionFactory</span> factory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConnectionFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        factory<span class="token punctuation">.</span><span class="token function">setHost</span><span class="token punctuation">(</span><span class="token string">&quot;localhost&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        factory<span class="token punctuation">.</span><span class="token function">setPort</span><span class="token punctuation">(</span><span class="token number">5672</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        factory<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span><span class="token string">&quot;admin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        factory<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">&quot;admin123&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        </span>
<span class="line">        <span class="token comment">// 2. åˆ›å»ºè¿æ¥</span></span>
<span class="line">        <span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">Connection</span> connection <span class="token operator">=</span> factory<span class="token punctuation">.</span><span class="token function">newConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">             <span class="token class-name">Channel</span> channel <span class="token operator">=</span> connection<span class="token punctuation">.</span><span class="token function">createChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            </span>
<span class="line">            <span class="token comment">// 3. å£°æ˜é˜Ÿåˆ—</span></span>
<span class="line">            channel<span class="token punctuation">.</span><span class="token function">queueDeclare</span><span class="token punctuation">(</span><span class="token constant">QUEUE_NAME</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            </span>
<span class="line">            <span class="token comment">// 4. å‘é€æ¶ˆæ¯</span></span>
<span class="line">            <span class="token class-name">String</span> message <span class="token operator">=</span> <span class="token string">&quot;Hello RabbitMQ!&quot;</span><span class="token punctuation">;</span></span>
<span class="line">            channel<span class="token punctuation">.</span><span class="token function">basicPublish</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token constant">QUEUE_NAME</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> message<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;å‘é€æ¶ˆæ¯: &quot;</span> <span class="token operator">+</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// æ¶ˆè´¹è€…</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Consumer</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">QUEUE_NAME</span> <span class="token operator">=</span> <span class="token string">&quot;simple_queue&quot;</span><span class="token punctuation">;</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">ConnectionFactory</span> factory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConnectionFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        factory<span class="token punctuation">.</span><span class="token function">setHost</span><span class="token punctuation">(</span><span class="token string">&quot;localhost&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        </span>
<span class="line">        <span class="token class-name">Connection</span> connection <span class="token operator">=</span> factory<span class="token punctuation">.</span><span class="token function">newConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token class-name">Channel</span> channel <span class="token operator">=</span> connection<span class="token punctuation">.</span><span class="token function">createChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        </span>
<span class="line">        <span class="token comment">// å£°æ˜é˜Ÿåˆ—</span></span>
<span class="line">        channel<span class="token punctuation">.</span><span class="token function">queueDeclare</span><span class="token punctuation">(</span><span class="token constant">QUEUE_NAME</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        </span>
<span class="line">        <span class="token comment">// æ¥æ”¶æ¶ˆæ¯</span></span>
<span class="line">        <span class="token class-name">DeliverCallback</span> deliverCallback <span class="token operator">=</span> <span class="token punctuation">(</span>consumerTag<span class="token punctuation">,</span> delivery<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token class-name">String</span> message <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>delivery<span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;UTF-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;æ”¶åˆ°æ¶ˆæ¯: &quot;</span> <span class="token operator">+</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">        </span>
<span class="line">        channel<span class="token punctuation">.</span><span class="token function">basicConsume</span><span class="token punctuation">(</span><span class="token constant">QUEUE_NAME</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> deliverCallback<span class="token punctuation">,</span> consumerTag <span class="token operator">-&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-work-queue-å·¥ä½œé˜Ÿåˆ—æ¨¡å¼" tabindex="-1"><a class="header-anchor" href="#_2-work-queue-å·¥ä½œé˜Ÿåˆ—æ¨¡å¼"><span>2. Work Queueï¼ˆå·¥ä½œé˜Ÿåˆ—æ¨¡å¼ï¼‰</span></a></h3><p><strong>ç‰¹ç‚¹ï¼š</strong> ä¸€ä¸ªç”Ÿäº§è€…ï¼Œä¸€ä¸ªé˜Ÿåˆ—ï¼Œå¤šä¸ªæ¶ˆè´¹è€…ï¼ˆç«äº‰æ¶ˆè´¹ï¼‰</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">Producer â†’ Queue â†’ Consumer1</span>
<span class="line">              â†“</span>
<span class="line">           Consumer2</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>åº”ç”¨åœºæ™¯ï¼š</strong> ä»»åŠ¡åˆ†å‘ã€è´Ÿè½½å‡è¡¡</p><p><strong>ä»£ç ç¤ºä¾‹ï¼š</strong></p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token comment">// ç”Ÿäº§è€…</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Producer</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">QUEUE_NAME</span> <span class="token operator">=</span> <span class="token string">&quot;work_queue&quot;</span><span class="token punctuation">;</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">ConnectionFactory</span> factory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConnectionFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        factory<span class="token punctuation">.</span><span class="token function">setHost</span><span class="token punctuation">(</span><span class="token string">&quot;localhost&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        </span>
<span class="line">        <span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">Connection</span> connection <span class="token operator">=</span> factory<span class="token punctuation">.</span><span class="token function">newConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">             <span class="token class-name">Channel</span> channel <span class="token operator">=</span> connection<span class="token punctuation">.</span><span class="token function">createChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            </span>
<span class="line">            channel<span class="token punctuation">.</span><span class="token function">queueDeclare</span><span class="token punctuation">(</span><span class="token constant">QUEUE_NAME</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            </span>
<span class="line">            <span class="token comment">// å‘é€10æ¡æ¶ˆæ¯</span></span>
<span class="line">            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token class-name">String</span> message <span class="token operator">=</span> <span class="token string">&quot;Task &quot;</span> <span class="token operator">+</span> i<span class="token punctuation">;</span></span>
<span class="line">                channel<span class="token punctuation">.</span><span class="token function">basicPublish</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token constant">QUEUE_NAME</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> message<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;å‘é€: &quot;</span> <span class="token operator">+</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// æ¶ˆè´¹è€…ï¼ˆå¯åŠ¨å¤šä¸ªå®ä¾‹ï¼‰</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Consumer</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">QUEUE_NAME</span> <span class="token operator">=</span> <span class="token string">&quot;work_queue&quot;</span><span class="token punctuation">;</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">ConnectionFactory</span> factory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConnectionFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        factory<span class="token punctuation">.</span><span class="token function">setHost</span><span class="token punctuation">(</span><span class="token string">&quot;localhost&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        </span>
<span class="line">        <span class="token class-name">Connection</span> connection <span class="token operator">=</span> factory<span class="token punctuation">.</span><span class="token function">newConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token class-name">Channel</span> channel <span class="token operator">=</span> connection<span class="token punctuation">.</span><span class="token function">createChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        </span>
<span class="line">        channel<span class="token punctuation">.</span><span class="token function">queueDeclare</span><span class="token punctuation">(</span><span class="token constant">QUEUE_NAME</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        </span>
<span class="line">        <span class="token comment">// è®¾ç½®æ¯æ¬¡åªå¤„ç†1æ¡æ¶ˆæ¯ï¼ˆå…¬å¹³åˆ†å‘ï¼‰</span></span>
<span class="line">        channel<span class="token punctuation">.</span><span class="token function">basicQos</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        </span>
<span class="line">        <span class="token class-name">DeliverCallback</span> deliverCallback <span class="token operator">=</span> <span class="token punctuation">(</span>consumerTag<span class="token punctuation">,</span> delivery<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token class-name">String</span> message <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>delivery<span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;UTF-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;å¤„ç†ä»»åŠ¡: &quot;</span> <span class="token operator">+</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            </span>
<span class="line">            <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// æ¨¡æ‹Ÿå¤„ç†æ—¶é—´</span></span>
<span class="line">            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">            </span>
<span class="line">            <span class="token comment">// æ‰‹åŠ¨ç¡®è®¤</span></span>
<span class="line">            channel<span class="token punctuation">.</span><span class="token function">basicAck</span><span class="token punctuation">(</span>delivery<span class="token punctuation">.</span><span class="token function">getEnvelope</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDeliveryTag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">        </span>
<span class="line">        channel<span class="token punctuation">.</span><span class="token function">basicConsume</span><span class="token punctuation">(</span><span class="token constant">QUEUE_NAME</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> deliverCallback<span class="token punctuation">,</span> consumerTag <span class="token operator">-&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-publish-subscribe-å‘å¸ƒè®¢é˜…æ¨¡å¼" tabindex="-1"><a class="header-anchor" href="#_3-publish-subscribe-å‘å¸ƒè®¢é˜…æ¨¡å¼"><span>3. Publish/Subscribeï¼ˆå‘å¸ƒè®¢é˜…æ¨¡å¼ï¼‰</span></a></h3><p><strong>ç‰¹ç‚¹ï¼š</strong> ä½¿ç”¨Fanoutäº¤æ¢æœºï¼Œæ¶ˆæ¯å‘é€ç»™æ‰€æœ‰è®¢é˜…è€…</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">Producer â†’ Exchange(fanout) â†’ Queue1 â†’ Consumer1</span>
<span class="line">                         â†“</span>
<span class="line">                       Queue2 â†’ Consumer2</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>åº”ç”¨åœºæ™¯ï¼š</strong> ç¾¤å‘æ¶ˆæ¯ã€å¹¿æ’­é€šçŸ¥</p><p><strong>ä»£ç ç¤ºä¾‹ï¼š</strong></p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token comment">// ç”Ÿäº§è€…</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Producer</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">EXCHANGE_NAME</span> <span class="token operator">=</span> <span class="token string">&quot;logs&quot;</span><span class="token punctuation">;</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">ConnectionFactory</span> factory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConnectionFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        factory<span class="token punctuation">.</span><span class="token function">setHost</span><span class="token punctuation">(</span><span class="token string">&quot;localhost&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        </span>
<span class="line">        <span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">Connection</span> connection <span class="token operator">=</span> factory<span class="token punctuation">.</span><span class="token function">newConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">             <span class="token class-name">Channel</span> channel <span class="token operator">=</span> connection<span class="token punctuation">.</span><span class="token function">createChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            </span>
<span class="line">            <span class="token comment">// å£°æ˜fanoutäº¤æ¢æœº</span></span>
<span class="line">            channel<span class="token punctuation">.</span><span class="token function">exchangeDeclare</span><span class="token punctuation">(</span><span class="token constant">EXCHANGE_NAME</span><span class="token punctuation">,</span> <span class="token string">&quot;fanout&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            </span>
<span class="line">            <span class="token class-name">String</span> message <span class="token operator">=</span> <span class="token string">&quot;ç³»ç»Ÿé€šçŸ¥ï¼šæœåŠ¡å™¨å°†åœ¨1å°æ—¶åç»´æŠ¤&quot;</span><span class="token punctuation">;</span></span>
<span class="line">            channel<span class="token punctuation">.</span><span class="token function">basicPublish</span><span class="token punctuation">(</span><span class="token constant">EXCHANGE_NAME</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> message<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;å‘é€é€šçŸ¥: &quot;</span> <span class="token operator">+</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// æ¶ˆè´¹è€…</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Consumer</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">EXCHANGE_NAME</span> <span class="token operator">=</span> <span class="token string">&quot;logs&quot;</span><span class="token punctuation">;</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">ConnectionFactory</span> factory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConnectionFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        factory<span class="token punctuation">.</span><span class="token function">setHost</span><span class="token punctuation">(</span><span class="token string">&quot;localhost&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        </span>
<span class="line">        <span class="token class-name">Connection</span> connection <span class="token operator">=</span> factory<span class="token punctuation">.</span><span class="token function">newConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token class-name">Channel</span> channel <span class="token operator">=</span> connection<span class="token punctuation">.</span><span class="token function">createChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        </span>
<span class="line">        channel<span class="token punctuation">.</span><span class="token function">exchangeDeclare</span><span class="token punctuation">(</span><span class="token constant">EXCHANGE_NAME</span><span class="token punctuation">,</span> <span class="token string">&quot;fanout&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        </span>
<span class="line">        <span class="token comment">// å£°æ˜ä¸´æ—¶é˜Ÿåˆ—</span></span>
<span class="line">        <span class="token class-name">String</span> queueName <span class="token operator">=</span> channel<span class="token punctuation">.</span><span class="token function">queueDeclare</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        </span>
<span class="line">        <span class="token comment">// ç»‘å®šé˜Ÿåˆ—åˆ°äº¤æ¢æœº</span></span>
<span class="line">        channel<span class="token punctuation">.</span><span class="token function">queueBind</span><span class="token punctuation">(</span>queueName<span class="token punctuation">,</span> <span class="token constant">EXCHANGE_NAME</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        </span>
<span class="line">        <span class="token class-name">DeliverCallback</span> deliverCallback <span class="token operator">=</span> <span class="token punctuation">(</span>consumerTag<span class="token punctuation">,</span> delivery<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token class-name">String</span> message <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>delivery<span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;UTF-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;æ”¶åˆ°é€šçŸ¥: &quot;</span> <span class="token operator">+</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">        </span>
<span class="line">        channel<span class="token punctuation">.</span><span class="token function">basicConsume</span><span class="token punctuation">(</span>queueName<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> deliverCallback<span class="token punctuation">,</span> consumerTag <span class="token operator">-&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-routing-è·¯ç”±æ¨¡å¼" tabindex="-1"><a class="header-anchor" href="#_4-routing-è·¯ç”±æ¨¡å¼"><span>4. Routingï¼ˆè·¯ç”±æ¨¡å¼ï¼‰</span></a></h3><p><strong>ç‰¹ç‚¹ï¼š</strong> ä½¿ç”¨Directäº¤æ¢æœºï¼Œæ ¹æ®routing keyç²¾ç¡®åŒ¹é…</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">Producer â†’ Exchange(direct) â†’ Queue1(error) â†’ Consumer1</span>
<span class="line">                         â†“</span>
<span class="line">                       Queue2(info,warning) â†’ Consumer2</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>åº”ç”¨åœºæ™¯ï¼š</strong> æ—¥å¿—çº§åˆ«åˆ†å‘ã€é”™è¯¯å¤„ç†</p><p><strong>ä»£ç ç¤ºä¾‹ï¼š</strong></p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token comment">// ç”Ÿäº§è€…</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Producer</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">EXCHANGE_NAME</span> <span class="token operator">=</span> <span class="token string">&quot;direct_logs&quot;</span><span class="token punctuation">;</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">ConnectionFactory</span> factory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConnectionFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        factory<span class="token punctuation">.</span><span class="token function">setHost</span><span class="token punctuation">(</span><span class="token string">&quot;localhost&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        </span>
<span class="line">        <span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">Connection</span> connection <span class="token operator">=</span> factory<span class="token punctuation">.</span><span class="token function">newConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">             <span class="token class-name">Channel</span> channel <span class="token operator">=</span> connection<span class="token punctuation">.</span><span class="token function">createChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            </span>
<span class="line">            channel<span class="token punctuation">.</span><span class="token function">exchangeDeclare</span><span class="token punctuation">(</span><span class="token constant">EXCHANGE_NAME</span><span class="token punctuation">,</span> <span class="token string">&quot;direct&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            </span>
<span class="line">            <span class="token comment">// å‘é€ä¸åŒçº§åˆ«çš„æ—¥å¿—</span></span>
<span class="line">            <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> levels <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;info&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;warning&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;error&quot;</span><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> level <span class="token operator">:</span> levels<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token class-name">String</span> message <span class="token operator">=</span> level <span class="token operator">+</span> <span class="token string">&quot; çº§åˆ«æ—¥å¿—æ¶ˆæ¯&quot;</span><span class="token punctuation">;</span></span>
<span class="line">                channel<span class="token punctuation">.</span><span class="token function">basicPublish</span><span class="token punctuation">(</span><span class="token constant">EXCHANGE_NAME</span><span class="token punctuation">,</span> level<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> message<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;å‘é€: &quot;</span> <span class="token operator">+</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// æ¶ˆè´¹è€…ï¼ˆåªæ¥æ”¶erroræ—¥å¿—ï¼‰</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ErrorConsumer</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">EXCHANGE_NAME</span> <span class="token operator">=</span> <span class="token string">&quot;direct_logs&quot;</span><span class="token punctuation">;</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">ConnectionFactory</span> factory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConnectionFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        factory<span class="token punctuation">.</span><span class="token function">setHost</span><span class="token punctuation">(</span><span class="token string">&quot;localhost&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        </span>
<span class="line">        <span class="token class-name">Connection</span> connection <span class="token operator">=</span> factory<span class="token punctuation">.</span><span class="token function">newConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token class-name">Channel</span> channel <span class="token operator">=</span> connection<span class="token punctuation">.</span><span class="token function">createChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        </span>
<span class="line">        channel<span class="token punctuation">.</span><span class="token function">exchangeDeclare</span><span class="token punctuation">(</span><span class="token constant">EXCHANGE_NAME</span><span class="token punctuation">,</span> <span class="token string">&quot;direct&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token class-name">String</span> queueName <span class="token operator">=</span> channel<span class="token punctuation">.</span><span class="token function">queueDeclare</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        </span>
<span class="line">        <span class="token comment">// åªç»‘å®šerrorçº§åˆ«</span></span>
<span class="line">        channel<span class="token punctuation">.</span><span class="token function">queueBind</span><span class="token punctuation">(</span>queueName<span class="token punctuation">,</span> <span class="token constant">EXCHANGE_NAME</span><span class="token punctuation">,</span> <span class="token string">&quot;error&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        </span>
<span class="line">        <span class="token class-name">DeliverCallback</span> deliverCallback <span class="token operator">=</span> <span class="token punctuation">(</span>consumerTag<span class="token punctuation">,</span> delivery<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token class-name">String</span> message <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>delivery<span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;UTF-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ERRORæ—¥å¿—: &quot;</span> <span class="token operator">+</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">        </span>
<span class="line">        channel<span class="token punctuation">.</span><span class="token function">basicConsume</span><span class="token punctuation">(</span>queueName<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> deliverCallback<span class="token punctuation">,</span> consumerTag <span class="token operator">-&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-topic-ä¸»é¢˜æ¨¡å¼" tabindex="-1"><a class="header-anchor" href="#_5-topic-ä¸»é¢˜æ¨¡å¼"><span>5. Topicï¼ˆä¸»é¢˜æ¨¡å¼ï¼‰</span></a></h3><p><strong>ç‰¹ç‚¹ï¼š</strong> ä½¿ç”¨Topicäº¤æ¢æœºï¼Œæ”¯æŒé€šé…ç¬¦åŒ¹é…</p><ul><li><code>*</code> - åŒ¹é…ä¸€ä¸ªå•è¯</li><li><code>#</code> - åŒ¹é…0ä¸ªæˆ–å¤šä¸ªå•è¯</li></ul><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">Producer â†’ Exchange(topic) â†’ Queue1(*.error) â†’ Consumer1</span>
<span class="line">                        â†“</span>
<span class="line">                      Queue2(user.#) â†’ Consumer2</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>åº”ç”¨åœºæ™¯ï¼š</strong> å¤æ‚çš„æ¶ˆæ¯è·¯ç”±</p><p><strong>ä»£ç ç¤ºä¾‹ï¼š</strong></p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token comment">// ç”Ÿäº§è€…</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Producer</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">EXCHANGE_NAME</span> <span class="token operator">=</span> <span class="token string">&quot;topic_logs&quot;</span><span class="token punctuation">;</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">ConnectionFactory</span> factory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConnectionFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        factory<span class="token punctuation">.</span><span class="token function">setHost</span><span class="token punctuation">(</span><span class="token string">&quot;localhost&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        </span>
<span class="line">        <span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">Connection</span> connection <span class="token operator">=</span> factory<span class="token punctuation">.</span><span class="token function">newConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">             <span class="token class-name">Channel</span> channel <span class="token operator">=</span> connection<span class="token punctuation">.</span><span class="token function">createChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            </span>
<span class="line">            channel<span class="token punctuation">.</span><span class="token function">exchangeDeclare</span><span class="token punctuation">(</span><span class="token constant">EXCHANGE_NAME</span><span class="token punctuation">,</span> <span class="token string">&quot;topic&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            </span>
<span class="line">            <span class="token comment">// å‘é€ä¸åŒrouting keyçš„æ¶ˆæ¯</span></span>
<span class="line">            <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span> messages <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token punctuation">{</span><span class="token string">&quot;user.order.create&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;ç”¨æˆ·åˆ›å»ºè®¢å•&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token punctuation">{</span><span class="token string">&quot;user.order.cancel&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;ç”¨æˆ·å–æ¶ˆè®¢å•&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token punctuation">{</span><span class="token string">&quot;system.error&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;ç³»ç»Ÿé”™è¯¯&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token punctuation">{</span><span class="token string">&quot;user.login&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;ç”¨æˆ·ç™»å½•&quot;</span><span class="token punctuation">}</span></span>
<span class="line">            <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">            </span>
<span class="line">            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> msg <span class="token operator">:</span> messages<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                channel<span class="token punctuation">.</span><span class="token function">basicPublish</span><span class="token punctuation">(</span><span class="token constant">EXCHANGE_NAME</span><span class="token punctuation">,</span> msg<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> msg<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;å‘é€: [&quot;</span> <span class="token operator">+</span> msg<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">&quot;] &quot;</span> <span class="token operator">+</span> msg<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// æ¶ˆè´¹è€…ï¼ˆæ¥æ”¶æ‰€æœ‰userç›¸å…³æ¶ˆæ¯ï¼‰</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserConsumer</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">EXCHANGE_NAME</span> <span class="token operator">=</span> <span class="token string">&quot;topic_logs&quot;</span><span class="token punctuation">;</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">ConnectionFactory</span> factory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConnectionFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        factory<span class="token punctuation">.</span><span class="token function">setHost</span><span class="token punctuation">(</span><span class="token string">&quot;localhost&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        </span>
<span class="line">        <span class="token class-name">Connection</span> connection <span class="token operator">=</span> factory<span class="token punctuation">.</span><span class="token function">newConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token class-name">Channel</span> channel <span class="token operator">=</span> connection<span class="token punctuation">.</span><span class="token function">createChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        </span>
<span class="line">        channel<span class="token punctuation">.</span><span class="token function">exchangeDeclare</span><span class="token punctuation">(</span><span class="token constant">EXCHANGE_NAME</span><span class="token punctuation">,</span> <span class="token string">&quot;topic&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token class-name">String</span> queueName <span class="token operator">=</span> channel<span class="token punctuation">.</span><span class="token function">queueDeclare</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        </span>
<span class="line">        <span class="token comment">// ç»‘å®šæ‰€æœ‰userå¼€å¤´çš„æ¶ˆæ¯</span></span>
<span class="line">        channel<span class="token punctuation">.</span><span class="token function">queueBind</span><span class="token punctuation">(</span>queueName<span class="token punctuation">,</span> <span class="token constant">EXCHANGE_NAME</span><span class="token punctuation">,</span> <span class="token string">&quot;user.#&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        </span>
<span class="line">        <span class="token class-name">DeliverCallback</span> deliverCallback <span class="token operator">=</span> <span class="token punctuation">(</span>consumerTag<span class="token punctuation">,</span> delivery<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token class-name">String</span> routingKey <span class="token operator">=</span> delivery<span class="token punctuation">.</span><span class="token function">getEnvelope</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getRoutingKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token class-name">String</span> message <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>delivery<span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;UTF-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;æ”¶åˆ°: [&quot;</span> <span class="token operator">+</span> routingKey <span class="token operator">+</span> <span class="token string">&quot;] &quot;</span> <span class="token operator">+</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">        </span>
<span class="line">        channel<span class="token punctuation">.</span><span class="token function">basicConsume</span><span class="token punctuation">(</span>queueName<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> deliverCallback<span class="token punctuation">,</span> consumerTag <span class="token operator">-&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ğŸ“¦-mavenä¾èµ–" tabindex="-1"><a class="header-anchor" href="#ğŸ“¦-mavenä¾èµ–"><span>ğŸ“¦ Mavenä¾èµ–</span></a></h2><div class="language-xml line-numbers-mode" data-highlighter="prismjs" data-ext="xml" data-title="xml"><pre><code><span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.rabbitmq<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>amqp-client<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>5.18.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ğŸ’¡-æœ€ä½³å®è·µ" tabindex="-1"><a class="header-anchor" href="#ğŸ’¡-æœ€ä½³å®è·µ"><span>ğŸ’¡ æœ€ä½³å®è·µ</span></a></h2><ol><li><strong>ä½¿ç”¨è¿æ¥æ± </strong> - å¤ç”¨Connectionå’ŒChannel</li><li><strong>æ­£ç¡®å…³é—­èµ„æº</strong> - ä½¿ç”¨try-with-resources</li><li><strong>é€‰æ‹©åˆé€‚çš„äº¤æ¢æœºç±»å‹</strong> - æ ¹æ®ä¸šåŠ¡åœºæ™¯</li><li><strong>è®¾ç½®åˆç†çš„QoS</strong> - æ§åˆ¶æ¶ˆè´¹é€Ÿåº¦</li><li><strong>å¯ç”¨æ¶ˆæ¯ç¡®è®¤æœºåˆ¶</strong> - ä¿è¯æ¶ˆæ¯å¯é æ€§</li></ol><h2 id="ğŸ¯-å°ç»“" tabindex="-1"><a class="header-anchor" href="#ğŸ¯-å°ç»“"><span>ğŸ¯ å°ç»“</span></a></h2><p>æœ¬èŠ‚å­¦ä¹ äº†RabbitMQçš„åŸºç¡€çŸ¥è¯†ï¼š</p><ul><li>âœ… æ ¸å¿ƒæ¦‚å¿µï¼ˆExchangeã€Queueã€Bindingï¼‰</li><li>âœ… äº”ç§å·¥ä½œæ¨¡å¼åŠåº”ç”¨åœºæ™¯</li><li>âœ… Javaå®¢æˆ·ç«¯APIåŸºæœ¬ä½¿ç”¨</li><li>âœ… æ¶ˆæ¯çš„å‘é€å’Œæ¥æ”¶</li></ul><hr>`,79)),s("p",null,[n[1]||(n[1]=s("strong",null,"ä¸‹ä¸€èŠ‚ï¼š",-1)),n[2]||(n[2]=a()),l(p,{to:"/tutorials/java-backend/rabbitmq/02-RabbitMQ%E8%BF%9B%E9%98%B6%E7%89%B9%E6%80%A7.html"},{default:o(()=>[...n[0]||(n[0]=[a("02-RabbitMQè¿›é˜¶ç‰¹æ€§",-1)])]),_:1})])])}const m=t(r,[["render",k]]),b=JSON.parse('{"path":"/tutorials/java-backend/rabbitmq/01-RabbitMQjichurumen.html","title":"RabbitMQåŸºç¡€å…¥é—¨","lang":"zh-CN","frontmatter":{"title":"RabbitMQåŸºç¡€å…¥é—¨"},"headers":[{"level":2,"title":"ğŸ¯ å­¦ä¹ ç›®æ ‡","slug":"ğŸ¯-å­¦ä¹ ç›®æ ‡","link":"#ğŸ¯-å­¦ä¹ ç›®æ ‡","children":[]},{"level":2,"title":"ğŸ“– RabbitMQç®€ä»‹","slug":"ğŸ“–-rabbitmqç®€ä»‹","link":"#ğŸ“–-rabbitmqç®€ä»‹","children":[{"level":3,"title":"ä»€ä¹ˆæ˜¯RabbitMQï¼Ÿ","slug":"ä»€ä¹ˆæ˜¯rabbitmq","link":"#ä»€ä¹ˆæ˜¯rabbitmq","children":[]},{"level":3,"title":"æ ¸å¿ƒç‰¹ç‚¹","slug":"æ ¸å¿ƒç‰¹ç‚¹","link":"#æ ¸å¿ƒç‰¹ç‚¹","children":[]},{"level":3,"title":"åº”ç”¨åœºæ™¯","slug":"åº”ç”¨åœºæ™¯","link":"#åº”ç”¨åœºæ™¯","children":[]}]},{"level":2,"title":"ğŸ”§ å®‰è£…RabbitMQ","slug":"ğŸ”§-å®‰è£…rabbitmq","link":"#ğŸ”§-å®‰è£…rabbitmq","children":[{"level":3,"title":"Dockerå®‰è£…ï¼ˆæ¨èï¼‰","slug":"dockerå®‰è£…-æ¨è","link":"#dockerå®‰è£…-æ¨è","children":[]},{"level":3,"title":"Linuxå®‰è£…","slug":"linuxå®‰è£…","link":"#linuxå®‰è£…","children":[]},{"level":3,"title":"Windowså®‰è£…","slug":"windowså®‰è£…","link":"#windowså®‰è£…","children":[]}]},{"level":2,"title":"ğŸ—ï¸ æ ¸å¿ƒæ¦‚å¿µ","slug":"ğŸ—ï¸-æ ¸å¿ƒæ¦‚å¿µ","link":"#ğŸ—ï¸-æ ¸å¿ƒæ¦‚å¿µ","children":[{"level":3,"title":"AMQPåè®®","slug":"amqpåè®®","link":"#amqpåè®®","children":[]},{"level":3,"title":"æ ¸å¿ƒç»„ä»¶","slug":"æ ¸å¿ƒç»„ä»¶","link":"#æ ¸å¿ƒç»„ä»¶","children":[]}]},{"level":2,"title":"ğŸ¨ äº”ç§å·¥ä½œæ¨¡å¼","slug":"ğŸ¨-äº”ç§å·¥ä½œæ¨¡å¼","link":"#ğŸ¨-äº”ç§å·¥ä½œæ¨¡å¼","children":[{"level":3,"title":"1. Simpleï¼ˆç®€å•æ¨¡å¼ï¼‰","slug":"_1-simple-ç®€å•æ¨¡å¼","link":"#_1-simple-ç®€å•æ¨¡å¼","children":[]},{"level":3,"title":"2. Work Queueï¼ˆå·¥ä½œé˜Ÿåˆ—æ¨¡å¼ï¼‰","slug":"_2-work-queue-å·¥ä½œé˜Ÿåˆ—æ¨¡å¼","link":"#_2-work-queue-å·¥ä½œé˜Ÿåˆ—æ¨¡å¼","children":[]},{"level":3,"title":"3. Publish/Subscribeï¼ˆå‘å¸ƒè®¢é˜…æ¨¡å¼ï¼‰","slug":"_3-publish-subscribe-å‘å¸ƒè®¢é˜…æ¨¡å¼","link":"#_3-publish-subscribe-å‘å¸ƒè®¢é˜…æ¨¡å¼","children":[]},{"level":3,"title":"4. Routingï¼ˆè·¯ç”±æ¨¡å¼ï¼‰","slug":"_4-routing-è·¯ç”±æ¨¡å¼","link":"#_4-routing-è·¯ç”±æ¨¡å¼","children":[]},{"level":3,"title":"5. Topicï¼ˆä¸»é¢˜æ¨¡å¼ï¼‰","slug":"_5-topic-ä¸»é¢˜æ¨¡å¼","link":"#_5-topic-ä¸»é¢˜æ¨¡å¼","children":[]}]},{"level":2,"title":"ğŸ“¦ Mavenä¾èµ–","slug":"ğŸ“¦-mavenä¾èµ–","link":"#ğŸ“¦-mavenä¾èµ–","children":[]},{"level":2,"title":"ğŸ’¡ æœ€ä½³å®è·µ","slug":"ğŸ’¡-æœ€ä½³å®è·µ","link":"#ğŸ’¡-æœ€ä½³å®è·µ","children":[]},{"level":2,"title":"ğŸ¯ å°ç»“","slug":"ğŸ¯-å°ç»“","link":"#ğŸ¯-å°ç»“","children":[]}],"git":{"createdTime":1765249786000,"updatedTime":1765249786000,"contributors":[{"name":"CambridgeFoldingKnife","email":"3144253125@qq.com","commits":1}]},"filePathRelative":"tutorials/java-backend/rabbitmq/01-RabbitMQåŸºç¡€å…¥é—¨.md"}');export{m as comp,b as data};
