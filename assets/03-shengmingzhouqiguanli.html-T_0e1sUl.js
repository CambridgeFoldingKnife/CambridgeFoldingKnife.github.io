import{_ as c,c as i,d as o,e as s,f as a,b as p,w as u,r as e,o as k}from"./app-DyGs7pMe.js";const r={},d={href:"https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/uiability-lifecycle-0000001820999565-V5",target:"_blank",rel:"noopener noreferrer"};function v(m,n){const t=e("ExternalLinkIcon"),l=e("RouteLink");return k(),i("div",null,[n[4]||(n[4]=o(`<h1 id="ç”Ÿå‘½å‘¨æœŸç®¡ç†" tabindex="-1"><a class="header-anchor" href="#ç”Ÿå‘½å‘¨æœŸç®¡ç†"><span>ç”Ÿå‘½å‘¨æœŸç®¡ç†</span></a></h1><blockquote><p>æŒæ¡ Ability çš„ç”Ÿå‘½å‘¨æœŸ</p></blockquote><h2 id="ğŸ“Š-uiability-ç”Ÿå‘½å‘¨æœŸ" tabindex="-1"><a class="header-anchor" href="#ğŸ“Š-uiability-ç”Ÿå‘½å‘¨æœŸ"><span>ğŸ“Š UIAbility ç”Ÿå‘½å‘¨æœŸ</span></a></h2><h3 id="ç”Ÿå‘½å‘¨æœŸæµç¨‹" tabindex="-1"><a class="header-anchor" href="#ç”Ÿå‘½å‘¨æœŸæµç¨‹"><span>ç”Ÿå‘½å‘¨æœŸæµç¨‹</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">åˆ›å»º â†’ onCreate()</span>
<span class="line">  â†“</span>
<span class="line">çª—å£åˆ›å»º â†’ onWindowStageCreate()</span>
<span class="line">  â†“</span>
<span class="line">å‰å°æ˜¾ç¤º â†’ onForeground()</span>
<span class="line">  â†“</span>
<span class="line">åå°éšè— â†’ onBackground()</span>
<span class="line">  â†“</span>
<span class="line">çª—å£é”€æ¯ â†’ onWindowStageDestroy()</span>
<span class="line">  â†“</span>
<span class="line">é”€æ¯ â†’ onDestroy()</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="å®Œæ•´ç¤ºä¾‹" tabindex="-1"><a class="header-anchor" href="#å®Œæ•´ç¤ºä¾‹"><span>å®Œæ•´ç¤ºä¾‹</span></a></h3><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts" data-title="ts"><pre><code><span class="line"><span class="token keyword">import</span> UIAbility <span class="token keyword">from</span> <span class="token string">&#39;@ohos.app.ability.UIAbility&#39;</span></span>
<span class="line"><span class="token keyword">import</span> window <span class="token keyword">from</span> <span class="token string">&#39;@ohos.window&#39;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">EntryAbility</span> <span class="token keyword">extends</span> <span class="token class-name">UIAbility</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token comment">// 1. åˆ›å»º</span></span>
<span class="line">  <span class="token function">onCreate</span><span class="token punctuation">(</span>want<span class="token punctuation">,</span> launchParam<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;1. onCreate - Ability åˆ›å»º&#39;</span><span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment">// åˆå§‹åŒ–å…¨å±€æ•°æ®</span></span>
<span class="line">    AppStorage<span class="token punctuation">.</span><span class="token function">SetOrCreate</span><span class="token punctuation">(</span><span class="token string">&#39;appData&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span></span>
<span class="line">      isFirstLaunch<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line">      timestamp<span class="token operator">:</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  </span>
<span class="line">  <span class="token comment">// 2. çª—å£é˜¶æ®µåˆ›å»º</span></span>
<span class="line">  <span class="token function">onWindowStageCreate</span><span class="token punctuation">(</span>windowStage<span class="token operator">:</span> window<span class="token punctuation">.</span>WindowStage<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;2. onWindowStageCreate - çª—å£åˆ›å»º&#39;</span><span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment">// åŠ è½½ä¸»é¡µé¢</span></span>
<span class="line">    windowStage<span class="token punctuation">.</span><span class="token function">loadContent</span><span class="token punctuation">(</span><span class="token string">&#39;pages/Index&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>err<span class="token punctuation">,</span> data<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">.</span>code<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&#39;åŠ è½½é¡µé¢å¤±è´¥&#39;</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">return</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;åŠ è½½é¡µé¢æˆåŠŸ&#39;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  </span>
<span class="line">  <span class="token comment">// 3. åˆ‡æ¢åˆ°å‰å°</span></span>
<span class="line">  <span class="token function">onForeground</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;3. onForeground - è¿›å…¥å‰å°&#39;</span><span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment">// åˆ·æ–°æ•°æ®</span></span>
<span class="line">    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">refreshData</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment">// æ¢å¤åŠ¨ç”»</span></span>
<span class="line">    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">resumeAnimations</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  </span>
<span class="line">  <span class="token comment">// 4. åˆ‡æ¢åˆ°åå°</span></span>
<span class="line">  <span class="token function">onBackground</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;4. onBackground - è¿›å…¥åå°&#39;</span><span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment">// ä¿å­˜çŠ¶æ€</span></span>
<span class="line">    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">saveState</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment">// æš‚åœåŠ¨ç”»</span></span>
<span class="line">    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">pauseAnimations</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment">// é‡Šæ”¾èµ„æº</span></span>
<span class="line">    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">releaseResources</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  </span>
<span class="line">  <span class="token comment">// 5. çª—å£é˜¶æ®µé”€æ¯</span></span>
<span class="line">  <span class="token function">onWindowStageDestroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;5. onWindowStageDestroy - çª—å£é”€æ¯&#39;</span><span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment">// é‡Šæ”¾çª—å£ç›¸å…³èµ„æº</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  </span>
<span class="line">  <span class="token comment">// 6. é”€æ¯</span></span>
<span class="line">  <span class="token function">onDestroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;6. onDestroy - Ability é”€æ¯&#39;</span><span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment">// æ¸…ç†å®šæ—¶å™¨</span></span>
<span class="line">    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">clearTimers</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment">// å–æ¶ˆç›‘å¬</span></span>
<span class="line">    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">unsubscribeEvents</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment">// é‡Šæ”¾æ‰€æœ‰èµ„æº</span></span>
<span class="line">    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">cleanup</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  </span>
<span class="line">  <span class="token keyword">private</span> <span class="token function">refreshData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;åˆ·æ–°æ•°æ®&#39;</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  </span>
<span class="line">  <span class="token keyword">private</span> <span class="token function">resumeAnimations</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;æ¢å¤åŠ¨ç”»&#39;</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  </span>
<span class="line">  <span class="token keyword">private</span> <span class="token function">saveState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;ä¿å­˜çŠ¶æ€&#39;</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  </span>
<span class="line">  <span class="token keyword">private</span> <span class="token function">pauseAnimations</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;æš‚åœåŠ¨ç”»&#39;</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  </span>
<span class="line">  <span class="token keyword">private</span> <span class="token function">releaseResources</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;é‡Šæ”¾èµ„æº&#39;</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  </span>
<span class="line">  <span class="token keyword">private</span> <span class="token function">clearTimers</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;æ¸…ç†å®šæ—¶å™¨&#39;</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  </span>
<span class="line">  <span class="token keyword">private</span> <span class="token function">unsubscribeEvents</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;å–æ¶ˆç›‘å¬&#39;</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  </span>
<span class="line">  <span class="token keyword">private</span> <span class="token function">cleanup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;æ¸…ç†èµ„æº&#39;</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ğŸ’¾-çŠ¶æ€ä¿å­˜ä¸æ¢å¤" tabindex="-1"><a class="header-anchor" href="#ğŸ’¾-çŠ¶æ€ä¿å­˜ä¸æ¢å¤"><span>ğŸ’¾ çŠ¶æ€ä¿å­˜ä¸æ¢å¤</span></a></h2><h3 id="ä¿å­˜çŠ¶æ€" tabindex="-1"><a class="header-anchor" href="#ä¿å­˜çŠ¶æ€"><span>ä¿å­˜çŠ¶æ€</span></a></h3><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts" data-title="ts"><pre><code><span class="line"><span class="token keyword">import</span> UIAbility <span class="token keyword">from</span> <span class="token string">&#39;@ohos.app.ability.UIAbility&#39;</span></span>
<span class="line"><span class="token keyword">import</span> AbilityConstant <span class="token keyword">from</span> <span class="token string">&#39;@ohos.app.ability.AbilityConstant&#39;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">DataAbility</span> <span class="token keyword">extends</span> <span class="token class-name">UIAbility</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">private</span> userData<span class="token operator">:</span> UserData <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">    scrollPosition<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span></span>
<span class="line">    selectedTab<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span></span>
<span class="line">    formData<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  </span>
<span class="line">  <span class="token comment">// ä¿å­˜çŠ¶æ€</span></span>
<span class="line">  <span class="token function">onBackground</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// ä¿å­˜åˆ°æœ¬åœ°</span></span>
<span class="line">    PersistentStorage<span class="token punctuation">.</span><span class="token function">PersistProp</span><span class="token punctuation">(</span><span class="token string">&#39;userData&#39;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>userData<span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;çŠ¶æ€å·²ä¿å­˜&#39;</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  </span>
<span class="line">  <span class="token comment">// æ¢å¤çŠ¶æ€</span></span>
<span class="line">  <span class="token function">onCreate</span><span class="token punctuation">(</span>want<span class="token punctuation">,</span> launchParam<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>launchParam<span class="token punctuation">.</span>launchReason <span class="token operator">===</span> AbilityConstant<span class="token punctuation">.</span>LaunchReason<span class="token punctuation">.</span><span class="token constant">CONTINUATION</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token comment">// ä»æŒä¹…åŒ–å­˜å‚¨æ¢å¤</span></span>
<span class="line">      <span class="token keyword">const</span> saved <span class="token operator">=</span> AppStorage<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token string">&#39;userData&#39;</span><span class="token punctuation">)</span></span>
<span class="line">      <span class="token keyword">if</span> <span class="token punctuation">(</span>saved<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>userData <span class="token operator">=</span> saved</span>
<span class="line">        <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;çŠ¶æ€å·²æ¢å¤&#39;</span><span class="token punctuation">)</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="æ•°æ®æŒä¹…åŒ–" tabindex="-1"><a class="header-anchor" href="#æ•°æ®æŒä¹…åŒ–"><span>æ•°æ®æŒä¹…åŒ–</span></a></h3><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts" data-title="ts"><pre><code><span class="line"><span class="token keyword">import</span> preferences <span class="token keyword">from</span> <span class="token string">&#39;@ohos.data.preferences&#39;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">PersistentAbility</span> <span class="token keyword">extends</span> <span class="token class-name">UIAbility</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">private</span> dataPreferences<span class="token operator">:</span> preferences<span class="token punctuation">.</span>Preferences</span>
<span class="line">  </span>
<span class="line">  <span class="token keyword">async</span> <span class="token function">onCreate</span><span class="token punctuation">(</span>want<span class="token punctuation">,</span> launchParam<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// è·å– preferences å®ä¾‹</span></span>
<span class="line">    <span class="token keyword">this</span><span class="token punctuation">.</span>dataPreferences <span class="token operator">=</span> <span class="token keyword">await</span> preferences<span class="token punctuation">.</span><span class="token function">getPreferences</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">,</span> <span class="token string">&#39;myData&#39;</span><span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment">// æ¢å¤æ•°æ®</span></span>
<span class="line">    <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">restoreData</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  </span>
<span class="line">  <span class="token keyword">async</span> <span class="token function">restoreData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> userData <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>dataPreferences<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#39;user&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>userData<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      AppStorage<span class="token punctuation">.</span><span class="token function">SetOrCreate</span><span class="token punctuation">(</span><span class="token string">&#39;currentUser&#39;</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>userData <span class="token keyword">as</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  </span>
<span class="line">  <span class="token keyword">async</span> <span class="token function">onBackground</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// ä¿å­˜æ•°æ®</span></span>
<span class="line">    <span class="token keyword">const</span> user <span class="token operator">=</span> AppStorage<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token string">&#39;currentUser&#39;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>user<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>dataPreferences<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&#39;user&#39;</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">      <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>dataPreferences<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  </span>
<span class="line">  <span class="token keyword">async</span> <span class="token function">onDestroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// æ¸…ç† preferences</span></span>
<span class="line">    <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>dataPreferences<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="â±ï¸-åå°ä»»åŠ¡ç®¡ç†" tabindex="-1"><a class="header-anchor" href="#â±ï¸-åå°ä»»åŠ¡ç®¡ç†"><span>â±ï¸ åå°ä»»åŠ¡ç®¡ç†</span></a></h2><h3 id="é•¿æ—¶ä»»åŠ¡" tabindex="-1"><a class="header-anchor" href="#é•¿æ—¶ä»»åŠ¡"><span>é•¿æ—¶ä»»åŠ¡</span></a></h3><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts" data-title="ts"><pre><code><span class="line"><span class="token keyword">import</span> backgroundTaskManager <span class="token keyword">from</span> <span class="token string">&#39;@ohos.resourceschedule.backgroundTaskManager&#39;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">BackgroundTaskAbility</span> <span class="token keyword">extends</span> <span class="token class-name">UIAbility</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">private</span> bgTaskId<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">=</span> <span class="token number">0</span></span>
<span class="line">  </span>
<span class="line">  <span class="token keyword">async</span> <span class="token function">onBackground</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// ç”³è¯·é•¿æ—¶ä»»åŠ¡</span></span>
<span class="line">    <span class="token keyword">const</span> taskParam <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">      bgMode<span class="token operator">:</span> backgroundTaskManager<span class="token punctuation">.</span>BackgroundMode<span class="token punctuation">.</span><span class="token constant">DATA_TRANSFER</span><span class="token punctuation">,</span></span>
<span class="line">      wantAgent<span class="token operator">:</span> <span class="token keyword">null</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">this</span><span class="token punctuation">.</span>bgTaskId <span class="token operator">=</span> <span class="token keyword">await</span> backgroundTaskManager<span class="token punctuation">.</span><span class="token function">startBackgroundRunning</span><span class="token punctuation">(</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">,</span></span>
<span class="line">        taskParam</span>
<span class="line">      <span class="token punctuation">)</span></span>
<span class="line">      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;é•¿æ—¶ä»»åŠ¡å·²å¼€å§‹&#39;</span><span class="token punctuation">)</span></span>
<span class="line">      </span>
<span class="line">      <span class="token comment">// æ‰§è¡Œåå°ä»»åŠ¡</span></span>
<span class="line">      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">performBackgroundTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&#39;å¯åŠ¨é•¿æ—¶ä»»åŠ¡å¤±è´¥:&#39;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  </span>
<span class="line">  <span class="token keyword">async</span> <span class="token function">onDestroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// åœæ­¢é•¿æ—¶ä»»åŠ¡</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>bgTaskId<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">await</span> backgroundTaskManager<span class="token punctuation">.</span><span class="token function">stopBackgroundRunning</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">)</span></span>
<span class="line">      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;é•¿æ—¶ä»»åŠ¡å·²åœæ­¢&#39;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  </span>
<span class="line">  <span class="token keyword">private</span> <span class="token keyword">async</span> <span class="token function">performBackgroundTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// æ‰§è¡Œæ•°æ®ä¼ è¾“ç­‰åå°ä»»åŠ¡</span></span>
<span class="line">    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;æ‰§è¡Œåå°ä»»åŠ¡&#39;</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="å»¶è¿Ÿä»»åŠ¡" tabindex="-1"><a class="header-anchor" href="#å»¶è¿Ÿä»»åŠ¡"><span>å»¶è¿Ÿä»»åŠ¡</span></a></h3><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts" data-title="ts"><pre><code><span class="line"><span class="token keyword">import</span> workScheduler <span class="token keyword">from</span> <span class="token string">&#39;@ohos.resourceschedule.workScheduler&#39;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">ScheduledTaskAbility</span> <span class="token keyword">extends</span> <span class="token class-name">UIAbility</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token function">onCreate</span><span class="token punctuation">(</span>want<span class="token punctuation">,</span> launchParam<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// æ³¨å†Œå»¶è¿Ÿä»»åŠ¡</span></span>
<span class="line">    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">scheduleWork</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  </span>
<span class="line">  <span class="token function">scheduleWork</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> workInfo <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">      workId<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span></span>
<span class="line">      networkType<span class="token operator">:</span> workScheduler<span class="token punctuation">.</span>NetworkType<span class="token punctuation">.</span><span class="token constant">NETWORK_TYPE_WIFI</span><span class="token punctuation">,</span></span>
<span class="line">      isCharging<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span></span>
<span class="line">      isPersisted<span class="token operator">:</span> <span class="token boolean">true</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    </span>
<span class="line">    workScheduler<span class="token punctuation">.</span><span class="token function">startWork</span><span class="token punctuation">(</span>workInfo<span class="token punctuation">)</span></span>
<span class="line">      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;å»¶è¿Ÿä»»åŠ¡å·²æ³¨å†Œ&#39;</span><span class="token punctuation">)</span></span>
<span class="line">      <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">      <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&#39;æ³¨å†Œå¤±è´¥:&#39;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span></span>
<span class="line">      <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  </span>
<span class="line">  <span class="token function">onDestroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// å–æ¶ˆå»¶è¿Ÿä»»åŠ¡</span></span>
<span class="line">    workScheduler<span class="token punctuation">.</span><span class="token function">stopWork</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ğŸ§¹-å†…å­˜ç®¡ç†" tabindex="-1"><a class="header-anchor" href="#ğŸ§¹-å†…å­˜ç®¡ç†"><span>ğŸ§¹ å†…å­˜ç®¡ç†</span></a></h2><h3 id="å†…å­˜è­¦å‘Šå¤„ç†" tabindex="-1"><a class="header-anchor" href="#å†…å­˜è­¦å‘Šå¤„ç†"><span>å†…å­˜è­¦å‘Šå¤„ç†</span></a></h3><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts" data-title="ts"><pre><code><span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">MemoryAwareAbility</span> <span class="token keyword">extends</span> <span class="token class-name">UIAbility</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">private</span> largeDataCache<span class="token operator">:</span> Map<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">any</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">  </span>
<span class="line">  <span class="token function">onCreate</span><span class="token punctuation">(</span>want<span class="token punctuation">,</span> launchParam<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// ç›‘å¬å†…å­˜è­¦å‘Š</span></span>
<span class="line">    <span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span><span class="token function">getApplicationContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;memoryLevel&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>level<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;å†…å­˜è­¦å‘Šçº§åˆ«:&#39;</span><span class="token punctuation">,</span> level<span class="token punctuation">)</span></span>
<span class="line">      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handleMemoryWarning</span><span class="token punctuation">(</span>level<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  </span>
<span class="line">  <span class="token function">handleMemoryWarning</span><span class="token punctuation">(</span>level<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>level <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token comment">// å†…å­˜æ­£å¸¸</span></span>
<span class="line">      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;å†…å­˜æ­£å¸¸&#39;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>level <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token comment">// å†…å­˜åä½ - æ¸…ç†éƒ¨åˆ†ç¼“å­˜</span></span>
<span class="line">      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;æ¸…ç†éƒ¨åˆ†ç¼“å­˜&#39;</span><span class="token punctuation">)</span></span>
<span class="line">      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">clearPartialCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>level <span class="token operator">===</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token comment">// å†…å­˜ä¸¥é‡ä¸è¶³ - æ¸…ç†æ‰€æœ‰ç¼“å­˜</span></span>
<span class="line">      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;æ¸…ç†æ‰€æœ‰ç¼“å­˜&#39;</span><span class="token punctuation">)</span></span>
<span class="line">      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">clearAllCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  </span>
<span class="line">  <span class="token function">clearPartialCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// æ¸…ç†50%çš„ç¼“å­˜</span></span>
<span class="line">    <span class="token keyword">const</span> keysToDelete <span class="token operator">=</span> <span class="token builtin">Array</span><span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>largeDataCache<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>largeDataCache<span class="token punctuation">.</span>size <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span></span>
<span class="line">    keysToDelete<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>key <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>largeDataCache<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  </span>
<span class="line">  <span class="token function">clearAllCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// æ¸…ç†æ‰€æœ‰ç¼“å­˜</span></span>
<span class="line">    <span class="token keyword">this</span><span class="token punctuation">.</span>largeDataCache<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  </span>
<span class="line">  <span class="token function">onDestroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// å–æ¶ˆç›‘å¬</span></span>
<span class="line">    <span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span><span class="token function">getApplicationContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">off</span><span class="token punctuation">(</span><span class="token string">&#39;memoryLevel&#39;</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ğŸ’¡-æœ€ä½³å®è·µ" tabindex="-1"><a class="header-anchor" href="#ğŸ’¡-æœ€ä½³å®è·µ"><span>ğŸ’¡ æœ€ä½³å®è·µ</span></a></h2><h3 id="_1-åŠæ—¶æ¸…ç†èµ„æº" tabindex="-1"><a class="header-anchor" href="#_1-åŠæ—¶æ¸…ç†èµ„æº"><span>1. åŠæ—¶æ¸…ç†èµ„æº</span></a></h3><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts" data-title="ts"><pre><code><span class="line"><span class="token function">onBackground</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token comment">// âœ… æš‚åœåŠ¨ç”»</span></span>
<span class="line">  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">stopAnimations</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">  </span>
<span class="line">  <span class="token comment">// âœ… æ¸…ç†å®šæ—¶å™¨</span></span>
<span class="line">  <span class="token function">clearInterval</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>timer<span class="token punctuation">)</span></span>
<span class="line">  </span>
<span class="line">  <span class="token comment">// âœ… é‡Šæ”¾å¤§å¯¹è±¡</span></span>
<span class="line">  <span class="token keyword">this</span><span class="token punctuation">.</span>largeData <span class="token operator">=</span> <span class="token keyword">null</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-åˆç†ä½¿ç”¨ç”Ÿå‘½å‘¨æœŸ" tabindex="-1"><a class="header-anchor" href="#_2-åˆç†ä½¿ç”¨ç”Ÿå‘½å‘¨æœŸ"><span>2. åˆç†ä½¿ç”¨ç”Ÿå‘½å‘¨æœŸ</span></a></h3><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts" data-title="ts"><pre><code><span class="line"><span class="token comment">// âœ… onCreate - ä¸€æ¬¡æ€§åˆå§‹åŒ–</span></span>
<span class="line"><span class="token function">onCreate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">initDatabase</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setupEventListeners</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// âœ… onForeground - åˆ·æ–°æ•°æ®</span></span>
<span class="line"><span class="token function">onForeground</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">refreshUserData</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// âœ… onBackground - ä¿å­˜çŠ¶æ€</span></span>
<span class="line"><span class="token function">onBackground</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">saveCurrentState</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-å¼‚å¸¸å¤„ç†" tabindex="-1"><a class="header-anchor" href="#_3-å¼‚å¸¸å¤„ç†"><span>3. å¼‚å¸¸å¤„ç†</span></a></h3><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts" data-title="ts"><pre><code><span class="line"><span class="token function">onCreate</span><span class="token punctuation">(</span>want<span class="token punctuation">,</span> launchParam<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">initialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&#39;åˆå§‹åŒ–å¤±è´¥:&#39;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span></span>
<span class="line">    <span class="token comment">// é™çº§å¤„ç†</span></span>
<span class="line">    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">fallbackInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ğŸ“š-å‚è€ƒèµ„æº" tabindex="-1"><a class="header-anchor" href="#ğŸ“š-å‚è€ƒèµ„æº"><span>ğŸ“š å‚è€ƒèµ„æº</span></a></h2>`,28)),s("ul",null,[s("li",null,[s("a",d,[n[0]||(n[0]=a("Ability ç”Ÿå‘½å‘¨æœŸ",-1)),p(t)])])]),n[5]||(n[5]=s("hr",null,null,-1)),s("p",null,[n[2]||(n[2]=s("strong",null,"ä¸‹ä¸€èŠ‚",-1)),n[3]||(n[3]=a(" â†’ ",-1)),p(l,{to:"/tutorials/harmonyos-dev/05-ability-framework/04-%E8%BF%9B%E7%A8%8B%E6%A8%A1%E5%9E%8B.html"},{default:u(()=>[...n[1]||(n[1]=[a("è¿›ç¨‹æ¨¡å‹",-1)])]),_:1})])])}const h=c(r,[["render",v]]),y=JSON.parse('{"path":"/tutorials/harmonyos-dev/05-ability-framework/03-shengmingzhouqiguanli.html","title":"ç”Ÿå‘½å‘¨æœŸç®¡ç†","lang":"zh-CN","frontmatter":{"title":"ç”Ÿå‘½å‘¨æœŸç®¡ç†","date":"2025-01-22T00:00:00.000Z"},"headers":[{"level":2,"title":"ğŸ“Š UIAbility ç”Ÿå‘½å‘¨æœŸ","slug":"ğŸ“Š-uiability-ç”Ÿå‘½å‘¨æœŸ","link":"#ğŸ“Š-uiability-ç”Ÿå‘½å‘¨æœŸ","children":[{"level":3,"title":"ç”Ÿå‘½å‘¨æœŸæµç¨‹","slug":"ç”Ÿå‘½å‘¨æœŸæµç¨‹","link":"#ç”Ÿå‘½å‘¨æœŸæµç¨‹","children":[]},{"level":3,"title":"å®Œæ•´ç¤ºä¾‹","slug":"å®Œæ•´ç¤ºä¾‹","link":"#å®Œæ•´ç¤ºä¾‹","children":[]}]},{"level":2,"title":"ğŸ’¾ çŠ¶æ€ä¿å­˜ä¸æ¢å¤","slug":"ğŸ’¾-çŠ¶æ€ä¿å­˜ä¸æ¢å¤","link":"#ğŸ’¾-çŠ¶æ€ä¿å­˜ä¸æ¢å¤","children":[{"level":3,"title":"ä¿å­˜çŠ¶æ€","slug":"ä¿å­˜çŠ¶æ€","link":"#ä¿å­˜çŠ¶æ€","children":[]},{"level":3,"title":"æ•°æ®æŒä¹…åŒ–","slug":"æ•°æ®æŒä¹…åŒ–","link":"#æ•°æ®æŒä¹…åŒ–","children":[]}]},{"level":2,"title":"â±ï¸ åå°ä»»åŠ¡ç®¡ç†","slug":"â±ï¸-åå°ä»»åŠ¡ç®¡ç†","link":"#â±ï¸-åå°ä»»åŠ¡ç®¡ç†","children":[{"level":3,"title":"é•¿æ—¶ä»»åŠ¡","slug":"é•¿æ—¶ä»»åŠ¡","link":"#é•¿æ—¶ä»»åŠ¡","children":[]},{"level":3,"title":"å»¶è¿Ÿä»»åŠ¡","slug":"å»¶è¿Ÿä»»åŠ¡","link":"#å»¶è¿Ÿä»»åŠ¡","children":[]}]},{"level":2,"title":"ğŸ§¹ å†…å­˜ç®¡ç†","slug":"ğŸ§¹-å†…å­˜ç®¡ç†","link":"#ğŸ§¹-å†…å­˜ç®¡ç†","children":[{"level":3,"title":"å†…å­˜è­¦å‘Šå¤„ç†","slug":"å†…å­˜è­¦å‘Šå¤„ç†","link":"#å†…å­˜è­¦å‘Šå¤„ç†","children":[]}]},{"level":2,"title":"ğŸ’¡ æœ€ä½³å®è·µ","slug":"ğŸ’¡-æœ€ä½³å®è·µ","link":"#ğŸ’¡-æœ€ä½³å®è·µ","children":[{"level":3,"title":"1. åŠæ—¶æ¸…ç†èµ„æº","slug":"_1-åŠæ—¶æ¸…ç†èµ„æº","link":"#_1-åŠæ—¶æ¸…ç†èµ„æº","children":[]},{"level":3,"title":"2. åˆç†ä½¿ç”¨ç”Ÿå‘½å‘¨æœŸ","slug":"_2-åˆç†ä½¿ç”¨ç”Ÿå‘½å‘¨æœŸ","link":"#_2-åˆç†ä½¿ç”¨ç”Ÿå‘½å‘¨æœŸ","children":[]},{"level":3,"title":"3. å¼‚å¸¸å¤„ç†","slug":"_3-å¼‚å¸¸å¤„ç†","link":"#_3-å¼‚å¸¸å¤„ç†","children":[]}]},{"level":2,"title":"ğŸ“š å‚è€ƒèµ„æº","slug":"ğŸ“š-å‚è€ƒèµ„æº","link":"#ğŸ“š-å‚è€ƒèµ„æº","children":[]}],"git":{"createdTime":1765250065000,"updatedTime":1765250065000,"contributors":[{"name":"CambridgeFoldingKnife","email":"3144253125@qq.com","commits":1}]},"filePathRelative":"tutorials/harmonyos-dev/05-ability-framework/03-ç”Ÿå‘½å‘¨æœŸç®¡ç†.md"}');export{h as comp,y as data};
