import{_ as l,c as o,d as i,e as s,f as a,b as p,w as u,r as e,o as k}from"./app-D9dfRPMK.js";const r={},d={href:"https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/huks-guidelines-0000001821000685-V5",target:"_blank",rel:"noopener noreferrer"},v={href:"https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/data-security-protection-0000001774121022-V5",target:"_blank",rel:"noopener noreferrer"};function m(b,n){const t=e("ExternalLinkIcon"),c=e("RouteLink");return k(),o("div",null,[n[5]||(n[5]=i(`<h1 id="æ•°æ®åŠ å¯†ä¸å­˜å‚¨" tabindex="-1"><a class="header-anchor" href="#æ•°æ®åŠ å¯†ä¸å­˜å‚¨"><span>æ•°æ®åŠ å¯†ä¸å­˜å‚¨</span></a></h1><blockquote><p>ä¿æŠ¤æ•æ„Ÿæ•°æ®å®‰å…¨</p></blockquote><h2 id="ğŸ”-æ•°æ®åŠ å¯†" tabindex="-1"><a class="header-anchor" href="#ğŸ”-æ•°æ®åŠ å¯†"><span>ğŸ” æ•°æ®åŠ å¯†</span></a></h2><h3 id="huks-å¯†é’¥ç®¡ç†" tabindex="-1"><a class="header-anchor" href="#huks-å¯†é’¥ç®¡ç†"><span>HUKS å¯†é’¥ç®¡ç†</span></a></h3><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts" data-title="ts"><pre><code><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> huks <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@kit.UniversalKeystoreKit&#39;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">EncryptionService</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">private</span> keyAlias<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">=</span> <span class="token string">&#39;user_data_key&#39;</span></span>
<span class="line">  </span>
<span class="line">  <span class="token comment">// ç”Ÿæˆå¯†é’¥</span></span>
<span class="line">  <span class="token keyword">async</span> <span class="token function">generateKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> properties<span class="token operator">:</span> huks<span class="token punctuation">.</span>HuksOptions <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">      properties<span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">        <span class="token punctuation">{</span></span>
<span class="line">          tag<span class="token operator">:</span> huks<span class="token punctuation">.</span>HuksTag<span class="token punctuation">.</span><span class="token constant">HUKS_TAG_ALGORITHM</span><span class="token punctuation">,</span></span>
<span class="line">          value<span class="token operator">:</span> huks<span class="token punctuation">.</span>HuksKeyAlg<span class="token punctuation">.</span><span class="token constant">HUKS_ALG_AES</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token punctuation">{</span></span>
<span class="line">          tag<span class="token operator">:</span> huks<span class="token punctuation">.</span>HuksTag<span class="token punctuation">.</span><span class="token constant">HUKS_TAG_KEY_SIZE</span><span class="token punctuation">,</span></span>
<span class="line">          value<span class="token operator">:</span> huks<span class="token punctuation">.</span>HuksKeySize<span class="token punctuation">.</span><span class="token constant">HUKS_AES_KEY_SIZE_256</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token punctuation">{</span></span>
<span class="line">          tag<span class="token operator">:</span> huks<span class="token punctuation">.</span>HuksTag<span class="token punctuation">.</span><span class="token constant">HUKS_TAG_PURPOSE</span><span class="token punctuation">,</span></span>
<span class="line">          value<span class="token operator">:</span> huks<span class="token punctuation">.</span>HuksKeyPurpose<span class="token punctuation">.</span><span class="token constant">HUKS_KEY_PURPOSE_ENCRYPT</span> <span class="token operator">|</span></span>
<span class="line">                 huks<span class="token punctuation">.</span>HuksKeyPurpose<span class="token punctuation">.</span><span class="token constant">HUKS_KEY_PURPOSE_DECRYPT</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">      <span class="token punctuation">]</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">await</span> huks<span class="token punctuation">.</span><span class="token function">generateKeyItem</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>keyAlias<span class="token punctuation">,</span> properties<span class="token punctuation">)</span></span>
<span class="line">      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;å¯†é’¥ç”ŸæˆæˆåŠŸ&#39;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&#39;å¯†é’¥ç”Ÿæˆå¤±è´¥:&#39;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  </span>
<span class="line">  <span class="token comment">// åŠ å¯†æ•°æ®</span></span>
<span class="line">  <span class="token keyword">async</span> <span class="token function">encrypt</span><span class="token punctuation">(</span>plainText<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> textEncoder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">util</span><span class="token punctuation">.</span><span class="token function">TextEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">const</span> plainData <span class="token operator">=</span> textEncoder<span class="token punctuation">.</span><span class="token function">encodeInto</span><span class="token punctuation">(</span>plainText<span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">const</span> encryptOptions<span class="token operator">:</span> huks<span class="token punctuation">.</span>HuksOptions <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">      properties<span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">        <span class="token punctuation">{</span></span>
<span class="line">          tag<span class="token operator">:</span> huks<span class="token punctuation">.</span>HuksTag<span class="token punctuation">.</span><span class="token constant">HUKS_TAG_ALGORITHM</span><span class="token punctuation">,</span></span>
<span class="line">          value<span class="token operator">:</span> huks<span class="token punctuation">.</span>HuksKeyAlg<span class="token punctuation">.</span><span class="token constant">HUKS_ALG_AES</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token punctuation">{</span></span>
<span class="line">          tag<span class="token operator">:</span> huks<span class="token punctuation">.</span>HuksTag<span class="token punctuation">.</span><span class="token constant">HUKS_TAG_PURPOSE</span><span class="token punctuation">,</span></span>
<span class="line">          value<span class="token operator">:</span> huks<span class="token punctuation">.</span>HuksKeyPurpose<span class="token punctuation">.</span><span class="token constant">HUKS_KEY_PURPOSE_ENCRYPT</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token punctuation">{</span></span>
<span class="line">          tag<span class="token operator">:</span> huks<span class="token punctuation">.</span>HuksTag<span class="token punctuation">.</span><span class="token constant">HUKS_TAG_BLOCK_MODE</span><span class="token punctuation">,</span></span>
<span class="line">          value<span class="token operator">:</span> huks<span class="token punctuation">.</span>HuksTagBlockMode<span class="token punctuation">.</span><span class="token constant">HUKS_TAG_BLOCK_MODE_CBC</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token punctuation">{</span></span>
<span class="line">          tag<span class="token operator">:</span> huks<span class="token punctuation">.</span>HuksTag<span class="token punctuation">.</span><span class="token constant">HUKS_TAG_PADDING</span><span class="token punctuation">,</span></span>
<span class="line">          value<span class="token operator">:</span> huks<span class="token punctuation">.</span>HuksKeyPadding<span class="token punctuation">.</span><span class="token constant">HUKS_PADDING_PKCS7</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">      <span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">      inData<span class="token operator">:</span> plainData</span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">const</span> handle <span class="token operator">=</span> <span class="token keyword">await</span> huks<span class="token punctuation">.</span><span class="token function">initSession</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>keyAlias<span class="token punctuation">,</span> encryptOptions<span class="token punctuation">)</span></span>
<span class="line">      <span class="token keyword">const</span> encrypted <span class="token operator">=</span> <span class="token keyword">await</span> huks<span class="token punctuation">.</span><span class="token function">finishSession</span><span class="token punctuation">(</span>handle<span class="token punctuation">,</span> encryptOptions<span class="token punctuation">)</span></span>
<span class="line">      </span>
<span class="line">      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">arrayBufferToBase64</span><span class="token punctuation">(</span>encrypted<span class="token punctuation">.</span>outData<span class="token operator">!</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&#39;åŠ å¯†å¤±è´¥:&#39;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span></span>
<span class="line">      <span class="token keyword">throw</span> err</span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  </span>
<span class="line">  <span class="token comment">// è§£å¯†æ•°æ®</span></span>
<span class="line">  <span class="token keyword">async</span> <span class="token function">decrypt</span><span class="token punctuation">(</span>encryptedText<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> encryptedData <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">base64ToArrayBuffer</span><span class="token punctuation">(</span>encryptedText<span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">const</span> decryptOptions<span class="token operator">:</span> huks<span class="token punctuation">.</span>HuksOptions <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">      properties<span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">        <span class="token punctuation">{</span></span>
<span class="line">          tag<span class="token operator">:</span> huks<span class="token punctuation">.</span>HuksTag<span class="token punctuation">.</span><span class="token constant">HUKS_TAG_ALGORITHM</span><span class="token punctuation">,</span></span>
<span class="line">          value<span class="token operator">:</span> huks<span class="token punctuation">.</span>HuksKeyAlg<span class="token punctuation">.</span><span class="token constant">HUKS_ALG_AES</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token punctuation">{</span></span>
<span class="line">          tag<span class="token operator">:</span> huks<span class="token punctuation">.</span>HuksTag<span class="token punctuation">.</span><span class="token constant">HUKS_TAG_PURPOSE</span><span class="token punctuation">,</span></span>
<span class="line">          value<span class="token operator">:</span> huks<span class="token punctuation">.</span>HuksKeyPurpose<span class="token punctuation">.</span><span class="token constant">HUKS_KEY_PURPOSE_DECRYPT</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token punctuation">{</span></span>
<span class="line">          tag<span class="token operator">:</span> huks<span class="token punctuation">.</span>HuksTag<span class="token punctuation">.</span><span class="token constant">HUKS_TAG_BLOCK_MODE</span><span class="token punctuation">,</span></span>
<span class="line">          value<span class="token operator">:</span> huks<span class="token punctuation">.</span>HuksTagBlockMode<span class="token punctuation">.</span><span class="token constant">HUKS_TAG_BLOCK_MODE_CBC</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token punctuation">{</span></span>
<span class="line">          tag<span class="token operator">:</span> huks<span class="token punctuation">.</span>HuksTag<span class="token punctuation">.</span><span class="token constant">HUKS_TAG_PADDING</span><span class="token punctuation">,</span></span>
<span class="line">          value<span class="token operator">:</span> huks<span class="token punctuation">.</span>HuksKeyPadding<span class="token punctuation">.</span><span class="token constant">HUKS_PADDING_PKCS7</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">      <span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">      inData<span class="token operator">:</span> encryptedData</span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">const</span> handle <span class="token operator">=</span> <span class="token keyword">await</span> huks<span class="token punctuation">.</span><span class="token function">initSession</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>keyAlias<span class="token punctuation">,</span> decryptOptions<span class="token punctuation">)</span></span>
<span class="line">      <span class="token keyword">const</span> decrypted <span class="token operator">=</span> <span class="token keyword">await</span> huks<span class="token punctuation">.</span><span class="token function">finishSession</span><span class="token punctuation">(</span>handle<span class="token punctuation">,</span> decryptOptions<span class="token punctuation">)</span></span>
<span class="line">      </span>
<span class="line">      <span class="token keyword">const</span> textDecoder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">util</span><span class="token punctuation">.</span><span class="token function">TextDecoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">      <span class="token keyword">return</span> textDecoder<span class="token punctuation">.</span><span class="token function">decodeWithStream</span><span class="token punctuation">(</span>decrypted<span class="token punctuation">.</span>outData<span class="token operator">!</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&#39;è§£å¯†å¤±è´¥:&#39;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span></span>
<span class="line">      <span class="token keyword">throw</span> err</span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  </span>
<span class="line">  <span class="token comment">// åˆ é™¤å¯†é’¥</span></span>
<span class="line">  <span class="token keyword">async</span> <span class="token function">deleteKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">await</span> huks<span class="token punctuation">.</span><span class="token function">deleteKeyItem</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>keyAlias<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;å¯†é’¥åˆ é™¤æˆåŠŸ&#39;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&#39;å¯†é’¥åˆ é™¤å¤±è´¥:&#39;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  </span>
<span class="line">  <span class="token keyword">private</span> <span class="token function">arrayBufferToBase64</span><span class="token punctuation">(</span>buffer<span class="token operator">:</span> ArrayBuffer<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> bytes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">let</span> binary <span class="token operator">=</span> <span class="token string">&#39;&#39;</span></span>
<span class="line">    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> bytes<span class="token punctuation">.</span>byteLength<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      binary <span class="token operator">+=</span> String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span>bytes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token function">btoa</span><span class="token punctuation">(</span>binary<span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  </span>
<span class="line">  <span class="token keyword">private</span> <span class="token function">base64ToArrayBuffer</span><span class="token punctuation">(</span>base64<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> ArrayBuffer <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> binary <span class="token operator">=</span> <span class="token function">atob</span><span class="token punctuation">(</span>base64<span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">const</span> bytes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span>binary<span class="token punctuation">.</span>length<span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> binary<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      bytes<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> binary<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">return</span> bytes<span class="token punctuation">.</span>buffer</span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ğŸ”’-å®‰å…¨å­˜å‚¨" tabindex="-1"><a class="header-anchor" href="#ğŸ”’-å®‰å…¨å­˜å‚¨"><span>ğŸ”’ å®‰å…¨å­˜å‚¨</span></a></h2><h3 id="åŠ å¯†å­˜å‚¨ç”¨æˆ·æ•°æ®" tabindex="-1"><a class="header-anchor" href="#åŠ å¯†å­˜å‚¨ç”¨æˆ·æ•°æ®"><span>åŠ å¯†å­˜å‚¨ç”¨æˆ·æ•°æ®</span></a></h3><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts" data-title="ts"><pre><code><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> preferences <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@kit.ArkData&#39;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">SecureStorage</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">private</span> prefs<span class="token operator">:</span> preferences<span class="token punctuation">.</span>Preferences <span class="token operator">|</span> <span class="token keyword">null</span> <span class="token operator">=</span> <span class="token keyword">null</span></span>
<span class="line">  <span class="token keyword">private</span> encryptionService<span class="token operator">:</span> EncryptionService <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EncryptionService</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">  </span>
<span class="line">  <span class="token keyword">async</span> <span class="token function">init</span><span class="token punctuation">(</span>context<span class="token operator">:</span> Context<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">this</span><span class="token punctuation">.</span>prefs <span class="token operator">=</span> <span class="token keyword">await</span> preferences<span class="token punctuation">.</span><span class="token function">getPreferences</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> <span class="token string">&#39;secure_storage&#39;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>encryptionService<span class="token punctuation">.</span><span class="token function">generateKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  </span>
<span class="line">  <span class="token comment">// å®‰å…¨ä¿å­˜æ•°æ®</span></span>
<span class="line">  <span class="token keyword">async</span> <span class="token function">secureSet</span><span class="token punctuation">(</span>key<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>prefs<span class="token punctuation">)</span> <span class="token keyword">return</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token comment">// åŠ å¯†æ•°æ®</span></span>
<span class="line">      <span class="token keyword">const</span> encrypted <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>encryptionService<span class="token punctuation">.</span><span class="token function">encrypt</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span></span>
<span class="line">      </span>
<span class="line">      <span class="token comment">// å­˜å‚¨</span></span>
<span class="line">      <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>prefs<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> encrypted<span class="token punctuation">)</span></span>
<span class="line">      <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>prefs<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">      </span>
<span class="line">      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;æ•°æ®å®‰å…¨ä¿å­˜æˆåŠŸ&#39;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&#39;å®‰å…¨ä¿å­˜å¤±è´¥:&#39;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  </span>
<span class="line">  <span class="token comment">// å®‰å…¨è¯»å–æ•°æ®</span></span>
<span class="line">  <span class="token keyword">async</span> <span class="token function">secureGet</span><span class="token punctuation">(</span>key<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token builtin">string</span> <span class="token operator">|</span> <span class="token keyword">null</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>prefs<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token keyword">null</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token comment">// è¯»å–åŠ å¯†æ•°æ®</span></span>
<span class="line">      <span class="token keyword">const</span> encrypted <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>prefs<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token builtin">string</span></span>
<span class="line">      </span>
<span class="line">      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>encrypted<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token keyword">null</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">      </span>
<span class="line">      <span class="token comment">// è§£å¯†</span></span>
<span class="line">      <span class="token keyword">const</span> decrypted <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>encryptionService<span class="token punctuation">.</span><span class="token function">decrypt</span><span class="token punctuation">(</span>encrypted<span class="token punctuation">)</span></span>
<span class="line">      <span class="token keyword">return</span> decrypted</span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&#39;å®‰å…¨è¯»å–å¤±è´¥:&#39;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span></span>
<span class="line">      <span class="token keyword">return</span> <span class="token keyword">null</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  </span>
<span class="line">  <span class="token comment">// åˆ é™¤æ•°æ®</span></span>
<span class="line">  <span class="token keyword">async</span> <span class="token function">secureDelete</span><span class="token punctuation">(</span>key<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>prefs<span class="token punctuation">)</span> <span class="token keyword">return</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>prefs<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span></span>
<span class="line">      <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>prefs<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&#39;åˆ é™¤å¤±è´¥:&#39;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ğŸ¯-å®æˆ˜æ¡ˆä¾‹-ç”¨æˆ·å‡­è¯ç®¡ç†" tabindex="-1"><a class="header-anchor" href="#ğŸ¯-å®æˆ˜æ¡ˆä¾‹-ç”¨æˆ·å‡­è¯ç®¡ç†"><span>ğŸ¯ å®æˆ˜æ¡ˆä¾‹ï¼šç”¨æˆ·å‡­è¯ç®¡ç†</span></a></h2><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts" data-title="ts"><pre><code><span class="line"><span class="token decorator"><span class="token at operator">@</span><span class="token function">Entry</span></span></span>
<span class="line"><span class="token decorator"><span class="token at operator">@</span><span class="token function">Component</span></span></span>
<span class="line">struct LoginPage <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">private</span> secureStorage<span class="token operator">:</span> SecureStorage <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SecureStorage</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token decorator"><span class="token at operator">@</span><span class="token function">State</span></span> username<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">=</span> <span class="token string">&#39;&#39;</span></span>
<span class="line">  <span class="token decorator"><span class="token at operator">@</span><span class="token function">State</span></span> password<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">=</span> <span class="token string">&#39;&#39;</span></span>
<span class="line">  <span class="token decorator"><span class="token at operator">@</span><span class="token function">State</span></span> rememberMe<span class="token operator">:</span> <span class="token builtin">boolean</span> <span class="token operator">=</span> <span class="token boolean">false</span></span>
<span class="line">  </span>
<span class="line">  <span class="token keyword">async</span> <span class="token function">aboutToAppear</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>secureStorage<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">loadSavedCredentials</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  </span>
<span class="line">  <span class="token keyword">async</span> <span class="token function">loadSavedCredentials</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">const</span> savedUsername <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>secureStorage<span class="token punctuation">.</span><span class="token function">secureGet</span><span class="token punctuation">(</span><span class="token string">&#39;username&#39;</span><span class="token punctuation">)</span></span>
<span class="line">      <span class="token keyword">const</span> savedPassword <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>secureStorage<span class="token punctuation">.</span><span class="token function">secureGet</span><span class="token punctuation">(</span><span class="token string">&#39;password&#39;</span><span class="token punctuation">)</span></span>
<span class="line">      </span>
<span class="line">      <span class="token keyword">if</span> <span class="token punctuation">(</span>savedUsername <span class="token operator">&amp;&amp;</span> savedPassword<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>username <span class="token operator">=</span> savedUsername</span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>password <span class="token operator">=</span> savedPassword</span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>rememberMe <span class="token operator">=</span> <span class="token boolean">true</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&#39;åŠ è½½å‡­è¯å¤±è´¥:&#39;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  </span>
<span class="line">  <span class="token keyword">async</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>username <span class="token operator">||</span> <span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>password<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      promptAction<span class="token punctuation">.</span><span class="token function">showToast</span><span class="token punctuation">(</span><span class="token punctuation">{</span> message<span class="token operator">:</span> <span class="token string">&#39;è¯·è¾“å…¥ç”¨æˆ·åå’Œå¯†ç &#39;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">      <span class="token keyword">return</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token comment">// è°ƒç”¨ç™»å½•API</span></span>
<span class="line">      <span class="token keyword">const</span> success <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">performLogin</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>username<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>password<span class="token punctuation">)</span></span>
<span class="line">      </span>
<span class="line">      <span class="token keyword">if</span> <span class="token punctuation">(</span>success<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// ä¿å­˜å‡­è¯</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>rememberMe<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">          <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>secureStorage<span class="token punctuation">.</span><span class="token function">secureSet</span><span class="token punctuation">(</span><span class="token string">&#39;username&#39;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>username<span class="token punctuation">)</span></span>
<span class="line">          <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>secureStorage<span class="token punctuation">.</span><span class="token function">secureSet</span><span class="token punctuation">(</span><span class="token string">&#39;password&#39;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>password<span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">          <span class="token comment">// æ¸…é™¤ä¿å­˜çš„å‡­è¯</span></span>
<span class="line">          <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>secureStorage<span class="token punctuation">.</span><span class="token function">secureDelete</span><span class="token punctuation">(</span><span class="token string">&#39;username&#39;</span><span class="token punctuation">)</span></span>
<span class="line">          <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>secureStorage<span class="token punctuation">.</span><span class="token function">secureDelete</span><span class="token punctuation">(</span><span class="token string">&#39;password&#39;</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        </span>
<span class="line">        <span class="token comment">// è·³è½¬åˆ°é¦–é¡µ</span></span>
<span class="line">        router<span class="token punctuation">.</span><span class="token function">replaceUrl</span><span class="token punctuation">(</span><span class="token punctuation">{</span> url<span class="token operator">:</span> <span class="token string">&#39;pages/Home&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">        promptAction<span class="token punctuation">.</span><span class="token function">showToast</span><span class="token punctuation">(</span><span class="token punctuation">{</span> message<span class="token operator">:</span> <span class="token string">&#39;ç™»å½•å¤±è´¥&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&#39;ç™»å½•é”™è¯¯:&#39;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  </span>
<span class="line">  <span class="token keyword">async</span> <span class="token function">performLogin</span><span class="token punctuation">(</span>username<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> password<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token builtin">boolean</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// å®é™…çš„ç™»å½•é€»è¾‘</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token boolean">true</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  </span>
<span class="line">  <span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">Column</span><span class="token punctuation">(</span><span class="token punctuation">{</span> space<span class="token operator">:</span> <span class="token number">20</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">&#39;ç™»å½•&#39;</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">.</span><span class="token function">fontSize</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">.</span><span class="token function">fontWeight</span><span class="token punctuation">(</span>FontWeight<span class="token punctuation">.</span>Bold<span class="token punctuation">)</span></span>
<span class="line">      </span>
<span class="line">      <span class="token function">TextInput</span><span class="token punctuation">(</span><span class="token punctuation">{</span> placeholder<span class="token operator">:</span> <span class="token string">&#39;ç”¨æˆ·å&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span>InputType<span class="token punctuation">.</span>Normal<span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">.</span><span class="token function">onChange</span><span class="token punctuation">(</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">          <span class="token keyword">this</span><span class="token punctuation">.</span>username <span class="token operator">=</span> value</span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">      </span>
<span class="line">      <span class="token function">TextInput</span><span class="token punctuation">(</span><span class="token punctuation">{</span> placeholder<span class="token operator">:</span> <span class="token string">&#39;å¯†ç &#39;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span>InputType<span class="token punctuation">.</span>Password<span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">.</span><span class="token function">onChange</span><span class="token punctuation">(</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">          <span class="token keyword">this</span><span class="token punctuation">.</span>password <span class="token operator">=</span> value</span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">      </span>
<span class="line">      <span class="token function">Row</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token function">Checkbox</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">          <span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>rememberMe<span class="token punctuation">)</span></span>
<span class="line">          <span class="token punctuation">.</span><span class="token function">onChange</span><span class="token punctuation">(</span><span class="token punctuation">(</span>checked<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">this</span><span class="token punctuation">.</span>rememberMe <span class="token operator">=</span> checked</span>
<span class="line">          <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">        </span>
<span class="line">        <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">&#39;è®°ä½å¯†ç &#39;</span><span class="token punctuation">)</span></span>
<span class="line">          <span class="token punctuation">.</span><span class="token function">fontSize</span><span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">)</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">      </span>
<span class="line">      <span class="token function">Button</span><span class="token punctuation">(</span><span class="token string">&#39;ç™»å½•&#39;</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">.</span><span class="token function">width</span><span class="token punctuation">(</span><span class="token string">&#39;100%&#39;</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">.</span><span class="token function">onClick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">          <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">width</span><span class="token punctuation">(</span><span class="token string">&#39;80%&#39;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">padding</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ğŸ’¡-æœ€ä½³å®è·µ" tabindex="-1"><a class="header-anchor" href="#ğŸ’¡-æœ€ä½³å®è·µ"><span>ğŸ’¡ æœ€ä½³å®è·µ</span></a></h2><h3 id="_1-æ•æ„Ÿæ•°æ®åŠ å¯†" tabindex="-1"><a class="header-anchor" href="#_1-æ•æ„Ÿæ•°æ®åŠ å¯†"><span>1. æ•æ„Ÿæ•°æ®åŠ å¯†</span></a></h3><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts" data-title="ts"><pre><code><span class="line"><span class="token comment">// âœ… åŠ å¯†å­˜å‚¨æ•æ„Ÿæ•°æ®</span></span>
<span class="line"><span class="token keyword">await</span> secureStorage<span class="token punctuation">.</span><span class="token function">secureSet</span><span class="token punctuation">(</span><span class="token string">&#39;token&#39;</span><span class="token punctuation">,</span> authToken<span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">await</span> secureStorage<span class="token punctuation">.</span><span class="token function">secureSet</span><span class="token punctuation">(</span><span class="token string">&#39;password&#39;</span><span class="token punctuation">,</span> userPassword<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// âŒ é¿å…æ˜æ–‡å­˜å‚¨</span></span>
<span class="line"><span class="token keyword">await</span> prefs<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&#39;token&#39;</span><span class="token punctuation">,</span> authToken<span class="token punctuation">)</span>  <span class="token comment">// ä¸å®‰å…¨</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-å¯†é’¥ç®¡ç†" tabindex="-1"><a class="header-anchor" href="#_2-å¯†é’¥ç®¡ç†"><span>2. å¯†é’¥ç®¡ç†</span></a></h3><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts" data-title="ts"><pre><code><span class="line"><span class="token comment">// âœ… ä½¿ç”¨ HUKS ç®¡ç†å¯†é’¥</span></span>
<span class="line"><span class="token keyword">const</span> keyAlias <span class="token operator">=</span> <span class="token string">&#39;app_master_key&#39;</span></span>
<span class="line"><span class="token keyword">await</span> huks<span class="token punctuation">.</span><span class="token function">generateKeyItem</span><span class="token punctuation">(</span>keyAlias<span class="token punctuation">,</span> options<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// âŒ é¿å…ç¡¬ç¼–ç å¯†é’¥</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token constant">KEY</span> <span class="token operator">=</span> <span class="token string">&#39;hardcoded_key_123&#39;</span>  <span class="token comment">// ä¸å®‰å…¨</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-æ•°æ®æ¸…ç†" tabindex="-1"><a class="header-anchor" href="#_3-æ•°æ®æ¸…ç†"><span>3. æ•°æ®æ¸…ç†</span></a></h3><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts" data-title="ts"><pre><code><span class="line"><span class="token comment">// âœ… ç”¨æˆ·ç™»å‡ºæ—¶æ¸…ç†æ•æ„Ÿæ•°æ®</span></span>
<span class="line"><span class="token keyword">async</span> <span class="token function">logout</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">await</span> secureStorage<span class="token punctuation">.</span><span class="token function">secureDelete</span><span class="token punctuation">(</span><span class="token string">&#39;token&#39;</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token keyword">await</span> secureStorage<span class="token punctuation">.</span><span class="token function">secureDelete</span><span class="token punctuation">(</span><span class="token string">&#39;userInfo&#39;</span><span class="token punctuation">)</span></span>
<span class="line">  router<span class="token punctuation">.</span><span class="token function">replaceUrl</span><span class="token punctuation">(</span><span class="token punctuation">{</span> url<span class="token operator">:</span> <span class="token string">&#39;pages/Login&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ğŸ“š-å‚è€ƒèµ„æº" tabindex="-1"><a class="header-anchor" href="#ğŸ“š-å‚è€ƒèµ„æº"><span>ğŸ“š å‚è€ƒèµ„æº</span></a></h2>`,18)),s("ul",null,[s("li",null,[s("a",d,[n[0]||(n[0]=a("é€šç”¨å¯†é’¥åº“",-1)),p(t)])]),s("li",null,[s("a",v,[n[1]||(n[1]=a("æ•°æ®å®‰å…¨",-1)),p(t)])])]),n[6]||(n[6]=s("hr",null,null,-1)),s("p",null,[n[3]||(n[3]=s("strong",null,"ä¸‹ä¸€èŠ‚",-1)),n[4]||(n[4]=a(" â†’ ",-1)),p(c,{to:"/tutorials/harmonyos-dev/14-security-privacy/03-%E7%94%9F%E7%89%A9%E8%AF%86%E5%88%AB.html"},{default:u(()=>[...n[2]||(n[2]=[a("ç”Ÿç‰©è¯†åˆ«",-1)])]),_:1})])])}const w=l(r,[["render",m]]),h=JSON.parse('{"path":"/tutorials/harmonyos-dev/14-security-privacy/02-shujujiamiyucunchu.html","title":"æ•°æ®åŠ å¯†ä¸å­˜å‚¨","lang":"zh-CN","frontmatter":{"title":"æ•°æ®åŠ å¯†ä¸å­˜å‚¨","date":"2025-01-22T00:00:00.000Z"},"headers":[{"level":2,"title":"ğŸ” æ•°æ®åŠ å¯†","slug":"ğŸ”-æ•°æ®åŠ å¯†","link":"#ğŸ”-æ•°æ®åŠ å¯†","children":[{"level":3,"title":"HUKS å¯†é’¥ç®¡ç†","slug":"huks-å¯†é’¥ç®¡ç†","link":"#huks-å¯†é’¥ç®¡ç†","children":[]}]},{"level":2,"title":"ğŸ”’ å®‰å…¨å­˜å‚¨","slug":"ğŸ”’-å®‰å…¨å­˜å‚¨","link":"#ğŸ”’-å®‰å…¨å­˜å‚¨","children":[{"level":3,"title":"åŠ å¯†å­˜å‚¨ç”¨æˆ·æ•°æ®","slug":"åŠ å¯†å­˜å‚¨ç”¨æˆ·æ•°æ®","link":"#åŠ å¯†å­˜å‚¨ç”¨æˆ·æ•°æ®","children":[]}]},{"level":2,"title":"ğŸ¯ å®æˆ˜æ¡ˆä¾‹ï¼šç”¨æˆ·å‡­è¯ç®¡ç†","slug":"ğŸ¯-å®æˆ˜æ¡ˆä¾‹-ç”¨æˆ·å‡­è¯ç®¡ç†","link":"#ğŸ¯-å®æˆ˜æ¡ˆä¾‹-ç”¨æˆ·å‡­è¯ç®¡ç†","children":[]},{"level":2,"title":"ğŸ’¡ æœ€ä½³å®è·µ","slug":"ğŸ’¡-æœ€ä½³å®è·µ","link":"#ğŸ’¡-æœ€ä½³å®è·µ","children":[{"level":3,"title":"1. æ•æ„Ÿæ•°æ®åŠ å¯†","slug":"_1-æ•æ„Ÿæ•°æ®åŠ å¯†","link":"#_1-æ•æ„Ÿæ•°æ®åŠ å¯†","children":[]},{"level":3,"title":"2. å¯†é’¥ç®¡ç†","slug":"_2-å¯†é’¥ç®¡ç†","link":"#_2-å¯†é’¥ç®¡ç†","children":[]},{"level":3,"title":"3. æ•°æ®æ¸…ç†","slug":"_3-æ•°æ®æ¸…ç†","link":"#_3-æ•°æ®æ¸…ç†","children":[]}]},{"level":2,"title":"ğŸ“š å‚è€ƒèµ„æº","slug":"ğŸ“š-å‚è€ƒèµ„æº","link":"#ğŸ“š-å‚è€ƒèµ„æº","children":[]}],"git":{"createdTime":1765250065000,"updatedTime":1765250065000,"contributors":[{"name":"CambridgeFoldingKnife","email":"3144253125@qq.com","commits":1}]},"filePathRelative":"tutorials/harmonyos-dev/14-security-privacy/02-æ•°æ®åŠ å¯†ä¸å­˜å‚¨.md"}');export{w as comp,h as data};
