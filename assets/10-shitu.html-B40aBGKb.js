import{_ as p,c as l,d as t,e as a,f as n,b as c,w as o,r as i,o as d}from"./app-DyGs7pMe.js";const r={};function k(u,s){const e=i("RouteLink");return d(),l("div",null,[s[3]||(s[3]=t(`<h1 id="视图" tabindex="-1"><a class="header-anchor" href="#视图"><span>视图</span></a></h1><blockquote><p>视图是虚拟表，简化复杂查询，提高SQL的可重用性和安全性。本章学习视图的创建和使用。</p></blockquote><h2 id="📋-本章目录" tabindex="-1"><a class="header-anchor" href="#📋-本章目录"><span>📋 本章目录</span></a></h2><ul><li><a href="#%E4%B8%80%E8%A7%86%E5%9B%BE%E6%A6%82%E8%BF%B0">一、视图概述</a></li><li><a href="#%E4%BA%8C%E8%A7%86%E5%9B%BE%E6%93%8D%E4%BD%9C">二、视图操作</a></li><li><a href="#%E4%B8%89%E6%A3%80%E6%9F%A5%E9%80%89%E9%A1%B9">三、检查选项</a></li><li><a href="#%E5%9B%9B%E8%A7%86%E5%9B%BE%E7%9A%84%E6%9B%B4%E6%96%B0">四、视图的更新</a></li><li><a href="#%E4%BA%94%E8%A7%86%E5%9B%BE%E7%9A%84%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF">五、视图的应用场景</a></li></ul><hr><h2 id="一、视图概述" tabindex="-1"><a class="header-anchor" href="#一、视图概述"><span>一、视图概述</span></a></h2><h3 id="_1-1-什么是视图" tabindex="-1"><a class="header-anchor" href="#_1-1-什么是视图"><span>1.1 什么是视图？</span></a></h3><p><strong>视图（View）</strong> 是一种虚拟存在的表，不存储实际数据，只保存查询的SQL逻辑。</p><p><strong>特点：</strong></p><ul><li>📝 视图是虚拟表，数据来自基础表</li><li>🔄 动态生成数据，实时反映基础表的变化</li><li>💾 只存储SQL定义，不存储数据</li><li>🔒 可以隐藏复杂查询，提高安全性</li></ul><h3 id="_1-2-视图-vs-表" tabindex="-1"><a class="header-anchor" href="#_1-2-视图-vs-表"><span>1.2 视图 vs 表</span></a></h3><table><thead><tr><th>特性</th><th>视图</th><th>表</th></tr></thead><tbody><tr><td>数据存储</td><td>❌ 不存储数据</td><td>✅ 存储实际数据</td></tr><tr><td>占用空间</td><td>极小（只存SQL）</td><td>根据数据量</td></tr><tr><td>更新限制</td><td>有限制</td><td>无限制</td></tr><tr><td>性能</td><td>依赖基础表</td><td>直接查询</td></tr><tr><td>用途</td><td>简化查询、权限控制</td><td>存储数据</td></tr></tbody></table><h3 id="_1-3-视图的优势" tabindex="-1"><a class="header-anchor" href="#_1-3-视图的优势"><span>1.3 视图的优势</span></a></h3><p><strong>1. 简化复杂查询</strong></p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token comment">-- 不使用视图：每次都要写复杂SQL</span></span>
<span class="line"><span class="token keyword">SELECT</span> u<span class="token punctuation">.</span>name<span class="token punctuation">,</span> o<span class="token punctuation">.</span>order_no<span class="token punctuation">,</span> o<span class="token punctuation">.</span>total_amount</span>
<span class="line"><span class="token keyword">FROM</span> users u</span>
<span class="line"><span class="token keyword">JOIN</span> orders o <span class="token keyword">ON</span> u<span class="token punctuation">.</span>id <span class="token operator">=</span> o<span class="token punctuation">.</span>user_id</span>
<span class="line"><span class="token keyword">WHERE</span> o<span class="token punctuation">.</span><span class="token keyword">status</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">-- 使用视图：简化查询</span></span>
<span class="line"><span class="token keyword">CREATE</span> <span class="token keyword">VIEW</span> v_user_orders <span class="token keyword">AS</span></span>
<span class="line"><span class="token keyword">SELECT</span> u<span class="token punctuation">.</span>name<span class="token punctuation">,</span> o<span class="token punctuation">.</span>order_no<span class="token punctuation">,</span> o<span class="token punctuation">.</span>total_amount</span>
<span class="line"><span class="token keyword">FROM</span> users u</span>
<span class="line"><span class="token keyword">JOIN</span> orders o <span class="token keyword">ON</span> u<span class="token punctuation">.</span>id <span class="token operator">=</span> o<span class="token punctuation">.</span>user_id</span>
<span class="line"><span class="token keyword">WHERE</span> o<span class="token punctuation">.</span><span class="token keyword">status</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">-- 使用时只需：</span></span>
<span class="line"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> v_user_orders<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>2. 提高安全性</strong></p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token comment">-- 隐藏敏感字段（如密码、工资）</span></span>
<span class="line"><span class="token keyword">CREATE</span> <span class="token keyword">VIEW</span> v_public_users <span class="token keyword">AS</span></span>
<span class="line"><span class="token keyword">SELECT</span> id<span class="token punctuation">,</span> name<span class="token punctuation">,</span> email <span class="token keyword">FROM</span> users<span class="token punctuation">;</span>  <span class="token comment">-- 不包含password字段</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>3. 数据独立性</strong></p><ul><li>表结构改变时，视图可以保持接口不变</li><li>应用程序不需要修改</li></ul><hr><h2 id="二、视图操作" tabindex="-1"><a class="header-anchor" href="#二、视图操作"><span>二、视图操作</span></a></h2><h3 id="_2-1-创建视图" tabindex="-1"><a class="header-anchor" href="#_2-1-创建视图"><span>2.1 创建视图</span></a></h3><p><strong>语法：</strong></p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">CREATE</span> <span class="token punctuation">[</span><span class="token operator">OR</span> <span class="token keyword">REPLACE</span><span class="token punctuation">]</span> <span class="token keyword">VIEW</span> 视图名称 <span class="token punctuation">[</span><span class="token punctuation">(</span>列名列表<span class="token punctuation">)</span><span class="token punctuation">]</span></span>
<span class="line"><span class="token keyword">AS</span></span>
<span class="line"><span class="token keyword">SELECT</span> 语句</span>
<span class="line"><span class="token punctuation">[</span><span class="token keyword">WITH</span> <span class="token punctuation">[</span><span class="token keyword">CASCADED</span> <span class="token operator">|</span> <span class="token keyword">LOCAL</span><span class="token punctuation">]</span> <span class="token keyword">CHECK</span> <span class="token keyword">OPTION</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>示例1：基本视图</strong></p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token comment">-- 创建学生信息视图（只显示id和name）</span></span>
<span class="line"><span class="token keyword">CREATE</span> <span class="token keyword">VIEW</span> v_student <span class="token keyword">AS</span></span>
<span class="line"><span class="token keyword">SELECT</span> id<span class="token punctuation">,</span> name<span class="token punctuation">,</span> age <span class="token keyword">FROM</span> students <span class="token keyword">WHERE</span> id <span class="token operator">&lt;=</span> <span class="token number">10</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">-- 查询视图</span></span>
<span class="line"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> v_student<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>示例2：复杂视图</strong></p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token comment">-- 创建订单统计视图</span></span>
<span class="line"><span class="token keyword">CREATE</span> <span class="token keyword">VIEW</span> v_user_order_stats <span class="token keyword">AS</span></span>
<span class="line"><span class="token keyword">SELECT</span> </span>
<span class="line">    u<span class="token punctuation">.</span>id<span class="token punctuation">,</span></span>
<span class="line">    u<span class="token punctuation">.</span>name <span class="token keyword">AS</span> user_name<span class="token punctuation">,</span></span>
<span class="line">    <span class="token function">COUNT</span><span class="token punctuation">(</span>o<span class="token punctuation">.</span>id<span class="token punctuation">)</span> <span class="token keyword">AS</span> order_count<span class="token punctuation">,</span></span>
<span class="line">    IFNULL<span class="token punctuation">(</span><span class="token function">SUM</span><span class="token punctuation">(</span>o<span class="token punctuation">.</span>amount<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> total_amount</span>
<span class="line"><span class="token keyword">FROM</span> users u</span>
<span class="line"><span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> orders o <span class="token keyword">ON</span> u<span class="token punctuation">.</span>id <span class="token operator">=</span> o<span class="token punctuation">.</span>user_id</span>
<span class="line"><span class="token keyword">GROUP</span> <span class="token keyword">BY</span> u<span class="token punctuation">.</span>id<span class="token punctuation">,</span> u<span class="token punctuation">.</span>name<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">-- 使用视图</span></span>
<span class="line"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> v_user_order_stats <span class="token keyword">WHERE</span> order_count <span class="token operator">&gt;</span> <span class="token number">5</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>示例3：OR REPLACE（更新视图）</strong></p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token comment">-- 如果视图存在则替换</span></span>
<span class="line"><span class="token keyword">CREATE</span> <span class="token operator">OR</span> <span class="token keyword">REPLACE</span> <span class="token keyword">VIEW</span> v_student <span class="token keyword">AS</span></span>
<span class="line"><span class="token keyword">SELECT</span> id<span class="token punctuation">,</span> name<span class="token punctuation">,</span> age<span class="token punctuation">,</span> class <span class="token keyword">FROM</span> students <span class="token keyword">WHERE</span> id <span class="token operator">&lt;=</span> <span class="token number">10</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-2-查看视图" tabindex="-1"><a class="header-anchor" href="#_2-2-查看视图"><span>2.2 查看视图</span></a></h3><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token comment">-- 查看所有视图</span></span>
<span class="line"><span class="token keyword">SHOW</span> <span class="token keyword">TABLES</span><span class="token punctuation">;</span>  <span class="token comment">-- 视图也会显示在表列表中</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">-- 查看视图定义</span></span>
<span class="line"><span class="token keyword">SHOW</span> <span class="token keyword">CREATE</span> <span class="token keyword">VIEW</span> v_student<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">-- 查看视图结构</span></span>
<span class="line"><span class="token keyword">DESC</span> v_student<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">-- 查询视图数据</span></span>
<span class="line"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> v_student<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> v_student <span class="token keyword">WHERE</span> age <span class="token operator">&gt;</span> <span class="token number">18</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-3-修改视图" tabindex="-1"><a class="header-anchor" href="#_2-3-修改视图"><span>2.3 修改视图</span></a></h3><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token comment">-- 方式1：CREATE OR REPLACE</span></span>
<span class="line"><span class="token keyword">CREATE</span> <span class="token operator">OR</span> <span class="token keyword">REPLACE</span> <span class="token keyword">VIEW</span> v_student <span class="token keyword">AS</span></span>
<span class="line"><span class="token keyword">SELECT</span> id<span class="token punctuation">,</span> name<span class="token punctuation">,</span> age<span class="token punctuation">,</span> gender <span class="token keyword">FROM</span> students <span class="token keyword">WHERE</span> id <span class="token operator">&lt;=</span> <span class="token number">10</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">-- 方式2：ALTER VIEW</span></span>
<span class="line"><span class="token keyword">ALTER</span> <span class="token keyword">VIEW</span> v_student <span class="token keyword">AS</span></span>
<span class="line"><span class="token keyword">SELECT</span> id<span class="token punctuation">,</span> name <span class="token keyword">FROM</span> students <span class="token keyword">WHERE</span> id <span class="token operator">&lt;=</span> <span class="token number">5</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-4-删除视图" tabindex="-1"><a class="header-anchor" href="#_2-4-删除视图"><span>2.4 删除视图</span></a></h3><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token comment">-- 删除单个视图</span></span>
<span class="line"><span class="token keyword">DROP</span> <span class="token keyword">VIEW</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> v_student<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">-- 删除多个视图</span></span>
<span class="line"><span class="token keyword">DROP</span> <span class="token keyword">VIEW</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> v_student<span class="token punctuation">,</span> v_user_orders<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="三、检查选项" tabindex="-1"><a class="header-anchor" href="#三、检查选项"><span>三、检查选项</span></a></h2><h3 id="_3-1-with-check-option" tabindex="-1"><a class="header-anchor" href="#_3-1-with-check-option"><span>3.1 WITH CHECK OPTION</span></a></h3><p>当使用 <code>WITH CHECK OPTION</code> 创建视图时，通过视图插入、更新、删除数据时，MySQL会检查数据是否符合视图的WHERE条件。</p><h3 id="_3-2-cascaded-默认" tabindex="-1"><a class="header-anchor" href="#_3-2-cascaded-默认"><span>3.2 CASCADED（默认）</span></a></h3><p><strong>CASCADED</strong> 是默认选项，会递归检查所有依赖视图的条件。</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token comment">-- 创建基础视图</span></span>
<span class="line"><span class="token keyword">CREATE</span> <span class="token keyword">VIEW</span> v1 <span class="token keyword">AS</span></span>
<span class="line"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> students <span class="token keyword">WHERE</span> age <span class="token operator">&gt;=</span> <span class="token number">18</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">-- 创建级联检查视图</span></span>
<span class="line"><span class="token keyword">CREATE</span> <span class="token keyword">VIEW</span> v2 <span class="token keyword">AS</span></span>
<span class="line"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> v1 <span class="token keyword">WHERE</span> age <span class="token operator">&lt;=</span> <span class="token number">25</span></span>
<span class="line"><span class="token keyword">WITH</span> <span class="token keyword">CASCADED</span> <span class="token keyword">CHECK</span> <span class="token keyword">OPTION</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">-- ✅ 可以插入（满足 age&gt;=18 AND age&lt;=25）</span></span>
<span class="line"><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> v2 <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&#39;张三&#39;</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token string">&#39;一班&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">-- ❌ 插入失败（age=30 不满足 v2 的条件 age&lt;=25）</span></span>
<span class="line"><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> v2 <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">&#39;李四&#39;</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token string">&#39;二班&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">-- ❌ 插入失败（age=16 不满足 v1 的条件 age&gt;=18）</span></span>
<span class="line"><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> v2 <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">&#39;王五&#39;</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token string">&#39;三班&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>CASCADED 检查逻辑：</strong></p><ul><li>检查 v2 的条件：age &lt;= 25</li><li>递归检查 v1 的条件：age &gt;= 18</li><li>两个条件都要满足</li></ul><h3 id="_3-3-local" tabindex="-1"><a class="header-anchor" href="#_3-3-local"><span>3.3 LOCAL</span></a></h3><p><strong>LOCAL</strong> 只检查当前视图的条件，不递归检查依赖视图。</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token comment">-- 创建基础视图（无检查选项）</span></span>
<span class="line"><span class="token keyword">CREATE</span> <span class="token keyword">VIEW</span> v1 <span class="token keyword">AS</span></span>
<span class="line"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> students <span class="token keyword">WHERE</span> age <span class="token operator">&gt;=</span> <span class="token number">18</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">-- 创建本地检查视图</span></span>
<span class="line"><span class="token keyword">CREATE</span> <span class="token keyword">VIEW</span> v2 <span class="token keyword">AS</span></span>
<span class="line"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> v1 <span class="token keyword">WHERE</span> age <span class="token operator">&lt;=</span> <span class="token number">25</span></span>
<span class="line"><span class="token keyword">WITH</span> <span class="token keyword">LOCAL</span> <span class="token keyword">CHECK</span> <span class="token keyword">OPTION</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">-- ✅ 可以插入（只检查 v2 的条件 age&lt;=25）</span></span>
<span class="line"><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> v2 <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&#39;张三&#39;</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token string">&#39;一班&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">-- ❌ 插入失败（不满足 v2 的条件 age&lt;=25）</span></span>
<span class="line"><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> v2 <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">&#39;李四&#39;</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token string">&#39;二班&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">-- ⚠️ 可以插入（LOCAL不检查v1的条件，但实际上违反了age&gt;=18）</span></span>
<span class="line"><span class="token comment">-- 注意：虽然可以尝试插入，但如果基础表有约束可能还是会失败</span></span>
<span class="line"><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> v2 <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">&#39;王五&#39;</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token string">&#39;三班&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-4-对比总结" tabindex="-1"><a class="header-anchor" href="#_3-4-对比总结"><span>3.4 对比总结</span></a></h3><table><thead><tr><th>选项</th><th>检查范围</th><th>使用场景</th></tr></thead><tbody><tr><td><strong>CASCADED</strong></td><td>递归检查所有视图条件</td><td>严格数据验证（推荐）</td></tr><tr><td><strong>LOCAL</strong></td><td>只检查当前视图条件</td><td>灵活的数据插入</td></tr><tr><td><strong>不使用</strong></td><td>不检查条件</td><td>只读视图</td></tr></tbody></table><hr><h2 id="四、视图的更新" tabindex="-1"><a class="header-anchor" href="#四、视图的更新"><span>四、视图的更新</span></a></h2><h3 id="_4-1-可更新视图" tabindex="-1"><a class="header-anchor" href="#_4-1-可更新视图"><span>4.1 可更新视图</span></a></h3><p>视图可更新的条件：视图中的行与基础表中的行存在 <strong>一对一</strong> 的关系。</p><p><strong>可更新的视图示例：</strong></p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token comment">-- 简单视图（可更新）</span></span>
<span class="line"><span class="token keyword">CREATE</span> <span class="token keyword">VIEW</span> v_students <span class="token keyword">AS</span></span>
<span class="line"><span class="token keyword">SELECT</span> id<span class="token punctuation">,</span> name<span class="token punctuation">,</span> age <span class="token keyword">FROM</span> students<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">-- 可以进行增删改操作</span></span>
<span class="line"><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> v_students <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token string">&#39;新学生&#39;</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">UPDATE</span> v_students <span class="token keyword">SET</span> age <span class="token operator">=</span> <span class="token number">21</span> <span class="token keyword">WHERE</span> id <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">DELETE</span> <span class="token keyword">FROM</span> v_students <span class="token keyword">WHERE</span> id <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-2-不可更新视图" tabindex="-1"><a class="header-anchor" href="#_4-2-不可更新视图"><span>4.2 不可更新视图</span></a></h3><p>如果视图包含以下任意一项，则视图 <strong>不可更新</strong>：</p><p><strong>1. 聚合函数或窗口函数</strong></p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">CREATE</span> <span class="token keyword">VIEW</span> v_avg_age <span class="token keyword">AS</span></span>
<span class="line"><span class="token keyword">SELECT</span> class<span class="token punctuation">,</span> <span class="token function">AVG</span><span class="token punctuation">(</span>age<span class="token punctuation">)</span> <span class="token keyword">AS</span> avg_age <span class="token keyword">FROM</span> students <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> class<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">-- ❌ 不能更新</span></span>
<span class="line"><span class="token keyword">UPDATE</span> v_avg_age <span class="token keyword">SET</span> avg_age <span class="token operator">=</span> <span class="token number">20</span> <span class="token keyword">WHERE</span> class <span class="token operator">=</span> <span class="token string">&#39;一班&#39;</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>2. DISTINCT</strong></p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">CREATE</span> <span class="token keyword">VIEW</span> v_distinct_class <span class="token keyword">AS</span></span>
<span class="line"><span class="token keyword">SELECT</span> <span class="token keyword">DISTINCT</span> class <span class="token keyword">FROM</span> students<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">-- ❌ 不能更新</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>3. GROUP BY</strong></p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">CREATE</span> <span class="token keyword">VIEW</span> v_class_count <span class="token keyword">AS</span></span>
<span class="line"><span class="token keyword">SELECT</span> class<span class="token punctuation">,</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> cnt <span class="token keyword">FROM</span> students <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> class<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">-- ❌ 不能更新</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>4. HAVING</strong></p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">CREATE</span> <span class="token keyword">VIEW</span> v_class_having <span class="token keyword">AS</span></span>
<span class="line"><span class="token keyword">SELECT</span> class<span class="token punctuation">,</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> cnt </span>
<span class="line"><span class="token keyword">FROM</span> students </span>
<span class="line"><span class="token keyword">GROUP</span> <span class="token keyword">BY</span> class </span>
<span class="line"><span class="token keyword">HAVING</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">5</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">-- ❌ 不能更新</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>5. UNION 或 UNION ALL</strong></p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">CREATE</span> <span class="token keyword">VIEW</span> v_union <span class="token keyword">AS</span></span>
<span class="line"><span class="token keyword">SELECT</span> id<span class="token punctuation">,</span> name <span class="token keyword">FROM</span> students</span>
<span class="line"><span class="token keyword">UNION</span></span>
<span class="line"><span class="token keyword">SELECT</span> id<span class="token punctuation">,</span> name <span class="token keyword">FROM</span> teachers<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">-- ❌ 不能更新</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>6. 子查询</strong></p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">CREATE</span> <span class="token keyword">VIEW</span> v_subquery <span class="token keyword">AS</span></span>
<span class="line"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> students </span>
<span class="line"><span class="token keyword">WHERE</span> age <span class="token operator">&gt;</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token function">AVG</span><span class="token punctuation">(</span>age<span class="token punctuation">)</span> <span class="token keyword">FROM</span> students<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">-- ❌ 不能更新</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-3-更新限制总结" tabindex="-1"><a class="header-anchor" href="#_4-3-更新限制总结"><span>4.3 更新限制总结</span></a></h3><table><thead><tr><th>视图类型</th><th>是否可更新</th><th>示例</th></tr></thead><tbody><tr><td>简单SELECT</td><td>✅ 可以</td><td>SELECT id, name FROM t</td></tr><tr><td>包含聚合函数</td><td>❌ 不可以</td><td>SELECT AVG(age) ...</td></tr><tr><td>包含DISTINCT</td><td>❌ 不可以</td><td>SELECT DISTINCT ...</td></tr><tr><td>包含GROUP BY</td><td>❌ 不可以</td><td>... GROUP BY class</td></tr><tr><td>包含JOIN</td><td>⚠️ 部分可以</td><td>取决于具体情况</td></tr></tbody></table><hr><h2 id="五、💼-实际工作中什么时候用视图" tabindex="-1"><a class="header-anchor" href="#五、💼-实际工作中什么时候用视图"><span>五、💼 实际工作中什么时候用视图？</span></a></h2><h3 id="_5-1-场景1-简化复杂查询-最常用" tabindex="-1"><a class="header-anchor" href="#_5-1-场景1-简化复杂查询-最常用"><span>5.1 场景1：简化复杂查询（最常用）</span></a></h3><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token comment">-- 场景：经常需要查询用户的订单统计信息</span></span>
<span class="line"><span class="token keyword">CREATE</span> <span class="token keyword">VIEW</span> v_user_stats <span class="token keyword">AS</span></span>
<span class="line"><span class="token keyword">SELECT</span> </span>
<span class="line">    u<span class="token punctuation">.</span>id<span class="token punctuation">,</span></span>
<span class="line">    u<span class="token punctuation">.</span>username<span class="token punctuation">,</span></span>
<span class="line">    u<span class="token punctuation">.</span>email<span class="token punctuation">,</span></span>
<span class="line">    <span class="token function">COUNT</span><span class="token punctuation">(</span>o<span class="token punctuation">.</span>id<span class="token punctuation">)</span> <span class="token keyword">AS</span> order_count<span class="token punctuation">,</span></span>
<span class="line">    <span class="token function">SUM</span><span class="token punctuation">(</span>o<span class="token punctuation">.</span>amount<span class="token punctuation">)</span> <span class="token keyword">AS</span> total_spent<span class="token punctuation">,</span></span>
<span class="line">    <span class="token function">MAX</span><span class="token punctuation">(</span>o<span class="token punctuation">.</span>create_time<span class="token punctuation">)</span> <span class="token keyword">AS</span> last_order_time</span>
<span class="line"><span class="token keyword">FROM</span> users u</span>
<span class="line"><span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> orders o <span class="token keyword">ON</span> u<span class="token punctuation">.</span>id <span class="token operator">=</span> o<span class="token punctuation">.</span>user_id</span>
<span class="line"><span class="token keyword">GROUP</span> <span class="token keyword">BY</span> u<span class="token punctuation">.</span>id<span class="token punctuation">,</span> u<span class="token punctuation">.</span>username<span class="token punctuation">,</span> u<span class="token punctuation">.</span>email<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">-- 使用时非常简单</span></span>
<span class="line"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> v_user_stats <span class="token keyword">WHERE</span> order_count <span class="token operator">&gt;</span> <span class="token number">10</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-2-场景2-权限控制和数据安全-重要" tabindex="-1"><a class="header-anchor" href="#_5-2-场景2-权限控制和数据安全-重要"><span>5.2 场景2：权限控制和数据安全（重要）</span></a></h3><p><strong>真实案例</strong>：一个公司的员工管理系统，不同部门看到的数据不同。</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token comment">-- HR部门：只能看基本信息（不包含工资）</span></span>
<span class="line"><span class="token keyword">CREATE</span> <span class="token keyword">VIEW</span> v_hr_employees <span class="token keyword">AS</span></span>
<span class="line"><span class="token keyword">SELECT</span> id<span class="token punctuation">,</span> name<span class="token punctuation">,</span> dept<span class="token punctuation">,</span> hire_date<span class="token punctuation">,</span> phone<span class="token punctuation">,</span> email <span class="token keyword">FROM</span> employees<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">GRANT</span> <span class="token keyword">SELECT</span> <span class="token keyword">ON</span> v_hr_employees <span class="token keyword">TO</span> <span class="token string">&#39;hr_user&#39;</span><span class="token variable">@&#39;%&#39;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">-- 财务部门：可以看工资信息</span></span>
<span class="line"><span class="token keyword">CREATE</span> <span class="token keyword">VIEW</span> v_finance_employees <span class="token keyword">AS</span></span>
<span class="line"><span class="token keyword">SELECT</span> id<span class="token punctuation">,</span> name<span class="token punctuation">,</span> dept<span class="token punctuation">,</span> salary<span class="token punctuation">,</span> bonus <span class="token keyword">FROM</span> employees<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">GRANT</span> <span class="token keyword">SELECT</span> <span class="token keyword">ON</span> v_finance_employees <span class="token keyword">TO</span> <span class="token string">&#39;finance_user&#39;</span><span class="token variable">@&#39;%&#39;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">-- 普通员工：只能看自己的信息</span></span>
<span class="line"><span class="token keyword">CREATE</span> <span class="token keyword">VIEW</span> v_my_profile <span class="token keyword">AS</span></span>
<span class="line"><span class="token keyword">SELECT</span> id<span class="token punctuation">,</span> name<span class="token punctuation">,</span> email<span class="token punctuation">,</span> phone<span class="token punctuation">,</span> dept <span class="token keyword">FROM</span> employees </span>
<span class="line"><span class="token keyword">WHERE</span> username <span class="token operator">=</span> <span class="token keyword">USER</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">GRANT</span> <span class="token keyword">SELECT</span> <span class="token keyword">ON</span> v_my_profile <span class="token keyword">TO</span> <span class="token string">&#39;employee&#39;</span><span class="token variable">@&#39;%&#39;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">-- 经理：可以看本部门员工信息</span></span>
<span class="line"><span class="token keyword">CREATE</span> <span class="token keyword">VIEW</span> v_dept_employees <span class="token keyword">AS</span></span>
<span class="line"><span class="token keyword">SELECT</span> e<span class="token punctuation">.</span>id<span class="token punctuation">,</span> e<span class="token punctuation">.</span>name<span class="token punctuation">,</span> e<span class="token punctuation">.</span>position<span class="token punctuation">,</span> e<span class="token punctuation">.</span>hire_date</span>
<span class="line"><span class="token keyword">FROM</span> employees e</span>
<span class="line"><span class="token keyword">WHERE</span> e<span class="token punctuation">.</span>dept_id <span class="token operator">=</span> <span class="token punctuation">(</span></span>
<span class="line">    <span class="token keyword">SELECT</span> dept_id <span class="token keyword">FROM</span> employees <span class="token keyword">WHERE</span> username <span class="token operator">=</span> <span class="token keyword">USER</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>为什么用视图</strong>：</p><ul><li>✅ 不同用户看不同数据，无需修改应用代码</li><li>✅ 隐藏敏感字段（如密码、工资）</li><li>✅ 细粒度的权限控制</li><li>✅ 数据安全性更高</li></ul><p><strong>实际工作中的应用</strong>：</p><ul><li>🏢 OA系统：不同级别员工看到不同审批流程</li><li>💰 财务系统：只有财务人员能看金额</li><li>📊 数据分析：给分析师提供脱敏后的数据视图</li><li>🏥 医疗系统：医生只能看自己的患者</li></ul><h3 id="_5-3-数据格式转换" tabindex="-1"><a class="header-anchor" href="#_5-3-数据格式转换"><span>5.3 数据格式转换</span></a></h3><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token comment">-- 场景：格式化显示数据</span></span>
<span class="line"><span class="token keyword">CREATE</span> <span class="token keyword">VIEW</span> v_formatted_orders <span class="token keyword">AS</span></span>
<span class="line"><span class="token keyword">SELECT</span> </span>
<span class="line">    order_id<span class="token punctuation">,</span></span>
<span class="line">    user_name<span class="token punctuation">,</span></span>
<span class="line">    DATE_FORMAT<span class="token punctuation">(</span>order_time<span class="token punctuation">,</span> <span class="token string">&#39;%Y-%m-%d %H:%i:%s&#39;</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> order_time<span class="token punctuation">,</span></span>
<span class="line">    CONCAT<span class="token punctuation">(</span><span class="token string">&#39;¥&#39;</span><span class="token punctuation">,</span> <span class="token function">FORMAT</span><span class="token punctuation">(</span>amount<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> amount_formatted<span class="token punctuation">,</span></span>
<span class="line">    <span class="token keyword">CASE</span> <span class="token keyword">status</span></span>
<span class="line">        <span class="token keyword">WHEN</span> <span class="token number">1</span> <span class="token keyword">THEN</span> <span class="token string">&#39;待支付&#39;</span></span>
<span class="line">        <span class="token keyword">WHEN</span> <span class="token number">2</span> <span class="token keyword">THEN</span> <span class="token string">&#39;已支付&#39;</span></span>
<span class="line">        <span class="token keyword">WHEN</span> <span class="token number">3</span> <span class="token keyword">THEN</span> <span class="token string">&#39;已发货&#39;</span></span>
<span class="line">        <span class="token keyword">WHEN</span> <span class="token number">4</span> <span class="token keyword">THEN</span> <span class="token string">&#39;已完成&#39;</span></span>
<span class="line">        <span class="token keyword">ELSE</span> <span class="token string">&#39;未知&#39;</span></span>
<span class="line">    <span class="token keyword">END</span> <span class="token keyword">AS</span> status_text</span>
<span class="line"><span class="token keyword">FROM</span> orders<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-4-兼容性" tabindex="-1"><a class="header-anchor" href="#_5-4-兼容性"><span>5.4 兼容性</span></a></h3><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token comment">-- 场景：表结构改变，但保持对外接口不变</span></span>
<span class="line"><span class="token comment">-- 原表：users(id, name, address)</span></span>
<span class="line"><span class="token comment">-- 新表：users(id, name), addresses(user_id, address)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">-- 创建视图保持兼容</span></span>
<span class="line"><span class="token keyword">CREATE</span> <span class="token keyword">VIEW</span> v_users_compatible <span class="token keyword">AS</span></span>
<span class="line"><span class="token keyword">SELECT</span> u<span class="token punctuation">.</span>id<span class="token punctuation">,</span> u<span class="token punctuation">.</span>name<span class="token punctuation">,</span> a<span class="token punctuation">.</span>address</span>
<span class="line"><span class="token keyword">FROM</span> users u</span>
<span class="line"><span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> addresses a <span class="token keyword">ON</span> u<span class="token punctuation">.</span>id <span class="token operator">=</span> a<span class="token punctuation">.</span>user_id<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">-- 应用程序不需要修改</span></span>
<span class="line"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> v_users_compatible<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="六、最佳实践" tabindex="-1"><a class="header-anchor" href="#六、最佳实践"><span>六、最佳实践</span></a></h2><h3 id="_6-1-命名规范" tabindex="-1"><a class="header-anchor" href="#_6-1-命名规范"><span>6.1 命名规范</span></a></h3><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token comment">-- 建议视图名以 v_ 开头</span></span>
<span class="line"><span class="token keyword">CREATE</span> <span class="token keyword">VIEW</span> v_user_orders <span class="token keyword">AS</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></span>
<span class="line"><span class="token keyword">CREATE</span> <span class="token keyword">VIEW</span> v_product_stats <span class="token keyword">AS</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_6-2-性能注意事项" tabindex="-1"><a class="header-anchor" href="#_6-2-性能注意事项"><span>6.2 性能注意事项</span></a></h3><p><strong>1. 避免嵌套过深</strong></p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token comment">-- ❌ 不推荐：视图嵌套过深</span></span>
<span class="line"><span class="token keyword">CREATE</span> <span class="token keyword">VIEW</span> v1 <span class="token keyword">AS</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> t1<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">CREATE</span> <span class="token keyword">VIEW</span> v2 <span class="token keyword">AS</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> v1<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">CREATE</span> <span class="token keyword">VIEW</span> v3 <span class="token keyword">AS</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> v2<span class="token punctuation">;</span>  <span class="token comment">-- 影响性能</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>2. 复杂视图考虑物化</strong></p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token comment">-- 对于复杂统计，考虑创建物理表定期更新</span></span>
<span class="line"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> t_user_stats <span class="token keyword">AS</span></span>
<span class="line"><span class="token keyword">SELECT</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token keyword">FROM</span> users <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">;</span>  <span class="token comment">-- 定期更新</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_6-3-安全性" tabindex="-1"><a class="header-anchor" href="#_6-3-安全性"><span>6.3 安全性</span></a></h3><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token comment">-- 创建视图时指定字段，不用 SELECT *</span></span>
<span class="line"><span class="token keyword">CREATE</span> <span class="token keyword">VIEW</span> v_users <span class="token keyword">AS</span></span>
<span class="line"><span class="token keyword">SELECT</span> id<span class="token punctuation">,</span> name<span class="token punctuation">,</span> email <span class="token keyword">FROM</span> users<span class="token punctuation">;</span>  <span class="token comment">-- ✅ 明确字段</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">-- 而不是</span></span>
<span class="line"><span class="token keyword">CREATE</span> <span class="token keyword">VIEW</span> v_users <span class="token keyword">AS</span></span>
<span class="line"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> users<span class="token punctuation">;</span>  <span class="token comment">-- ❌ 可能暴露敏感字段</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="七、本章总结" tabindex="-1"><a class="header-anchor" href="#七、本章总结"><span>七、本章总结</span></a></h2><h3 id="核心要点" tabindex="-1"><a class="header-anchor" href="#核心要点"><span>核心要点</span></a></h3><ol><li><strong>视图是虚拟表</strong>：只存储SQL定义，不存储数据</li><li><strong>简化查询</strong>：隐藏复杂SQL逻辑</li><li><strong>权限控制</strong>：不同用户看不同视图</li><li><strong>WITH CHECK OPTION</strong>：CASCADED递归检查，LOCAL只检查当前</li><li><strong>更新限制</strong>：包含聚合、DISTINCT、GROUP BY等的视图不可更新</li></ol><h3 id="使用建议" tabindex="-1"><a class="header-anchor" href="#使用建议"><span>使用建议</span></a></h3><table><thead><tr><th>场景</th><th>建议</th></tr></thead><tbody><tr><td>简化复杂查询</td><td>✅ 推荐使用视图</td></tr><tr><td>权限控制</td><td>✅ 推荐使用视图</td></tr><tr><td>频繁更新数据</td><td>❌ 不推荐视图</td></tr><tr><td>大量计算统计</td><td>⚠️ 考虑物化表</td></tr></tbody></table><hr><h2 id="练习题" tabindex="-1"><a class="header-anchor" href="#练习题"><span>练习题</span></a></h2><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token comment">-- 1. 创建学生成绩视图</span></span>
<span class="line"><span class="token keyword">CREATE</span> <span class="token keyword">VIEW</span> v_student_scores <span class="token keyword">AS</span></span>
<span class="line"><span class="token keyword">SELECT</span> </span>
<span class="line">    s<span class="token punctuation">.</span>id<span class="token punctuation">,</span></span>
<span class="line">    s<span class="token punctuation">.</span>name<span class="token punctuation">,</span></span>
<span class="line">    c<span class="token punctuation">.</span>course_name<span class="token punctuation">,</span></span>
<span class="line">    sc<span class="token punctuation">.</span>score</span>
<span class="line"><span class="token keyword">FROM</span> students s</span>
<span class="line"><span class="token keyword">JOIN</span> scores sc <span class="token keyword">ON</span> s<span class="token punctuation">.</span>id <span class="token operator">=</span> sc<span class="token punctuation">.</span>student_id</span>
<span class="line"><span class="token keyword">JOIN</span> courses c <span class="token keyword">ON</span> sc<span class="token punctuation">.</span>course_id <span class="token operator">=</span> c<span class="token punctuation">.</span>id<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">-- 2. 创建平均分统计视图</span></span>
<span class="line"><span class="token keyword">CREATE</span> <span class="token keyword">VIEW</span> v_avg_scores <span class="token keyword">AS</span></span>
<span class="line"><span class="token keyword">SELECT</span> </span>
<span class="line">    s<span class="token punctuation">.</span>id<span class="token punctuation">,</span></span>
<span class="line">    s<span class="token punctuation">.</span>name<span class="token punctuation">,</span></span>
<span class="line">    <span class="token function">AVG</span><span class="token punctuation">(</span>sc<span class="token punctuation">.</span>score<span class="token punctuation">)</span> <span class="token keyword">AS</span> avg_score<span class="token punctuation">,</span></span>
<span class="line">    <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> course_count</span>
<span class="line"><span class="token keyword">FROM</span> students s</span>
<span class="line"><span class="token keyword">JOIN</span> scores sc <span class="token keyword">ON</span> s<span class="token punctuation">.</span>id <span class="token operator">=</span> sc<span class="token punctuation">.</span>student_id</span>
<span class="line"><span class="token keyword">GROUP</span> <span class="token keyword">BY</span> s<span class="token punctuation">.</span>id<span class="token punctuation">,</span> s<span class="token punctuation">.</span>name<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">-- 3. 带检查选项的视图</span></span>
<span class="line"><span class="token keyword">CREATE</span> <span class="token keyword">VIEW</span> v_high_score <span class="token keyword">AS</span></span>
<span class="line"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> scores <span class="token keyword">WHERE</span> score <span class="token operator">&gt;=</span> <span class="token number">60</span></span>
<span class="line"><span class="token keyword">WITH</span> <span class="token keyword">CASCADED</span> <span class="token keyword">CHECK</span> <span class="token keyword">OPTION</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">-- 测试插入</span></span>
<span class="line"><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> v_high_score <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">85</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">-- ✅ 可以</span></span>
<span class="line"><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> v_high_score <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">-- ❌ 失败</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr>`,108)),a("p",null,[a("strong",null,[s[1]||(s[1]=n("下一章：",-1)),c(e,{to:"/tutorials/java-backend/mysql/%E7%AC%AC03%E7%AB%A0-%E9%AB%98%E7%BA%A7%E7%AF%87/11-%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B.html"},{default:o(()=>[...s[0]||(s[0]=[n("第11章 - 存储过程",-1)])]),_:1})]),s[2]||(s[2]=n(" →",-1))])])}const m=p(r,[["render",k]]),b=JSON.parse('{"path":"/tutorials/java-backend/mysql/di03zhang-gaojipian/10-shitu.html","title":"视图","lang":"zh-CN","frontmatter":{},"headers":[{"level":2,"title":"📋 本章目录","slug":"📋-本章目录","link":"#📋-本章目录","children":[]},{"level":2,"title":"一、视图概述","slug":"一、视图概述","link":"#一、视图概述","children":[{"level":3,"title":"1.1 什么是视图？","slug":"_1-1-什么是视图","link":"#_1-1-什么是视图","children":[]},{"level":3,"title":"1.2 视图 vs 表","slug":"_1-2-视图-vs-表","link":"#_1-2-视图-vs-表","children":[]},{"level":3,"title":"1.3 视图的优势","slug":"_1-3-视图的优势","link":"#_1-3-视图的优势","children":[]}]},{"level":2,"title":"二、视图操作","slug":"二、视图操作","link":"#二、视图操作","children":[{"level":3,"title":"2.1 创建视图","slug":"_2-1-创建视图","link":"#_2-1-创建视图","children":[]},{"level":3,"title":"2.2 查看视图","slug":"_2-2-查看视图","link":"#_2-2-查看视图","children":[]},{"level":3,"title":"2.3 修改视图","slug":"_2-3-修改视图","link":"#_2-3-修改视图","children":[]},{"level":3,"title":"2.4 删除视图","slug":"_2-4-删除视图","link":"#_2-4-删除视图","children":[]}]},{"level":2,"title":"三、检查选项","slug":"三、检查选项","link":"#三、检查选项","children":[{"level":3,"title":"3.1 WITH CHECK OPTION","slug":"_3-1-with-check-option","link":"#_3-1-with-check-option","children":[]},{"level":3,"title":"3.2 CASCADED（默认）","slug":"_3-2-cascaded-默认","link":"#_3-2-cascaded-默认","children":[]},{"level":3,"title":"3.3 LOCAL","slug":"_3-3-local","link":"#_3-3-local","children":[]},{"level":3,"title":"3.4 对比总结","slug":"_3-4-对比总结","link":"#_3-4-对比总结","children":[]}]},{"level":2,"title":"四、视图的更新","slug":"四、视图的更新","link":"#四、视图的更新","children":[{"level":3,"title":"4.1 可更新视图","slug":"_4-1-可更新视图","link":"#_4-1-可更新视图","children":[]},{"level":3,"title":"4.2 不可更新视图","slug":"_4-2-不可更新视图","link":"#_4-2-不可更新视图","children":[]},{"level":3,"title":"4.3 更新限制总结","slug":"_4-3-更新限制总结","link":"#_4-3-更新限制总结","children":[]}]},{"level":2,"title":"五、💼 实际工作中什么时候用视图？","slug":"五、💼-实际工作中什么时候用视图","link":"#五、💼-实际工作中什么时候用视图","children":[{"level":3,"title":"5.1 场景1：简化复杂查询（最常用）","slug":"_5-1-场景1-简化复杂查询-最常用","link":"#_5-1-场景1-简化复杂查询-最常用","children":[]},{"level":3,"title":"5.2 场景2：权限控制和数据安全（重要）","slug":"_5-2-场景2-权限控制和数据安全-重要","link":"#_5-2-场景2-权限控制和数据安全-重要","children":[]},{"level":3,"title":"5.3 数据格式转换","slug":"_5-3-数据格式转换","link":"#_5-3-数据格式转换","children":[]},{"level":3,"title":"5.4 兼容性","slug":"_5-4-兼容性","link":"#_5-4-兼容性","children":[]}]},{"level":2,"title":"六、最佳实践","slug":"六、最佳实践","link":"#六、最佳实践","children":[{"level":3,"title":"6.1 命名规范","slug":"_6-1-命名规范","link":"#_6-1-命名规范","children":[]},{"level":3,"title":"6.2 性能注意事项","slug":"_6-2-性能注意事项","link":"#_6-2-性能注意事项","children":[]},{"level":3,"title":"6.3 安全性","slug":"_6-3-安全性","link":"#_6-3-安全性","children":[]}]},{"level":2,"title":"七、本章总结","slug":"七、本章总结","link":"#七、本章总结","children":[{"level":3,"title":"核心要点","slug":"核心要点","link":"#核心要点","children":[]},{"level":3,"title":"使用建议","slug":"使用建议","link":"#使用建议","children":[]}]},{"level":2,"title":"练习题","slug":"练习题","link":"#练习题","children":[]}],"git":{"createdTime":1765249786000,"updatedTime":1765249786000,"contributors":[{"name":"CambridgeFoldingKnife","email":"3144253125@qq.com","commits":1}]},"filePathRelative":"tutorials/java-backend/mysql/第03章-高级篇/10-视图.md"}');export{m as comp,b as data};
