import{_ as o,c,d as i,e as s,f as a,b as p,w as u,r as t,o as r}from"./app-D9dfRPMK.js";const k={},d={href:"https://developer.harmonyos.com/cn/docs/documentation/doc-references-V3/js-apis-distributedkvstore-0000001428061992-V3",target:"_blank",rel:"noopener noreferrer"};function v(m,n){const e=t("ExternalLinkIcon"),l=t("RouteLink");return r(),c("div",null,[n[4]||(n[4]=i(`<h1 id="åˆ†å¸ƒå¼æ•°æ®æœåŠ¡" tabindex="-1"><a class="header-anchor" href="#åˆ†å¸ƒå¼æ•°æ®æœåŠ¡"><span>åˆ†å¸ƒå¼æ•°æ®æœåŠ¡</span></a></h1><blockquote><p>è·¨è®¾å¤‡æ•°æ®åŒæ­¥</p></blockquote><h2 id="ğŸŒ-åˆ†å¸ƒå¼æ•°æ®æ¦‚è¿°" tabindex="-1"><a class="header-anchor" href="#ğŸŒ-åˆ†å¸ƒå¼æ•°æ®æ¦‚è¿°"><span>ğŸŒ åˆ†å¸ƒå¼æ•°æ®æ¦‚è¿°</span></a></h2><p>åˆ†å¸ƒå¼æ•°æ®æœåŠ¡æ”¯æŒåœ¨å¤šè®¾å¤‡é—´è‡ªåŠ¨åŒæ­¥æ•°æ®ã€‚</p><h3 id="æ ¸å¿ƒç‰¹æ€§" tabindex="-1"><a class="header-anchor" href="#æ ¸å¿ƒç‰¹æ€§"><span>æ ¸å¿ƒç‰¹æ€§</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">åˆ†å¸ƒå¼æ•°æ®æœåŠ¡</span>
<span class="line">â”œâ”€ è‡ªåŠ¨åŒæ­¥ï¼ˆæ— éœ€æ‰‹åŠ¨å¤„ç†ï¼‰</span>
<span class="line">â”œâ”€ æ•°æ®ä¸€è‡´æ€§ï¼ˆæœ€ç»ˆä¸€è‡´ï¼‰</span>
<span class="line">â”œâ”€ å†²çªè§£å†³ï¼ˆè‡ªåŠ¨/æ‰‹åŠ¨ï¼‰</span>
<span class="line">â””â”€ ç¦»çº¿æ”¯æŒï¼ˆæ–­ç½‘åæ¢å¤åŒæ­¥ï¼‰</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ğŸ”§-åˆ†å¸ƒå¼æ•°æ®åº“" tabindex="-1"><a class="header-anchor" href="#ğŸ”§-åˆ†å¸ƒå¼æ•°æ®åº“"><span>ğŸ”§ åˆ†å¸ƒå¼æ•°æ®åº“</span></a></h2><h3 id="åˆ›å»ºåˆ†å¸ƒå¼æ•°æ®åº“" tabindex="-1"><a class="header-anchor" href="#åˆ›å»ºåˆ†å¸ƒå¼æ•°æ®åº“"><span>åˆ›å»ºåˆ†å¸ƒå¼æ•°æ®åº“</span></a></h3><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts" data-title="ts"><pre><code><span class="line"><span class="token keyword">import</span> distributedKVStore <span class="token keyword">from</span> <span class="token string">&#39;@ohos.data.distributedKVStore&#39;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// KVå­˜å‚¨é…ç½®</span></span>
<span class="line"><span class="token keyword">const</span> kvManagerConfig <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">  context<span class="token operator">:</span> context<span class="token punctuation">,</span></span>
<span class="line">  bundleName<span class="token operator">:</span> <span class="token string">&#39;com.example.myapp&#39;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// åˆ›å»º KVManager</span></span>
<span class="line"><span class="token keyword">const</span> kvManager <span class="token operator">=</span> distributedKVStore<span class="token punctuation">.</span><span class="token function">createKVManager</span><span class="token punctuation">(</span>kvManagerConfig<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// æ•°æ®åº“é…ç½®</span></span>
<span class="line"><span class="token keyword">const</span> options <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">  createIfMissing<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line">  encrypt<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span></span>
<span class="line">  backup<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span></span>
<span class="line">  autoSync<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>  <span class="token comment">// è‡ªåŠ¨åŒæ­¥</span></span>
<span class="line">  kvStoreType<span class="token operator">:</span> distributedKVStore<span class="token punctuation">.</span>KVStoreType<span class="token punctuation">.</span><span class="token constant">SINGLE_VERSION</span><span class="token punctuation">,</span></span>
<span class="line">  securityLevel<span class="token operator">:</span> distributedKVStore<span class="token punctuation">.</span>SecurityLevel<span class="token punctuation">.</span><span class="token constant">S1</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// åˆ›å»ºåˆ†å¸ƒå¼æ•°æ®åº“</span></span>
<span class="line"><span class="token keyword">const</span> kvStore <span class="token operator">=</span> <span class="token keyword">await</span> kvManager<span class="token punctuation">.</span><span class="token function">getKVStore</span><span class="token punctuation">(</span><span class="token string">&#39;myStore&#39;</span><span class="token punctuation">,</span> options<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="å†™å…¥æ•°æ®" tabindex="-1"><a class="header-anchor" href="#å†™å…¥æ•°æ®"><span>å†™å…¥æ•°æ®</span></a></h3><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts" data-title="ts"><pre><code><span class="line"><span class="token comment">// å†™å…¥å•ä¸ªé”®å€¼å¯¹</span></span>
<span class="line"><span class="token keyword">await</span> kvStore<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&#39;username&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;Alice&#39;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">await</span> kvStore<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&#39;age&#39;</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// å†™å…¥å¯¹è±¡ï¼ˆéœ€è¦åºåˆ—åŒ–ï¼‰</span></span>
<span class="line"><span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">  name<span class="token operator">:</span> <span class="token string">&#39;Alice&#39;</span><span class="token punctuation">,</span></span>
<span class="line">  age<span class="token operator">:</span> <span class="token number">25</span><span class="token punctuation">,</span></span>
<span class="line">  email<span class="token operator">:</span> <span class="token string">&#39;alice@example.com&#39;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">await</span> kvStore<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&#39;user&#39;</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="è¯»å–æ•°æ®" tabindex="-1"><a class="header-anchor" href="#è¯»å–æ•°æ®"><span>è¯»å–æ•°æ®</span></a></h3><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts" data-title="ts"><pre><code><span class="line"><span class="token comment">// è¯»å–å•ä¸ªå€¼</span></span>
<span class="line"><span class="token keyword">const</span> username <span class="token operator">=</span> <span class="token keyword">await</span> kvStore<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#39;username&#39;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;ç”¨æˆ·å:&#39;</span><span class="token punctuation">,</span> username<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// è¯»å–å¹¶è§£æå¯¹è±¡</span></span>
<span class="line"><span class="token keyword">const</span> userStr <span class="token operator">=</span> <span class="token keyword">await</span> kvStore<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#39;user&#39;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>userStr<span class="token punctuation">)</span></span>
<span class="line"><span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;ç”¨æˆ·:&#39;</span><span class="token punctuation">,</span> user<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="åˆ é™¤æ•°æ®" tabindex="-1"><a class="header-anchor" href="#åˆ é™¤æ•°æ®"><span>åˆ é™¤æ•°æ®</span></a></h3><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts" data-title="ts"><pre><code><span class="line"><span class="token comment">// åˆ é™¤å•ä¸ªé”®</span></span>
<span class="line"><span class="token keyword">await</span> kvStore<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token string">&#39;username&#39;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// åˆ é™¤å¤šä¸ªé”®</span></span>
<span class="line"><span class="token keyword">await</span> kvStore<span class="token punctuation">.</span><span class="token function">deleteBatch</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&#39;key1&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;key2&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;key3&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ğŸ”„-æ•°æ®åŒæ­¥" tabindex="-1"><a class="header-anchor" href="#ğŸ”„-æ•°æ®åŒæ­¥"><span>ğŸ”„ æ•°æ®åŒæ­¥</span></a></h2><h3 id="è‡ªåŠ¨åŒæ­¥" tabindex="-1"><a class="header-anchor" href="#è‡ªåŠ¨åŒæ­¥"><span>è‡ªåŠ¨åŒæ­¥</span></a></h3><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts" data-title="ts"><pre><code><span class="line"><span class="token comment">// åˆ›å»ºæ—¶å¯ç”¨è‡ªåŠ¨åŒæ­¥</span></span>
<span class="line"><span class="token keyword">const</span> options <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">  autoSync<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>  <span class="token comment">// è‡ªåŠ¨åŒæ­¥åˆ°å…¶ä»–è®¾å¤‡</span></span>
<span class="line">  <span class="token comment">// ... å…¶ä»–é…ç½®</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">const</span> kvStore <span class="token operator">=</span> <span class="token keyword">await</span> kvManager<span class="token punctuation">.</span><span class="token function">getKVStore</span><span class="token punctuation">(</span><span class="token string">&#39;syncStore&#39;</span><span class="token punctuation">,</span> options<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// å†™å…¥æ•°æ®ä¼šè‡ªåŠ¨åŒæ­¥</span></span>
<span class="line"><span class="token keyword">await</span> kvStore<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&#39;sharedData&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;This data will sync&#39;</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="æ‰‹åŠ¨åŒæ­¥" tabindex="-1"><a class="header-anchor" href="#æ‰‹åŠ¨åŒæ­¥"><span>æ‰‹åŠ¨åŒæ­¥</span></a></h3><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts" data-title="ts"><pre><code><span class="line"><span class="token keyword">import</span> deviceManager <span class="token keyword">from</span> <span class="token string">&#39;@ohos.distributedDeviceManager&#39;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// è·å–å¯ç”¨è®¾å¤‡åˆ—è¡¨</span></span>
<span class="line"><span class="token keyword">const</span> dmInstance <span class="token operator">=</span> deviceManager<span class="token punctuation">.</span><span class="token function">createDeviceManager</span><span class="token punctuation">(</span><span class="token string">&#39;com.example.myapp&#39;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">const</span> devices <span class="token operator">=</span> dmInstance<span class="token punctuation">.</span><span class="token function">getAvailableDeviceListSync</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// åŒæ­¥åˆ°æŒ‡å®šè®¾å¤‡</span></span>
<span class="line"><span class="token keyword">const</span> deviceIds <span class="token operator">=</span> devices<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>d <span class="token operator">=&gt;</span> d<span class="token punctuation">.</span>deviceId<span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">await</span> kvStore<span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span>deviceIds<span class="token punctuation">,</span> distributedKVStore<span class="token punctuation">.</span>SyncMode<span class="token punctuation">.</span><span class="token constant">PUSH_PULL</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ç›‘å¬åŒæ­¥å®Œæˆ" tabindex="-1"><a class="header-anchor" href="#ç›‘å¬åŒæ­¥å®Œæˆ"><span>ç›‘å¬åŒæ­¥å®Œæˆ</span></a></h3><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts" data-title="ts"><pre><code><span class="line"><span class="token comment">// ç›‘å¬åŒæ­¥å®Œæˆäº‹ä»¶</span></span>
<span class="line">kvStore<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;syncComplete&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;åŒæ­¥å®Œæˆ&#39;</span><span class="token punctuation">)</span></span>
<span class="line">  </span>
<span class="line">  data<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;è®¾å¤‡:&#39;</span><span class="token punctuation">,</span> result<span class="token punctuation">.</span>deviceId<span class="token punctuation">)</span></span>
<span class="line">    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;çŠ¶æ€:&#39;</span><span class="token punctuation">,</span> result<span class="token punctuation">.</span>status<span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ğŸ¯-å®æˆ˜æ¡ˆä¾‹" tabindex="-1"><a class="header-anchor" href="#ğŸ¯-å®æˆ˜æ¡ˆä¾‹"><span>ğŸ¯ å®æˆ˜æ¡ˆä¾‹</span></a></h2><h3 id="è·¨è®¾å¤‡å¾…åŠäº‹é¡¹" tabindex="-1"><a class="header-anchor" href="#è·¨è®¾å¤‡å¾…åŠäº‹é¡¹"><span>è·¨è®¾å¤‡å¾…åŠäº‹é¡¹</span></a></h3><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts" data-title="ts"><pre><code><span class="line"><span class="token keyword">import</span> distributedKVStore <span class="token keyword">from</span> <span class="token string">&#39;@ohos.data.distributedKVStore&#39;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">DistributedTodoStore</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">private</span> kvStore<span class="token operator">:</span> distributedKVStore<span class="token punctuation">.</span>SingleKVStore</span>
<span class="line">  <span class="token keyword">private</span> kvManager<span class="token operator">:</span> distributedKVStore<span class="token punctuation">.</span>KVManager</span>
<span class="line">  </span>
<span class="line">  <span class="token keyword">async</span> <span class="token function">init</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// åˆ›å»º KVManager</span></span>
<span class="line">    <span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">      context<span class="token operator">:</span> context<span class="token punctuation">,</span></span>
<span class="line">      bundleName<span class="token operator">:</span> <span class="token string">&#39;com.example.todoapp&#39;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">this</span><span class="token punctuation">.</span>kvManager <span class="token operator">=</span> distributedKVStore<span class="token punctuation">.</span><span class="token function">createKVManager</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment">// åˆ›å»ºåˆ†å¸ƒå¼æ•°æ®åº“</span></span>
<span class="line">    <span class="token keyword">const</span> options <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">      createIfMissing<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line">      encrypt<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span></span>
<span class="line">      backup<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line">      autoSync<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line">      kvStoreType<span class="token operator">:</span> distributedKVStore<span class="token punctuation">.</span>KVStoreType<span class="token punctuation">.</span><span class="token constant">SINGLE_VERSION</span><span class="token punctuation">,</span></span>
<span class="line">      securityLevel<span class="token operator">:</span> distributedKVStore<span class="token punctuation">.</span>SecurityLevel<span class="token punctuation">.</span><span class="token constant">S1</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">this</span><span class="token punctuation">.</span>kvStore <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>kvManager<span class="token punctuation">.</span><span class="token function">getKVStore</span><span class="token punctuation">(</span><span class="token string">&#39;todoStore&#39;</span><span class="token punctuation">,</span> options<span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment">// ç›‘å¬æ•°æ®å˜åŒ–</span></span>
<span class="line">    <span class="token keyword">this</span><span class="token punctuation">.</span>kvStore<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;dataChange&#39;</span><span class="token punctuation">,</span> distributedKVStore<span class="token punctuation">.</span>SubscribeType<span class="token punctuation">.</span><span class="token constant">SUBSCRIBE_TYPE_ALL</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;æ•°æ®å˜åŒ–:&#39;</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span></span>
<span class="line">      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handleDataChange</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  </span>
<span class="line">  <span class="token comment">// æ·»åŠ å¾…åŠ</span></span>
<span class="line">  <span class="token keyword">async</span> <span class="token function">addTodo</span><span class="token punctuation">(</span>todo<span class="token operator">:</span> Todo<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> key <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">todo_</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>todo<span class="token punctuation">.</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span></span>
<span class="line">    <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>kvStore<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>todo<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  </span>
<span class="line">  <span class="token comment">// è·å–æ‰€æœ‰å¾…åŠ</span></span>
<span class="line">  <span class="token keyword">async</span> <span class="token function">getAllTodos</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>Todo<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> entries <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>kvStore<span class="token punctuation">.</span><span class="token function">getEntries</span><span class="token punctuation">(</span><span class="token string">&#39;todo_&#39;</span><span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">const</span> todos<span class="token operator">:</span> Todo<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></span>
<span class="line">    entries<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>entry<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">const</span> todo <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>entry<span class="token punctuation">.</span>value<span class="token punctuation">.</span>value<span class="token punctuation">)</span></span>
<span class="line">        todos<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>todo<span class="token punctuation">)</span></span>
<span class="line">      <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&#39;è§£æå¤±è´¥:&#39;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">return</span> todos<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> a<span class="token punctuation">.</span>createdAt <span class="token operator">-</span> b<span class="token punctuation">.</span>createdAt<span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  </span>
<span class="line">  <span class="token comment">// æ›´æ–°å¾…åŠ</span></span>
<span class="line">  <span class="token keyword">async</span> <span class="token function">updateTodo</span><span class="token punctuation">(</span>id<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> updates<span class="token operator">:</span> Partial<span class="token operator">&lt;</span>Todo<span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> key <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">todo_</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span></span>
<span class="line">    <span class="token keyword">const</span> todoStr <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>kvStore<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>todoStr<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">const</span> todo <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>todoStr<span class="token punctuation">)</span></span>
<span class="line">      <span class="token keyword">const</span> updated <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token operator">...</span>todo<span class="token punctuation">,</span> <span class="token operator">...</span>updates <span class="token punctuation">}</span></span>
<span class="line">      <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>kvStore<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>updated<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  </span>
<span class="line">  <span class="token comment">// åˆ é™¤å¾…åŠ</span></span>
<span class="line">  <span class="token keyword">async</span> <span class="token function">deleteTodo</span><span class="token punctuation">(</span>id<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> key <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">todo_</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span></span>
<span class="line">    <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>kvStore<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  </span>
<span class="line">  <span class="token comment">// å¤„ç†æ•°æ®å˜åŒ–</span></span>
<span class="line">  <span class="token keyword">private</span> <span class="token function">handleDataChange</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// é€šçŸ¥UIæ›´æ–°</span></span>
<span class="line">    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;å…¶ä»–è®¾å¤‡åŒæ­¥äº†æ•°æ®&#39;</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  </span>
<span class="line">  <span class="token comment">// åŒæ­¥åˆ°æŒ‡å®šè®¾å¤‡</span></span>
<span class="line">  <span class="token keyword">async</span> <span class="token function">syncToDevice</span><span class="token punctuation">(</span>deviceId<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>kvStore<span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">[</span>deviceId<span class="token punctuation">]</span><span class="token punctuation">,</span> distributedKVStore<span class="token punctuation">.</span>SyncMode<span class="token punctuation">.</span><span class="token constant">PUSH_PULL</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">interface</span> <span class="token class-name">Todo</span> <span class="token punctuation">{</span></span>
<span class="line">  id<span class="token operator">:</span> <span class="token builtin">string</span></span>
<span class="line">  title<span class="token operator">:</span> <span class="token builtin">string</span></span>
<span class="line">  done<span class="token operator">:</span> <span class="token builtin">boolean</span></span>
<span class="line">  createdAt<span class="token operator">:</span> <span class="token builtin">number</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// ä½¿ç”¨</span></span>
<span class="line"><span class="token decorator"><span class="token at operator">@</span><span class="token function">Entry</span></span></span>
<span class="line"><span class="token decorator"><span class="token at operator">@</span><span class="token function">Component</span></span></span>
<span class="line">struct TodoApp <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">private</span> todoStore<span class="token operator">:</span> DistributedTodoStore <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DistributedTodoStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token decorator"><span class="token at operator">@</span><span class="token function">State</span></span> todos<span class="token operator">:</span> Todo<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></span>
<span class="line">  </span>
<span class="line">  <span class="token keyword">async</span> <span class="token function">aboutToAppear</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>todoStore<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">loadTodos</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  </span>
<span class="line">  <span class="token keyword">async</span> <span class="token function">loadTodos</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">this</span><span class="token punctuation">.</span>todos <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>todoStore<span class="token punctuation">.</span><span class="token function">getAllTodos</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  </span>
<span class="line">  <span class="token keyword">async</span> <span class="token function">addTodo</span><span class="token punctuation">(</span>title<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> todo<span class="token operator">:</span> Todo <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">      id<span class="token operator">:</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">      title<span class="token operator">:</span> title<span class="token punctuation">,</span></span>
<span class="line">      done<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span></span>
<span class="line">      createdAt<span class="token operator">:</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>todoStore<span class="token punctuation">.</span><span class="token function">addTodo</span><span class="token punctuation">(</span>todo<span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">loadTodos</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  </span>
<span class="line">  <span class="token keyword">async</span> <span class="token function">toggleTodo</span><span class="token punctuation">(</span>id<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> todo <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>todos<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>t <span class="token operator">=&gt;</span> t<span class="token punctuation">.</span>id <span class="token operator">===</span> id<span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>todo<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>todoStore<span class="token punctuation">.</span><span class="token function">updateTodo</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> <span class="token punctuation">{</span> done<span class="token operator">:</span> <span class="token operator">!</span>todo<span class="token punctuation">.</span>done <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">      <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">loadTodos</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  </span>
<span class="line">  <span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">Column</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">&#39;è·¨è®¾å¤‡å¾…åŠäº‹é¡¹&#39;</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">.</span><span class="token function">fontSize</span><span class="token punctuation">(</span><span class="token number">24</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">.</span><span class="token function">fontWeight</span><span class="token punctuation">(</span>FontWeight<span class="token punctuation">.</span>Bold<span class="token punctuation">)</span></span>
<span class="line">      </span>
<span class="line">      <span class="token function">List</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token function">ForEach</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>todos<span class="token punctuation">,</span> <span class="token punctuation">(</span>todo<span class="token operator">:</span> Todo<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">          <span class="token function">ListItem</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token function">Row</span><span class="token punctuation">(</span><span class="token punctuation">{</span> space<span class="token operator">:</span> <span class="token number">10</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">              <span class="token function">Checkbox</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">                <span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span>todo<span class="token punctuation">.</span>done<span class="token punctuation">)</span></span>
<span class="line">                <span class="token punctuation">.</span><span class="token function">onChange</span><span class="token punctuation">(</span><span class="token punctuation">(</span>checked<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">                  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">toggleTodo</span><span class="token punctuation">(</span>todo<span class="token punctuation">.</span>id<span class="token punctuation">)</span></span>
<span class="line">                <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">              </span>
<span class="line">              <span class="token function">Text</span><span class="token punctuation">(</span>todo<span class="token punctuation">.</span>title<span class="token punctuation">)</span></span>
<span class="line">                <span class="token punctuation">.</span><span class="token function">decoration</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">                  type<span class="token operator">:</span> todo<span class="token punctuation">.</span>done <span class="token operator">?</span> TextDecorationType<span class="token punctuation">.</span>LineThrough <span class="token operator">:</span> TextDecorationType<span class="token punctuation">.</span>None</span>
<span class="line">                <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">            <span class="token punctuation">.</span><span class="token function">padding</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span></span>
<span class="line">          <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">      </span>
<span class="line">      <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">&#39;æ•°æ®ä¼šè‡ªåŠ¨åŒæ­¥åˆ°å…¶ä»–è®¾å¤‡&#39;</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">.</span><span class="token function">fontSize</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">.</span><span class="token function">fontColor</span><span class="token punctuation">(</span>Color<span class="token punctuation">.</span>Gray<span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">.</span><span class="token function">margin</span><span class="token punctuation">(</span><span class="token punctuation">{</span> top<span class="token operator">:</span> <span class="token number">10</span> <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">padding</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="âš–ï¸-å†²çªè§£å†³" tabindex="-1"><a class="header-anchor" href="#âš–ï¸-å†²çªè§£å†³"><span>âš–ï¸ å†²çªè§£å†³</span></a></h2><h3 id="è‡ªåŠ¨è§£å†³" tabindex="-1"><a class="header-anchor" href="#è‡ªåŠ¨è§£å†³"><span>è‡ªåŠ¨è§£å†³</span></a></h3><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts" data-title="ts"><pre><code><span class="line"><span class="token comment">// é»˜è®¤ç­–ç•¥ï¼šæœ€åå†™å…¥è·èƒœï¼ˆLast Write Winsï¼‰</span></span>
<span class="line"><span class="token comment">// æ—¶é—´æˆ³è¶Šæ–°çš„æ•°æ®ä¼šè¦†ç›–æ—§æ•°æ®</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="æ‰‹åŠ¨è§£å†³" tabindex="-1"><a class="header-anchor" href="#æ‰‹åŠ¨è§£å†³"><span>æ‰‹åŠ¨è§£å†³</span></a></h3><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts" data-title="ts"><pre><code><span class="line">kvStore<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;dataChange&#39;</span><span class="token punctuation">,</span> distributedKVStore<span class="token punctuation">.</span>SubscribeType<span class="token punctuation">.</span><span class="token constant">SUBSCRIBE_TYPE_ALL</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> entry <span class="token keyword">of</span> data<span class="token punctuation">.</span>updateEntries<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> key <span class="token operator">=</span> entry<span class="token punctuation">.</span>key</span>
<span class="line">    <span class="token keyword">const</span> localValue <span class="token operator">=</span> <span class="token keyword">await</span> kvStore<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">const</span> remoteValue <span class="token operator">=</span> entry<span class="token punctuation">.</span>value<span class="token punctuation">.</span>value</span>
<span class="line">    </span>
<span class="line">    <span class="token comment">// è‡ªå®šä¹‰å†²çªè§£å†³é€»è¾‘</span></span>
<span class="line">    <span class="token keyword">const</span> resolved <span class="token operator">=</span> <span class="token function">resolveConflict</span><span class="token punctuation">(</span>localValue<span class="token punctuation">,</span> remoteValue<span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">await</span> kvStore<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> resolved<span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">resolveConflict</span><span class="token punctuation">(</span>local<span class="token punctuation">,</span> remote<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token comment">// è‡ªå®šä¹‰è§£å†³ç­–ç•¥</span></span>
<span class="line">  <span class="token comment">// ä¾‹å¦‚ï¼šåˆå¹¶æ•°æ®ã€é€‰æ‹©è¾ƒå¤§å€¼ç­‰</span></span>
<span class="line">  <span class="token keyword">return</span> local  <span class="token comment">// æˆ– remote</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ğŸ’¡-æœ€ä½³å®è·µ" tabindex="-1"><a class="header-anchor" href="#ğŸ’¡-æœ€ä½³å®è·µ"><span>ğŸ’¡ æœ€ä½³å®è·µ</span></a></h2><h3 id="_1-åˆç†ä½¿ç”¨åˆ†å¸ƒå¼æ•°æ®åº“" tabindex="-1"><a class="header-anchor" href="#_1-åˆç†ä½¿ç”¨åˆ†å¸ƒå¼æ•°æ®åº“"><span>1. åˆç†ä½¿ç”¨åˆ†å¸ƒå¼æ•°æ®åº“</span></a></h3><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts" data-title="ts"><pre><code><span class="line"><span class="token comment">// âœ… é€‚åˆåˆ†å¸ƒå¼å­˜å‚¨</span></span>
<span class="line"><span class="token operator">-</span> ç”¨æˆ·åå¥½è®¾ç½®</span>
<span class="line"><span class="token operator">-</span> å¾…åŠäº‹é¡¹</span>
<span class="line"><span class="token operator">-</span> ç¬”è®°æ•°æ®</span>
<span class="line"><span class="token operator">-</span> è´­ç‰©æ¸…å•</span>
<span class="line"></span>
<span class="line"><span class="token comment">// âŒ ä¸é€‚åˆåˆ†å¸ƒå¼å­˜å‚¨</span></span>
<span class="line"><span class="token operator">-</span> å¤§æ–‡ä»¶</span>
<span class="line"><span class="token operator">-</span> æ•æ„Ÿæ•°æ®</span>
<span class="line"><span class="token operator">-</span> ä¸´æ—¶æ•°æ®</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-æ•°æ®ç‰ˆæœ¬ç®¡ç†" tabindex="-1"><a class="header-anchor" href="#_2-æ•°æ®ç‰ˆæœ¬ç®¡ç†"><span>2. æ•°æ®ç‰ˆæœ¬ç®¡ç†</span></a></h3><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts" data-title="ts"><pre><code><span class="line"><span class="token keyword">interface</span> <span class="token class-name">DataWithVersion</span> <span class="token punctuation">{</span></span>
<span class="line">  data<span class="token operator">:</span> <span class="token builtin">any</span></span>
<span class="line">  version<span class="token operator">:</span> <span class="token builtin">number</span></span>
<span class="line">  updatedAt<span class="token operator">:</span> <span class="token builtin">number</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">putWithVersion</span><span class="token punctuation">(</span>key<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> data<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> item<span class="token operator">:</span> DataWithVersion <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">    data<span class="token operator">:</span> data<span class="token punctuation">,</span></span>
<span class="line">    version<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span></span>
<span class="line">    updatedAt<span class="token operator">:</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  </span>
<span class="line">  <span class="token keyword">await</span> kvStore<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-é”™è¯¯å¤„ç†" tabindex="-1"><a class="header-anchor" href="#_3-é”™è¯¯å¤„ç†"><span>3. é”™è¯¯å¤„ç†</span></a></h3><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts" data-title="ts"><pre><code><span class="line"><span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">await</span> kvStore<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&#39;key&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;value&#39;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&#39;å†™å…¥å¤±è´¥:&#39;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span></span>
<span class="line">  <span class="token comment">// é™çº§åˆ°æœ¬åœ°å­˜å‚¨</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ğŸ“š-å‚è€ƒèµ„æº" tabindex="-1"><a class="header-anchor" href="#ğŸ“š-å‚è€ƒèµ„æº"><span>ğŸ“š å‚è€ƒèµ„æº</span></a></h2>`,38)),s("ul",null,[s("li",null,[s("a",d,[n[0]||(n[0]=a("åˆ†å¸ƒå¼æ•°æ®æœåŠ¡å®˜æ–¹æ–‡æ¡£",-1)),p(e)])])]),n[5]||(n[5]=s("hr",null,null,-1)),s("p",null,[n[2]||(n[2]=s("strong",null,"ç¬¬7ç« å®Œæˆï¼",-1)),n[3]||(n[3]=a(" ç»§ç»­å­¦ä¹  â†’ ",-1)),p(l,{to:"/tutorials/harmonyos-dev/08-network-connect/"},{default:u(()=>[...n[1]||(n[1]=[a("ç¬¬8ç« ï¼šç½‘ç»œä¸è¿æ¥",-1)])]),_:1})])])}const h=o(k,[["render",v]]),y=JSON.parse('{"path":"/tutorials/harmonyos-dev/07-data-management/03-fenbushishujufuwu.html","title":"åˆ†å¸ƒå¼æ•°æ®æœåŠ¡","lang":"zh-CN","frontmatter":{"title":"åˆ†å¸ƒå¼æ•°æ®æœåŠ¡","date":"2025-01-22T00:00:00.000Z"},"headers":[{"level":2,"title":"ğŸŒ åˆ†å¸ƒå¼æ•°æ®æ¦‚è¿°","slug":"ğŸŒ-åˆ†å¸ƒå¼æ•°æ®æ¦‚è¿°","link":"#ğŸŒ-åˆ†å¸ƒå¼æ•°æ®æ¦‚è¿°","children":[{"level":3,"title":"æ ¸å¿ƒç‰¹æ€§","slug":"æ ¸å¿ƒç‰¹æ€§","link":"#æ ¸å¿ƒç‰¹æ€§","children":[]}]},{"level":2,"title":"ğŸ”§ åˆ†å¸ƒå¼æ•°æ®åº“","slug":"ğŸ”§-åˆ†å¸ƒå¼æ•°æ®åº“","link":"#ğŸ”§-åˆ†å¸ƒå¼æ•°æ®åº“","children":[{"level":3,"title":"åˆ›å»ºåˆ†å¸ƒå¼æ•°æ®åº“","slug":"åˆ›å»ºåˆ†å¸ƒå¼æ•°æ®åº“","link":"#åˆ›å»ºåˆ†å¸ƒå¼æ•°æ®åº“","children":[]},{"level":3,"title":"å†™å…¥æ•°æ®","slug":"å†™å…¥æ•°æ®","link":"#å†™å…¥æ•°æ®","children":[]},{"level":3,"title":"è¯»å–æ•°æ®","slug":"è¯»å–æ•°æ®","link":"#è¯»å–æ•°æ®","children":[]},{"level":3,"title":"åˆ é™¤æ•°æ®","slug":"åˆ é™¤æ•°æ®","link":"#åˆ é™¤æ•°æ®","children":[]}]},{"level":2,"title":"ğŸ”„ æ•°æ®åŒæ­¥","slug":"ğŸ”„-æ•°æ®åŒæ­¥","link":"#ğŸ”„-æ•°æ®åŒæ­¥","children":[{"level":3,"title":"è‡ªåŠ¨åŒæ­¥","slug":"è‡ªåŠ¨åŒæ­¥","link":"#è‡ªåŠ¨åŒæ­¥","children":[]},{"level":3,"title":"æ‰‹åŠ¨åŒæ­¥","slug":"æ‰‹åŠ¨åŒæ­¥","link":"#æ‰‹åŠ¨åŒæ­¥","children":[]},{"level":3,"title":"ç›‘å¬åŒæ­¥å®Œæˆ","slug":"ç›‘å¬åŒæ­¥å®Œæˆ","link":"#ç›‘å¬åŒæ­¥å®Œæˆ","children":[]}]},{"level":2,"title":"ğŸ¯ å®æˆ˜æ¡ˆä¾‹","slug":"ğŸ¯-å®æˆ˜æ¡ˆä¾‹","link":"#ğŸ¯-å®æˆ˜æ¡ˆä¾‹","children":[{"level":3,"title":"è·¨è®¾å¤‡å¾…åŠäº‹é¡¹","slug":"è·¨è®¾å¤‡å¾…åŠäº‹é¡¹","link":"#è·¨è®¾å¤‡å¾…åŠäº‹é¡¹","children":[]}]},{"level":2,"title":"âš–ï¸ å†²çªè§£å†³","slug":"âš–ï¸-å†²çªè§£å†³","link":"#âš–ï¸-å†²çªè§£å†³","children":[{"level":3,"title":"è‡ªåŠ¨è§£å†³","slug":"è‡ªåŠ¨è§£å†³","link":"#è‡ªåŠ¨è§£å†³","children":[]},{"level":3,"title":"æ‰‹åŠ¨è§£å†³","slug":"æ‰‹åŠ¨è§£å†³","link":"#æ‰‹åŠ¨è§£å†³","children":[]}]},{"level":2,"title":"ğŸ’¡ æœ€ä½³å®è·µ","slug":"ğŸ’¡-æœ€ä½³å®è·µ","link":"#ğŸ’¡-æœ€ä½³å®è·µ","children":[{"level":3,"title":"1. åˆç†ä½¿ç”¨åˆ†å¸ƒå¼æ•°æ®åº“","slug":"_1-åˆç†ä½¿ç”¨åˆ†å¸ƒå¼æ•°æ®åº“","link":"#_1-åˆç†ä½¿ç”¨åˆ†å¸ƒå¼æ•°æ®åº“","children":[]},{"level":3,"title":"2. æ•°æ®ç‰ˆæœ¬ç®¡ç†","slug":"_2-æ•°æ®ç‰ˆæœ¬ç®¡ç†","link":"#_2-æ•°æ®ç‰ˆæœ¬ç®¡ç†","children":[]},{"level":3,"title":"3. é”™è¯¯å¤„ç†","slug":"_3-é”™è¯¯å¤„ç†","link":"#_3-é”™è¯¯å¤„ç†","children":[]}]},{"level":2,"title":"ğŸ“š å‚è€ƒèµ„æº","slug":"ğŸ“š-å‚è€ƒèµ„æº","link":"#ğŸ“š-å‚è€ƒèµ„æº","children":[]}],"git":{"createdTime":1765250065000,"updatedTime":1765250065000,"contributors":[{"name":"CambridgeFoldingKnife","email":"3144253125@qq.com","commits":1}]},"filePathRelative":"tutorials/harmonyos-dev/07-data-management/03-åˆ†å¸ƒå¼æ•°æ®æœåŠ¡.md"}');export{h as comp,y as data};
