import{_ as l,c as o,d as i,e as s,f as a,b as p,w as u,r as e,o as r}from"./app-DyGs7pMe.js";const k={},d={href:"https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/arkts-ui-widget-event-formextensionability-0000001820880565-V5",target:"_blank",rel:"noopener noreferrer"},v={href:"https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V5/js-apis-app-form-formBindingData-0000001821000653-V5",target:"_blank",rel:"noopener noreferrer"};function m(b,n){const t=e("ExternalLinkIcon"),c=e("RouteLink");return r(),o("div",null,[n[5]||(n[5]=i(`<h1 id="å¡ç‰‡äº¤äº’" tabindex="-1"><a class="header-anchor" href="#å¡ç‰‡äº¤äº’"><span>å¡ç‰‡äº¤äº’</span></a></h1><blockquote><p>å®ç°å¡ç‰‡ä¸åº”ç”¨çš„äº¤äº’</p></blockquote><h2 id="ğŸ”—-å¡ç‰‡äº‹ä»¶" tabindex="-1"><a class="header-anchor" href="#ğŸ”—-å¡ç‰‡äº‹ä»¶"><span>ğŸ”— å¡ç‰‡äº‹ä»¶</span></a></h2><h3 id="postcardaction-å‘é€äº‹ä»¶" tabindex="-1"><a class="header-anchor" href="#postcardaction-å‘é€äº‹ä»¶"><span>postCardAction å‘é€äº‹ä»¶</span></a></h3><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts" data-title="ts"><pre><code><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> postCardAction <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@kit.FormKit&#39;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// æ¶ˆæ¯äº‹ä»¶</span></span>
<span class="line"><span class="token function">postCardAction</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token punctuation">{</span></span>
<span class="line">  action<span class="token operator">:</span> formInfo<span class="token punctuation">.</span>FormAction<span class="token punctuation">.</span><span class="token constant">MESSAGE</span><span class="token punctuation">,</span></span>
<span class="line">  params<span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">    method<span class="token operator">:</span> <span class="token string">&#39;refresh&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    data<span class="token operator">:</span> <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">123</span> <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// è·¯ç”±äº‹ä»¶</span></span>
<span class="line"><span class="token function">postCardAction</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token punctuation">{</span></span>
<span class="line">  action<span class="token operator">:</span> formInfo<span class="token punctuation">.</span>FormAction<span class="token punctuation">.</span><span class="token constant">ROUTER_EVENT</span><span class="token punctuation">,</span></span>
<span class="line">  abilityName<span class="token operator">:</span> <span class="token string">&#39;MainAbility&#39;</span><span class="token punctuation">,</span></span>
<span class="line">  params<span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    page<span class="token operator">:</span> <span class="token string">&#39;pages/Detail&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    id<span class="token operator">:</span> <span class="token number">123</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ğŸ¯-ç‚¹å‡»è·³è½¬" tabindex="-1"><a class="header-anchor" href="#ğŸ¯-ç‚¹å‡»è·³è½¬"><span>ğŸ¯ ç‚¹å‡»è·³è½¬</span></a></h2><h3 id="è·³è½¬åˆ°åº”ç”¨é¡µé¢" tabindex="-1"><a class="header-anchor" href="#è·³è½¬åˆ°åº”ç”¨é¡µé¢"><span>è·³è½¬åˆ°åº”ç”¨é¡µé¢</span></a></h3><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts" data-title="ts"><pre><code><span class="line"><span class="token decorator"><span class="token at operator">@</span><span class="token function">Entry</span></span></span>
<span class="line"><span class="token decorator"><span class="token at operator">@</span><span class="token function">Component</span></span></span>
<span class="line">struct WeatherCard <span class="token punctuation">{</span></span>
<span class="line">  <span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">Column</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">&#39;æŸ¥çœ‹è¯¦æƒ…&#39;</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">.</span><span class="token function">onClick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">          <span class="token function">postCardAction</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token punctuation">{</span></span>
<span class="line">            action<span class="token operator">:</span> formInfo<span class="token punctuation">.</span>FormAction<span class="token punctuation">.</span><span class="token constant">ROUTER_EVENT</span><span class="token punctuation">,</span></span>
<span class="line">            abilityName<span class="token operator">:</span> <span class="token string">&#39;EntryAbility&#39;</span><span class="token punctuation">,</span></span>
<span class="line">            params<span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">              page<span class="token operator">:</span> <span class="token string">&#39;pages/WeatherDetail&#39;</span><span class="token punctuation">,</span></span>
<span class="line">              city<span class="token operator">:</span> <span class="token string">&#39;åŒ—äº¬&#39;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">          <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// åº”ç”¨ä¸­å¤„ç†è·³è½¬</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">EntryAbility</span> <span class="token keyword">extends</span> <span class="token class-name">UIAbility</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token function">onNewWant</span><span class="token punctuation">(</span>want<span class="token punctuation">,</span> launchParam<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>launchParam<span class="token punctuation">.</span>launchReason <span class="token operator">===</span> AbilityConstant<span class="token punctuation">.</span>LaunchReason<span class="token punctuation">.</span><span class="token constant">CARD</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">const</span> params <span class="token operator">=</span> want<span class="token punctuation">.</span>parameters</span>
<span class="line">      <span class="token keyword">const</span> page <span class="token operator">=</span> params<span class="token operator">?.</span><span class="token punctuation">[</span><span class="token string">&#39;page&#39;</span><span class="token punctuation">]</span></span>
<span class="line">      <span class="token keyword">const</span> city <span class="token operator">=</span> params<span class="token operator">?.</span><span class="token punctuation">[</span><span class="token string">&#39;city&#39;</span><span class="token punctuation">]</span></span>
<span class="line">      </span>
<span class="line">      <span class="token comment">// è·³è½¬åˆ°æŒ‡å®šé¡µé¢</span></span>
<span class="line">      router<span class="token punctuation">.</span><span class="token function">pushUrl</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">        url<span class="token operator">:</span> page<span class="token punctuation">,</span></span>
<span class="line">        params<span class="token operator">:</span> <span class="token punctuation">{</span> city <span class="token punctuation">}</span></span>
<span class="line">      <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ğŸ”„-åŠ¨æ€æ›´æ–°" tabindex="-1"><a class="header-anchor" href="#ğŸ”„-åŠ¨æ€æ›´æ–°"><span>ğŸ”„ åŠ¨æ€æ›´æ–°</span></a></h2><h3 id="ä¸»åŠ¨æ›´æ–°å¡ç‰‡æ•°æ®" tabindex="-1"><a class="header-anchor" href="#ä¸»åŠ¨æ›´æ–°å¡ç‰‡æ•°æ®"><span>ä¸»åŠ¨æ›´æ–°å¡ç‰‡æ•°æ®</span></a></h3><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts" data-title="ts"><pre><code><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> formProvider<span class="token punctuation">,</span> formBindingData <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@kit.FormKit&#39;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">WeatherService</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">async</span> <span class="token function">updateWeatherCard</span><span class="token punctuation">(</span>formId<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// è·å–æœ€æ–°æ•°æ®</span></span>
<span class="line">    <span class="token keyword">const</span> weatherData <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">fetchWeather</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment">// æ›´æ–°å¡ç‰‡</span></span>
<span class="line">    <span class="token keyword">const</span> formData <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">      temperature<span class="token operator">:</span> weatherData<span class="token punctuation">.</span>temp<span class="token punctuation">,</span></span>
<span class="line">      weather<span class="token operator">:</span> weatherData<span class="token punctuation">.</span>condition<span class="token punctuation">,</span></span>
<span class="line">      updateTime<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toLocaleTimeString</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">await</span> formProvider<span class="token punctuation">.</span><span class="token function">updateForm</span><span class="token punctuation">(</span></span>
<span class="line">        formId<span class="token punctuation">,</span></span>
<span class="line">        formBindingData<span class="token punctuation">.</span><span class="token function">createFormBindingData</span><span class="token punctuation">(</span>formData<span class="token punctuation">)</span></span>
<span class="line">      <span class="token punctuation">)</span></span>
<span class="line">      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;å¡ç‰‡æ›´æ–°æˆåŠŸ&#39;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&#39;å¡ç‰‡æ›´æ–°å¤±è´¥:&#39;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  </span>
<span class="line">  <span class="token keyword">async</span> <span class="token function">fetchWeather</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// è°ƒç”¨å¤©æ°”API</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token punctuation">{</span></span>
<span class="line">      temp<span class="token operator">:</span> <span class="token string">&#39;28Â°C&#39;</span><span class="token punctuation">,</span></span>
<span class="line">      condition<span class="token operator">:</span> <span class="token string">&#39;æ™´å¤©&#39;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="æ‰¹é‡æ›´æ–°å¤šä¸ªå¡ç‰‡" tabindex="-1"><a class="header-anchor" href="#æ‰¹é‡æ›´æ–°å¤šä¸ªå¡ç‰‡"><span>æ‰¹é‡æ›´æ–°å¤šä¸ªå¡ç‰‡</span></a></h3><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts" data-title="ts"><pre><code><span class="line"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">updateAllCards</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token comment">// è·å–æ‰€æœ‰å¡ç‰‡ID</span></span>
<span class="line">  <span class="token keyword">const</span> formIds <span class="token operator">=</span> <span class="token keyword">await</span> formHost<span class="token punctuation">.</span><span class="token function">getAllFormsInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">  </span>
<span class="line">  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> formInfo <span class="token keyword">of</span> formIds<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">await</span> <span class="token function">updateWeatherCard</span><span class="token punctuation">(</span>formInfo<span class="token punctuation">.</span>formId<span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="â°-å®šæ—¶åˆ·æ–°" tabindex="-1"><a class="header-anchor" href="#â°-å®šæ—¶åˆ·æ–°"><span>â° å®šæ—¶åˆ·æ–°</span></a></h2><h3 id="åå°å®šæ—¶ä»»åŠ¡" tabindex="-1"><a class="header-anchor" href="#åå°å®šæ—¶ä»»åŠ¡"><span>åå°å®šæ—¶ä»»åŠ¡</span></a></h3><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts" data-title="ts"><pre><code><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> backgroundTaskManager <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@kit.BackgroundTasksKit&#39;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">CardUpdateService</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">private</span> timerId<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span></span>
<span class="line">  </span>
<span class="line">  <span class="token function">startPeriodicUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// ç”³è¯·åå°é•¿æ—¶ä»»åŠ¡</span></span>
<span class="line">    backgroundTaskManager<span class="token punctuation">.</span><span class="token function">requestBackgroundRunning</span><span class="token punctuation">(</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span></span>
<span class="line">      bgMode<span class="token operator">:</span> backgroundTaskManager<span class="token punctuation">.</span>BackgroundMode<span class="token punctuation">.</span><span class="token constant">DATA_TRANSFER</span><span class="token punctuation">,</span></span>
<span class="line">      wantAgent<span class="token operator">:</span> <span class="token keyword">null</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// å¯åŠ¨å®šæ—¶å™¨</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>timerId <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">          <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">updateAllCards</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">30</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">)</span>  <span class="token comment">// æ¯30åˆ†é’Ÿæ›´æ–°</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  </span>
<span class="line">  <span class="token function">stopPeriodicUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>timerId <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token function">clearInterval</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>timerId<span class="token punctuation">)</span></span>
<span class="line">      <span class="token keyword">this</span><span class="token punctuation">.</span>timerId <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    </span>
<span class="line">    backgroundTaskManager<span class="token punctuation">.</span><span class="token function">stopBackgroundRunning</span><span class="token punctuation">(</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  </span>
<span class="line">  <span class="token keyword">async</span> <span class="token function">updateAllCards</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> formIds <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getAllCardIds</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> formId <span class="token keyword">of</span> formIds<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">updateCard</span><span class="token punctuation">(</span>formId<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ğŸ¯-å®æˆ˜æ¡ˆä¾‹-éŸ³ä¹æ’­æ”¾å¡ç‰‡" tabindex="-1"><a class="header-anchor" href="#ğŸ¯-å®æˆ˜æ¡ˆä¾‹-éŸ³ä¹æ’­æ”¾å¡ç‰‡"><span>ğŸ¯ å®æˆ˜æ¡ˆä¾‹ï¼šéŸ³ä¹æ’­æ”¾å¡ç‰‡</span></a></h2><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts" data-title="ts"><pre><code><span class="line"><span class="token comment">// FormExtensionAbility</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">MusicFormAbility</span> <span class="token keyword">extends</span> <span class="token class-name">FormExtensionAbility</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">private</span> musicPlayer<span class="token operator">:</span> MusicPlayer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MusicPlayer</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">  </span>
<span class="line">  <span class="token function">onAddForm</span><span class="token punctuation">(</span>want<span class="token operator">:</span> Want<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> currentSong <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>musicPlayer<span class="token punctuation">.</span><span class="token function">getCurrentSong</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">const</span> formData <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">      title<span class="token operator">:</span> currentSong<span class="token operator">?.</span>title <span class="token operator">||</span> <span class="token string">&#39;æœªæ’­æ”¾&#39;</span><span class="token punctuation">,</span></span>
<span class="line">      artist<span class="token operator">:</span> currentSong<span class="token operator">?.</span>artist <span class="token operator">||</span> <span class="token string">&#39;--&#39;</span><span class="token punctuation">,</span></span>
<span class="line">      isPlaying<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>musicPlayer<span class="token punctuation">.</span><span class="token function">isPlaying</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">      coverUrl<span class="token operator">:</span> currentSong<span class="token operator">?.</span>coverUrl <span class="token operator">||</span> <span class="token string">&#39;&#39;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">return</span> formBindingData<span class="token punctuation">.</span><span class="token function">createFormBindingData</span><span class="token punctuation">(</span>formData<span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  </span>
<span class="line">  <span class="token function">onFormEvent</span><span class="token punctuation">(</span>formId<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> message<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> event <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">switch</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>action<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">case</span> <span class="token string">&#39;play&#39;</span><span class="token operator">:</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>musicPlayer<span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">updateCardData</span><span class="token punctuation">(</span>formId<span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">break</span></span>
<span class="line">      </span>
<span class="line">      <span class="token keyword">case</span> <span class="token string">&#39;pause&#39;</span><span class="token operator">:</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>musicPlayer<span class="token punctuation">.</span><span class="token function">pause</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">updateCardData</span><span class="token punctuation">(</span>formId<span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">break</span></span>
<span class="line">      </span>
<span class="line">      <span class="token keyword">case</span> <span class="token string">&#39;next&#39;</span><span class="token operator">:</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>musicPlayer<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">updateCardData</span><span class="token punctuation">(</span>formId<span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">break</span></span>
<span class="line">      </span>
<span class="line">      <span class="token keyword">case</span> <span class="token string">&#39;prev&#39;</span><span class="token operator">:</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>musicPlayer<span class="token punctuation">.</span><span class="token function">previous</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">updateCardData</span><span class="token punctuation">(</span>formId<span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">break</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  </span>
<span class="line">  <span class="token keyword">async</span> <span class="token function">updateCardData</span><span class="token punctuation">(</span>formId<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> currentSong <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>musicPlayer<span class="token punctuation">.</span><span class="token function">getCurrentSong</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">const</span> formData <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">      title<span class="token operator">:</span> currentSong<span class="token punctuation">.</span>title<span class="token punctuation">,</span></span>
<span class="line">      artist<span class="token operator">:</span> currentSong<span class="token punctuation">.</span>artist<span class="token punctuation">,</span></span>
<span class="line">      isPlaying<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>musicPlayer<span class="token punctuation">.</span><span class="token function">isPlaying</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">      coverUrl<span class="token operator">:</span> currentSong<span class="token punctuation">.</span>coverUrl</span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">await</span> formProvider<span class="token punctuation">.</span><span class="token function">updateForm</span><span class="token punctuation">(</span></span>
<span class="line">      formId<span class="token punctuation">,</span></span>
<span class="line">      formBindingData<span class="token punctuation">.</span><span class="token function">createFormBindingData</span><span class="token punctuation">(</span>formData<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// å¡ç‰‡UI</span></span>
<span class="line"><span class="token decorator"><span class="token at operator">@</span><span class="token function">Entry</span></span></span>
<span class="line"><span class="token decorator"><span class="token at operator">@</span><span class="token function">Component</span></span></span>
<span class="line">struct MusicCard <span class="token punctuation">{</span></span>
<span class="line">  <span class="token decorator"><span class="token at operator">@</span><span class="token function">LocalStorageProp</span></span><span class="token punctuation">(</span><span class="token string">&#39;title&#39;</span><span class="token punctuation">)</span> title<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">=</span> <span class="token string">&#39;æœªæ’­æ”¾&#39;</span></span>
<span class="line">  <span class="token decorator"><span class="token at operator">@</span><span class="token function">LocalStorageProp</span></span><span class="token punctuation">(</span><span class="token string">&#39;artist&#39;</span><span class="token punctuation">)</span> artist<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">=</span> <span class="token string">&#39;--&#39;</span></span>
<span class="line">  <span class="token decorator"><span class="token at operator">@</span><span class="token function">LocalStorageProp</span></span><span class="token punctuation">(</span><span class="token string">&#39;isPlaying&#39;</span><span class="token punctuation">)</span> isPlaying<span class="token operator">:</span> <span class="token builtin">boolean</span> <span class="token operator">=</span> <span class="token boolean">false</span></span>
<span class="line">  <span class="token decorator"><span class="token at operator">@</span><span class="token function">LocalStorageProp</span></span><span class="token punctuation">(</span><span class="token string">&#39;coverUrl&#39;</span><span class="token punctuation">)</span> coverUrl<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">=</span> <span class="token string">&#39;&#39;</span></span>
<span class="line">  </span>
<span class="line">  <span class="token function">sendAction</span><span class="token punctuation">(</span>action<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">postCardAction</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token punctuation">{</span></span>
<span class="line">      action<span class="token operator">:</span> formInfo<span class="token punctuation">.</span>FormAction<span class="token punctuation">.</span><span class="token constant">MESSAGE</span><span class="token punctuation">,</span></span>
<span class="line">      params<span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span> action <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  </span>
<span class="line">  <span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">Column</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token comment">// å°é¢å’Œä¿¡æ¯</span></span>
<span class="line">      <span class="token function">Row</span><span class="token punctuation">(</span><span class="token punctuation">{</span> space<span class="token operator">:</span> <span class="token number">15</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token function">Image</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>coverUrl <span class="token operator">||</span> <span class="token function">$r</span><span class="token punctuation">(</span><span class="token string">&#39;app.media.default_cover&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">          <span class="token punctuation">.</span><span class="token function">width</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">)</span></span>
<span class="line">          <span class="token punctuation">.</span><span class="token function">height</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">)</span></span>
<span class="line">          <span class="token punctuation">.</span><span class="token function">borderRadius</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span></span>
<span class="line">        </span>
<span class="line">        <span class="token function">Column</span><span class="token punctuation">(</span><span class="token punctuation">{</span> space<span class="token operator">:</span> <span class="token number">5</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">          <span class="token function">Text</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>title<span class="token punctuation">)</span></span>
<span class="line">            <span class="token punctuation">.</span><span class="token function">fontSize</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token punctuation">.</span><span class="token function">fontWeight</span><span class="token punctuation">(</span>FontWeight<span class="token punctuation">.</span>Bold<span class="token punctuation">)</span></span>
<span class="line">            <span class="token punctuation">.</span><span class="token function">maxLines</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line">          </span>
<span class="line">          <span class="token function">Text</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>artist<span class="token punctuation">)</span></span>
<span class="line">            <span class="token punctuation">.</span><span class="token function">fontSize</span><span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token punctuation">.</span><span class="token function">fontColor</span><span class="token punctuation">(</span>Color<span class="token punctuation">.</span>Gray<span class="token punctuation">)</span></span>
<span class="line">            <span class="token punctuation">.</span><span class="token function">maxLines</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">.</span><span class="token function">layoutWeight</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">.</span><span class="token function">alignItems</span><span class="token punctuation">(</span>HorizontalAlign<span class="token punctuation">.</span>Start<span class="token punctuation">)</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">      <span class="token punctuation">.</span><span class="token function">width</span><span class="token punctuation">(</span><span class="token string">&#39;100%&#39;</span><span class="token punctuation">)</span></span>
<span class="line">      <span class="token punctuation">.</span><span class="token function">padding</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span></span>
<span class="line">      </span>
<span class="line">      <span class="token comment">// æ§åˆ¶æŒ‰é’®</span></span>
<span class="line">      <span class="token function">Row</span><span class="token punctuation">(</span><span class="token punctuation">{</span> space<span class="token operator">:</span> <span class="token number">20</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token function">Button</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token operator">:</span> ButtonType<span class="token punctuation">.</span>Circle <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">          <span class="token function">Image</span><span class="token punctuation">(</span><span class="token function">$r</span><span class="token punctuation">(</span><span class="token string">&#39;app.media.icon_previous&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token punctuation">.</span><span class="token function">width</span><span class="token punctuation">(</span><span class="token number">24</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token punctuation">.</span><span class="token function">height</span><span class="token punctuation">(</span><span class="token number">24</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">.</span><span class="token function">width</span><span class="token punctuation">(</span><span class="token number">48</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">.</span><span class="token function">height</span><span class="token punctuation">(</span><span class="token number">48</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">.</span><span class="token function">onClick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">          <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">sendAction</span><span class="token punctuation">(</span><span class="token string">&#39;prev&#39;</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">        </span>
<span class="line">        <span class="token function">Button</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token operator">:</span> ButtonType<span class="token punctuation">.</span>Circle <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">          <span class="token function">Image</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>isPlaying <span class="token operator">?</span> </span>
<span class="line">            <span class="token function">$r</span><span class="token punctuation">(</span><span class="token string">&#39;app.media.icon_pause&#39;</span><span class="token punctuation">)</span> <span class="token operator">:</span> </span>
<span class="line">            <span class="token function">$r</span><span class="token punctuation">(</span><span class="token string">&#39;app.media.icon_play&#39;</span><span class="token punctuation">)</span></span>
<span class="line">          <span class="token punctuation">)</span></span>
<span class="line">          <span class="token punctuation">.</span><span class="token function">width</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span></span>
<span class="line">          <span class="token punctuation">.</span><span class="token function">height</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">.</span><span class="token function">width</span><span class="token punctuation">(</span><span class="token number">56</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">.</span><span class="token function">height</span><span class="token punctuation">(</span><span class="token number">56</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">.</span><span class="token function">onClick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">          <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">sendAction</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>isPlaying <span class="token operator">?</span> <span class="token string">&#39;pause&#39;</span> <span class="token operator">:</span> <span class="token string">&#39;play&#39;</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">        </span>
<span class="line">        <span class="token function">Button</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token operator">:</span> ButtonType<span class="token punctuation">.</span>Circle <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">          <span class="token function">Image</span><span class="token punctuation">(</span><span class="token function">$r</span><span class="token punctuation">(</span><span class="token string">&#39;app.media.icon_next&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token punctuation">.</span><span class="token function">width</span><span class="token punctuation">(</span><span class="token number">24</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token punctuation">.</span><span class="token function">height</span><span class="token punctuation">(</span><span class="token number">24</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">.</span><span class="token function">width</span><span class="token punctuation">(</span><span class="token number">48</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">.</span><span class="token function">height</span><span class="token punctuation">(</span><span class="token number">48</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">.</span><span class="token function">onClick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">          <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">sendAction</span><span class="token punctuation">(</span><span class="token string">&#39;next&#39;</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">      <span class="token punctuation">.</span><span class="token function">width</span><span class="token punctuation">(</span><span class="token string">&#39;100%&#39;</span><span class="token punctuation">)</span></span>
<span class="line">      <span class="token punctuation">.</span><span class="token function">justifyContent</span><span class="token punctuation">(</span>FlexAlign<span class="token punctuation">.</span>Center<span class="token punctuation">)</span></span>
<span class="line">      <span class="token punctuation">.</span><span class="token function">padding</span><span class="token punctuation">(</span><span class="token punctuation">{</span> bottom<span class="token operator">:</span> <span class="token number">15</span> <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">width</span><span class="token punctuation">(</span><span class="token string">&#39;100%&#39;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">height</span><span class="token punctuation">(</span><span class="token string">&#39;100%&#39;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">backgroundColor</span><span class="token punctuation">(</span>Color<span class="token punctuation">.</span>White<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">borderRadius</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ğŸ’¡-æœ€ä½³å®è·µ" tabindex="-1"><a class="header-anchor" href="#ğŸ’¡-æœ€ä½³å®è·µ"><span>ğŸ’¡ æœ€ä½³å®è·µ</span></a></h2><h3 id="_1-äº‹ä»¶å¤„ç†" tabindex="-1"><a class="header-anchor" href="#_1-äº‹ä»¶å¤„ç†"><span>1. äº‹ä»¶å¤„ç†</span></a></h3><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts" data-title="ts"><pre><code><span class="line"><span class="token comment">// âœ… ä½¿ç”¨try-catchå¤„ç†äº‹ä»¶</span></span>
<span class="line"><span class="token function">onFormEvent</span><span class="token punctuation">(</span>formId<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> message<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> event <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handleEvent</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&#39;äº‹ä»¶å¤„ç†å¤±è´¥:&#39;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-æ›´æ–°é¢‘ç‡æ§åˆ¶" tabindex="-1"><a class="header-anchor" href="#_2-æ›´æ–°é¢‘ç‡æ§åˆ¶"><span>2. æ›´æ–°é¢‘ç‡æ§åˆ¶</span></a></h3><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts" data-title="ts"><pre><code><span class="line"><span class="token comment">// âœ… é¿å…é¢‘ç¹æ›´æ–°</span></span>
<span class="line"><span class="token keyword">private</span> lastUpdateTime<span class="token operator">:</span> Map<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">number</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token function">shouldUpdate</span><span class="token punctuation">(</span>formId<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">boolean</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> last <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>lastUpdateTime<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>formId<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token number">0</span></span>
<span class="line">  <span class="token keyword">const</span> now <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">  </span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span>now <span class="token operator">-</span> last <span class="token operator">&lt;</span> <span class="token number">1000</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// 1ç§’å†…ä¸é‡å¤æ›´æ–°</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token boolean">false</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  </span>
<span class="line">  <span class="token keyword">this</span><span class="token punctuation">.</span>lastUpdateTime<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>formId<span class="token punctuation">,</span> now<span class="token punctuation">)</span></span>
<span class="line">  <span class="token keyword">return</span> <span class="token boolean">true</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-é”™è¯¯å¤„ç†" tabindex="-1"><a class="header-anchor" href="#_3-é”™è¯¯å¤„ç†"><span>3. é”™è¯¯å¤„ç†</span></a></h3><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts" data-title="ts"><pre><code><span class="line"><span class="token comment">// âœ… ä¼˜é›…å¤„ç†æ›´æ–°å¤±è´¥</span></span>
<span class="line"><span class="token keyword">async</span> <span class="token function">updateCard</span><span class="token punctuation">(</span>formId<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">await</span> formProvider<span class="token punctuation">.</span><span class="token function">updateForm</span><span class="token punctuation">(</span>formId<span class="token punctuation">,</span> data<span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&#39;æ›´æ–°å¤±è´¥:&#39;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span></span>
<span class="line">    <span class="token comment">// è®°å½•æ—¥å¿—ï¼Œä¸å½±å“å…¶ä»–å¡ç‰‡</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ğŸ“š-å‚è€ƒèµ„æº" tabindex="-1"><a class="header-anchor" href="#ğŸ“š-å‚è€ƒèµ„æº"><span>ğŸ“š å‚è€ƒèµ„æº</span></a></h2>`,26)),s("ul",null,[s("li",null,[s("a",d,[n[0]||(n[0]=a("å¡ç‰‡æ•°æ®äº¤äº’",-1)),p(t)])]),s("li",null,[s("a",v,[n[1]||(n[1]=a("postCardAction",-1)),p(t)])])]),n[6]||(n[6]=s("hr",null,null,-1)),s("p",null,[n[3]||(n[3]=s("strong",null,"ä¸‹ä¸€èŠ‚",-1)),n[4]||(n[4]=a(" â†’ ",-1)),p(c,{to:"/tutorials/harmonyos-dev/13-service-card-next/03-%E5%8D%A1%E7%89%87%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5.html"},{default:u(()=>[...n[2]||(n[2]=[a("å¡ç‰‡æœ€ä½³å®è·µ",-1)])]),_:1})])])}const h=l(k,[["render",m]]),g=JSON.parse('{"path":"/tutorials/harmonyos-dev/13-service-card-next/02-kapianjiaohu.html","title":"å¡ç‰‡äº¤äº’","lang":"zh-CN","frontmatter":{"title":"å¡ç‰‡äº¤äº’","date":"2025-01-22T00:00:00.000Z"},"headers":[{"level":2,"title":"ğŸ”— å¡ç‰‡äº‹ä»¶","slug":"ğŸ”—-å¡ç‰‡äº‹ä»¶","link":"#ğŸ”—-å¡ç‰‡äº‹ä»¶","children":[{"level":3,"title":"postCardAction å‘é€äº‹ä»¶","slug":"postcardaction-å‘é€äº‹ä»¶","link":"#postcardaction-å‘é€äº‹ä»¶","children":[]}]},{"level":2,"title":"ğŸ¯ ç‚¹å‡»è·³è½¬","slug":"ğŸ¯-ç‚¹å‡»è·³è½¬","link":"#ğŸ¯-ç‚¹å‡»è·³è½¬","children":[{"level":3,"title":"è·³è½¬åˆ°åº”ç”¨é¡µé¢","slug":"è·³è½¬åˆ°åº”ç”¨é¡µé¢","link":"#è·³è½¬åˆ°åº”ç”¨é¡µé¢","children":[]}]},{"level":2,"title":"ğŸ”„ åŠ¨æ€æ›´æ–°","slug":"ğŸ”„-åŠ¨æ€æ›´æ–°","link":"#ğŸ”„-åŠ¨æ€æ›´æ–°","children":[{"level":3,"title":"ä¸»åŠ¨æ›´æ–°å¡ç‰‡æ•°æ®","slug":"ä¸»åŠ¨æ›´æ–°å¡ç‰‡æ•°æ®","link":"#ä¸»åŠ¨æ›´æ–°å¡ç‰‡æ•°æ®","children":[]},{"level":3,"title":"æ‰¹é‡æ›´æ–°å¤šä¸ªå¡ç‰‡","slug":"æ‰¹é‡æ›´æ–°å¤šä¸ªå¡ç‰‡","link":"#æ‰¹é‡æ›´æ–°å¤šä¸ªå¡ç‰‡","children":[]}]},{"level":2,"title":"â° å®šæ—¶åˆ·æ–°","slug":"â°-å®šæ—¶åˆ·æ–°","link":"#â°-å®šæ—¶åˆ·æ–°","children":[{"level":3,"title":"åå°å®šæ—¶ä»»åŠ¡","slug":"åå°å®šæ—¶ä»»åŠ¡","link":"#åå°å®šæ—¶ä»»åŠ¡","children":[]}]},{"level":2,"title":"ğŸ¯ å®æˆ˜æ¡ˆä¾‹ï¼šéŸ³ä¹æ’­æ”¾å¡ç‰‡","slug":"ğŸ¯-å®æˆ˜æ¡ˆä¾‹-éŸ³ä¹æ’­æ”¾å¡ç‰‡","link":"#ğŸ¯-å®æˆ˜æ¡ˆä¾‹-éŸ³ä¹æ’­æ”¾å¡ç‰‡","children":[]},{"level":2,"title":"ğŸ’¡ æœ€ä½³å®è·µ","slug":"ğŸ’¡-æœ€ä½³å®è·µ","link":"#ğŸ’¡-æœ€ä½³å®è·µ","children":[{"level":3,"title":"1. äº‹ä»¶å¤„ç†","slug":"_1-äº‹ä»¶å¤„ç†","link":"#_1-äº‹ä»¶å¤„ç†","children":[]},{"level":3,"title":"2. æ›´æ–°é¢‘ç‡æ§åˆ¶","slug":"_2-æ›´æ–°é¢‘ç‡æ§åˆ¶","link":"#_2-æ›´æ–°é¢‘ç‡æ§åˆ¶","children":[]},{"level":3,"title":"3. é”™è¯¯å¤„ç†","slug":"_3-é”™è¯¯å¤„ç†","link":"#_3-é”™è¯¯å¤„ç†","children":[]}]},{"level":2,"title":"ğŸ“š å‚è€ƒèµ„æº","slug":"ğŸ“š-å‚è€ƒèµ„æº","link":"#ğŸ“š-å‚è€ƒèµ„æº","children":[]}],"git":{"createdTime":1765250065000,"updatedTime":1765250065000,"contributors":[{"name":"CambridgeFoldingKnife","email":"3144253125@qq.com","commits":1}]},"filePathRelative":"tutorials/harmonyos-dev/13-service-card-next/02-å¡ç‰‡äº¤äº’.md"}');export{h as comp,g as data};
